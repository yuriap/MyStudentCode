ЧАСТЬ 1: ВВЕДЕНИЕ

README файл

    Изменения в последнюю минуту или дополнения к ProCarry,
не включенные в настоящее руководство, объясняются в
специальном дисковом файле. Специальный файл на дискетте
ProCarry называется README.TXT. Чтобы просмотреть информацию
в README.TXT, выполните следующие инструкции.

   1. Запустите ваш компьютер обычным способом.

   2. Поместите дискетту ProCarry в дисковод A:.

   3. После запроса операционной системы (C:> или что-либо
подобное) введите следующее:

         TYPE A:README.TXT | MORE

или для вывода на печатающее устройство

         TYPE A:README.TXT > PRN

    В результате вы сможете постранично просмотреть на экране
весь файл. После окончания просмотра на экране вы снова
увидите запрос операционной системы.


Описание ProCarry

    ProCarry - это система электронной почты и эффективная и
экономичная локальная сеть IBM-совместимых персональных
компьютеров.
    Электронная почта ProCarry включает в себя средства
организации многомодемных узлов почты, информационных досок
объявлений. Пользователи почты ProCarry имеют возможности
работать через сети Х.25, через модемы любых типов и с любыми
скоростями передачи данных.
    Локальная сеть ProCarry экономичная система, потому что
использует только программные средства для создания сетевой
коммуникации. Сетевая коммуникация одного компьютера с другим
осуществляется через имеющиеся в ваших компьютерах RS-232
последовательные порты.
    Назначение ProCarry - создание компьютерных сетей по
коммутируемым телефонным каналам связи и создание дешевых
локальных сетей в малых оффисах из 3-4 персональных
компьютеров с выходом в коммутируемую сеть. Важная
особенность ProCarry - любой компьютер, участвуя в работе
сети и предоставляя свои ресурсы в сеть, сам все время
сохраняет возможность выполнять любые пользовательские
программы. ProCarry не требует, как многие другие сети, чтобы
сервер только обслуживал сеть и уже не мог выполнять обычные
пользовательские программы. В сети ProCarry серверами
одновременно являются все компьютеры.
    Сеть ProCarry состоит из одного или более серверов-
компьютеров и одного или более сателлитов-компьютеров.
сервер - это название компьютера, диски и принтеры которого
совместно используются сетевыми пользователями. Сателлит -
это название компьютера, который пользуется дисковыми
ресурсами и принтерами сервера. В сети ProCarry каждый
компьютер может одновременно быть и сервером, и сателлитом.


Электронная почта ProCarry

    Электронная почта ProCarry - составная часть полного
пакета ProCarry. Она включает в себя весь комплекс средств,
необходимых для организации многоканальных серверов почты и
абонентских точек.
    Серверы почты ProCarry могут иметь неограниченное число
абонетов. За каждым из абонентов закрепляются доступные
только ему ресурсы сервера. От несанкционированного доступа
почта защищается развитой системой паролей, канальным
шифрованием передаваемых данных. Сообщения почты могут быть
зашифрованы с помощью мощных криптографических систем,
входящих в комплект поставки ProCarry.
    Узлы почты имеют программную и аппаратную поддержку для
передачи и приема сообщений с факса и телеграфа. Каждый узел
почты одновременно является информационно-справочной доской
объявлений. Узлы могут быть связаны между собой по выделенным
и коммутируемым телефонным или телеграфным каналам связи,
через спутниковые системы передачи данных или через сети
Х.25.
    В пакет ProCarry входит мощный многооконный редактор
текстов, предназначенный для подготовки и обработки сообщений
электронной почты, факса и телеграфа. Редактор почты может
быть использован в качестве интегрированного пакета
оффисной автоматизации.
    Электронная почта ProCarry базируется на нескольких
различных протоколах передачи данных. Один из протоколов, в
частности, использует двунаправленную передачу данных с
коррекцией от ошибок и со скоростями, лишь на несколько
процентов отличающимися от максимальной пропускной
способности самой аппаратуры передачи данных.


Топология сетей ProCarry

    ProCarry дает возможность организации сетей различной
топологии. Это достигается за счет того, что имеется
возможность обслуживания многоточечных каналов связи, а также
за счет многоступенчатых соединений, когда 2 компьютера, не
имеющие между собой непосредственной связи могут обмениваться
данными через компьютер-посредник.
    Многоточечное соединение - это сразу несколько
компьютеров, подключенных к одной линии связи. Линия связи не
может быть коммутируемой. Достигается многоточечное
соединение через специальное оборудование или через
соответствующие модемы в стандарте V.23. Каждому абоненту,
подключенному к линии, присваивается свой адрес, по которому
программы различают принадлежность корреспонденции, идущей
через канал связи. Хотя необходимость в многоточечном
соединении достаточно редка, тем не менее ProCarry
поддерживает такую возможность.
    Важнейшее назначение ProCarry - организация сетей через
коммутируемые каналы связи. Однако ProCarry позволяет
создавать и небольшие локальные сети или комбинировать
локальные сети с возможностями телефонных линий связи.
    Простейшая сеть ProCarry имеет вид "звезды". Один из
компьютеров определяется для работы в качестве сервера. К
дискам и принтерам сервера имеют доступ все остальные
компьютеры, определяемые как сателлиты.
    Например, в качестве сервера используется IBM PC/AT,
сателлиты - 2 компьютера IBM PC/XT - используют совместно
диски и принтер IBM PC/AT. Пользователи всех 3-х компьютеров
могут использовать ресурсы сервера IBM PC/AT в одно и то же
время. Пользователи каждого из сателлитов также могут обычным
образом пользоваться собственными дисками и принтерами.
    Сеть значительно улучшается, если все 3 компьютера
одновременно являются и серверами, и сателлитами. Все
компьютеры могут пользоваться своими собственными дисками и
принтерами и одновременно ресурсами двух других компьютеров.
При этом компьютеры IBM PC/XT в этой сети могут не иметь
физической связи между собой, им достаточно быть соединенными
с центральной IBM PC/AT, которая будет выполнять роль
"посредника" при совместном использовании IBM PC/XT ресурсов
друг друга.
    Компьютеры могут быть соединены кабелем между собой на
коротком расстоянии. Тогда это будет простая локальная сеть.
Однако связь может быть организована через модемы и
автоматические телефонные станции. ProCarry допускает любые
комбинации типов соединений, например, один сателлит может
быть связан с сервером на коротком расстоянии, другие
подсоединены через модемы и при этом сами модемы разнотипные.
    ProCarry позволяет подключать к одному компьютеру до 10
других компьютеров, обслуживаются все подключенные абоненты
одновременно. Разумеется, для каждого отдельного подключения
должен быть и свой отдельный порт RS-232 (если соединение не
многоточечное). При этом все 10 компьютеров могут иметь
разные типы подключений: часть подключена кабелем в локальном
варианте, другая часть подключена через модемы к арендованным
"закрепленным" каналам связи по многоточечному варианту, а
еще какая-то часть - через модемы к коммутируемым линиям
связи. Все модемы могут иметь разные типы и скорости, с
автонабором номера и без него. Каждому из подключенных
абонентов могут быть предоставлены разные ресурсы - диски и
принтеры, эти ресурсы могут совпадать или не совпадать. И при
всем этом сам компьютер может пользоваться ресурсами всех
подключенных к нему абонентов. Все соединения могут быть
организованы таким образом, что подключенные абоненты смогут
общаться не только с центральным компьютером, но и между
собой.
    Хотя ProCarry предоставляет возможность подключения
многих компьютеров к одному, возможности самих компьютеров
могут наложить определенные ограничения. Если используется
связь на коротком расстоянии с большой скоростью, то
быстродействие центрального компьютера может оказаться
недостаточным для обслуживания многих абонентов одновременно.
Но если абоненты подключены через модемы, то, как правило,
ограничений на быстродействие нет, даже простейшие IBM PC
смогут обслужить одновременно несколько абонентов и при этом
оставить возможность работать пользователю самого компьютера.
    Использование компьютеров в качестве "посредников"
несколько снижает эффективность сети. Поэтому здесь тоже
могут быть определенные ограничения. Например, не
рекомендуется организовывать связь с двумя и более
"посредниками", хотя ProCarry и допускает такие возможности.
    Оптимальный вариант сети ProCarry, когда 2-3 компьютера
подключены кабелями к одному центральному. Один из
компьютеров локальной сети, лучше всего центральный,
подключен через модем к коммутируемой телефонной линии.
Названия сервер и сателлит здесь не совсем корректны, т.к.
каждый из компьютеров пользуется ресурсами всех
остальных.


Использование дисков сети

    ProCarry дает возможности совместно использовать одни и
те же сетевые диски различными пользователями одновременно.
Одни и те же диски и файлы могут использоваться одновременно
как пользователями самого компьютера-сервера, так и сразу
несколькими сателлитами. Для управления совместным
использованием файлов используются стандартные средства,
предусмотренные операционной системой MS-DOS и программой
SHARE.COM.
    В системе ProCarry предусмотрены возможности управления
доступом различных абонентов сети к дискам серверов. При этом
имеются возможности не только выделять каждому абоненту
строго определенные области сетевых дисков, но и управлять
режимами доступа, разрешать, к примеру, в этих областях
только чтение или только запись.

ЧАСТЬ 2: ТРЕБОВАНИЯ К ОБОРУДОВАНИЮ


Оборудование компьютеров

    ProCarry поддерживается на IBM или IBM-совместимых
персональных компьютерах с различным совместимым периферийным
оборудованием. ProCarry будет работать на IBM персональных
компьютерах или на совместимых, которые имеют 8086, 8088,
80286, 80386, 80486 или совместимый процессор.


Оперативная память

    Драйвер сети ProCarry.SYS и программа управления
коммутируемыми линиями связи PROCRSRV.COM находятся
резидентно (т.е. постоянно) в оперативной памяти
персонального компьютера. Если обслуживается только одна
линия связи (т.е. 1 порт RS-232), то драйверы занимают
примерно 51K RAM-памяти. Если обслуживается больше одного
канала связи, то на каждый дополнительный адаптер RS-232
выделяется еще по 6,2K памяти. Например, если ProCarry
настроен на работу с 4 портами RS-232, то занимаемая память
составит 70K.
    Если обслуживаются сетевые принтеры-серверы, то для
каждого из них резервируется еще дополнительная память. Ее
размер задается программой настройки драйвера сети в пределах
от 1 до 32K на каждый сетевой принтер. Но при этом общий
размер выделяемой для принтеров-серверов памяти не может
превышать 32K.
    Если программа управления коммутируемыми линиями связи
не используется, то общий размер памяти, занимаемой ProCarry,
уменьшается на 16K.
    Если ProCarry загружается в память не из AUTOEXEC.BAT и
CONFIG.SYS, то к занимаемой памяти следует добавить около
2.5К - область переменных COMMAND.COM.
    Драйвер ускоренной связи SFAST.EXE также загружается
резидентно в оперативную память и занимает 14К - программные
коды и 3,2К - для каждого из каналов связи.
    Максимальный размер памяти, занимаемой ProCarry вместе с
драйвером ускоренной связи SFAST.EXE для 1 канала связи -
70К, а для 10 каналов - 153К (без буферов для принтеров-
серверов).


Дисковые устройства

    Компьютеры, работающие с ProCarry, могут обходиться
всего одним дисководом гибких дисков. Для совместного
использования в сети серверы могут предоставлять и гибкие
диски. Тем не менее, рекомендуется в сети использовать
"жесткие" диски. ProCarry допускает использование в своей
сети дисков, созданных другими сетями передачи данных. Для
многих приложений может оказаться полезным использование в
сети и виртуальных RAM-дисков.


Последовательные порты

    ProCarry использует для подключения к линиям связи RS-232
последовательные порты. Важно заметить, что последовательные
порты, используемые ProCarry, должны применять микросхему
8250 UART (или совместимую), которая используется стандартно
в IBM асинхронном последовательном адаптере и во многих
подобных картах расширения.
    Количество портов, обслуживаемых ProCarry - до 10. Каждый
порт должен иметь свой уникальный адрес и одну свою линию
прерывания IRQ. ProCarry позволяет использовать как основной
контроллер прерываний IRQ0-IRQ7, так и дополнительный
IRQ8-IRQ15 в AT-совместимых компьютерах. Два действующих
порта RS-232 не должны иметь одну линию прерывания.
    Заметим, что в AT-совместимых компьютерах прерывание 2
используется для подключения дополнительного контроллера
прерываний, а его линия в шине компьютера используется
прерыванием 9. Если в инструкции карты расширения или
модема указано использование IRQ 2, то при настройке ProCarry
на AT-совместимых компьютерах следует указывать 9 номер IRQ.
    Если для увеличения количества портов используются карты
типа Multi Port Serial на 4 последовательных канала RS-232
(или аналогичные им сдвоенные карты на 8 каналов), то 4
разных порта RS-232 могут пользоваться одной шиной IRQ.
Поскольку многопортовых последовательных карт существует
несколько разновидностей и ProCarry поддерживает не все из
них, вступайте в контакт с вашим дилером ProCarry перед
приобретением таких плат.


Стандартные адреса последовательных портов

    Компьютеры типа IBM стандартно имеют до 4-х портов
RS-232. Эти порты обозначаются COM1, COM2, COM3 и COM4. Порт
COM1 иногда обозначается еще и как AUX. За портами стандартно
закреплены определенные адреса и номера IRQ прерываний:

        COM1 (AUX) адрес 3F8 прерывание IRQ4
        COM2       адрес 2F8 прерывание IRQ3
        COM3       адрес 3E8 прерывание IRQ4
        COM4       адрес 2E8 прерывание IRQ3

    Стандартные значения адресов портов, разумеется, могут
быть и изменены. Если используются порты COM3 или COM4, то
необходимо изменить в них стандартное значение номера IRQ
прерывания, так как оно совпадает со значением номера IRQ
портов COM1 или COM2.


Дополнение последовательных портов

    Во время подключения компьютеров к сетям связи у вас
может возникнуть необходимость использовать больше
последовательных портов, чем имеется стандартно в ваших
компьютерах. Вы можете увеличить число доступных
последовательных портов с помощью одной или нескольких
карт расширения.
    Во время установки вы должны правильно настроить адреса
портов и номера IRQ. Для ProCarry не имеет значения,
установлены стандартые или нестандартные адреса и номера IRQ
прерываний - программа PROCRINS.EXE имеет возможность
настраивать сеть на любые адреса и IRQ.


Модемы

    Сети ProCarry могут быть основаны на различных типах
модемов или на физическом соединении кабелем портов RS-232.
Возможно использование спутниковых систем передачи данных, а
также подключение к асинхронным выходам PAD сетей Х.25.
Причем в одной конкретной сети одновременно могут быть
использованы различные варианты соединения.
    ProCarry может работать с модемами и устройствами
передачи данных всех типов, которые можно подключить к
асинхронному адаптеру RS-232. Ограничения есть только для
полудуплексных модемов - они не могут использоваться со
скоростным протоколом передачи программы SFAST.EXE.
    Работа с разными типами модемов для программ имеет
существенные различия. Поэтому предусмотрена возможность
задания системе параметров модемов. Тип модема и соединения
для каждого стыка указывается ProCarry с помощью программы
настройки PROCRINS.EXE. Настоящая версия ProCarry допускает
9 вариантов настройки.

    1 - Модем, совместимый с Hayes, но без встроенного
протокола MNP или V.42. Скорость передачи от 300 бит/с до
38400 бит/с. Скорость порта RS-232 автоматически
подстраивается под физическую скорость в канале связи на
основании сообщения модема CONNECT.

    2 - Асинхронный полудуплексный модем V.23 со специальным
методом набора номера.

    3 - Кабель нуль-модем для соединения двух портов RS-232
между собой напрямую.

    4 - Асинхронный порт PAD сети Х.25 или дуплексный модем
на выделенном канале связи (неинтеллектуальный или Hayes-типа
в Dumb-режиме). Тип 4 использует цепи CTS/RTS для управления
потоками данных аналогично типу 7.

    5 - Асинхронный полудуплексный модем V.23 (ИСМ-1200) со
специальным методом набора номера и не имеющий аппаратной
задержки при включении передатчика (задержка реализуется
ProCarry программно).

    6 - Модем полностью в стандарте V.23.

    7 - Модем, совместимый с AT командами Hayes. В отличие от
типа 1 используются цепи управления модемом RTS и CTS, т.е.
используется управление потоком передаваемых данных. Этот тип
позволяет использовать модемы, имеющие встроенную коррекцию
ошибок и сжатие данных в стандартах V.42/V.42bis и MNP 2-10.
Тип 7 предназначается только для модемов, имеющих средства
для управления потоком данных от компьютера, поскольку в этом
режиме скорость порта RS-232 не подстраивается под физическую
скорость в канале связи и остается всегда неизменной.

    8 - Интеллектуальный полудуплексный модем типа V.23,
управляемый AT-командами Hayes ("ЭПРО").

    9 - Интеллектуальный полудуплексный модем типа V.23,
управляемый по протоколу V.25bis ("Алмаз", АМ-1200).


Настройка Hayes-модемов для работы с ProCarry

    Программа PROCRINS.EXE имеет возможности задать параметры
первоначальной настройки модемов Hayes. Для ProCarry модем
необходимо инициализировать так, чтобы удовлетворялись
условия:
    - сигнал Детектор несущей (Carrier Detect) должен
устанавливаться в 1 только тогда, когда несущая в линии связи
присутствует, т.е. модем в режиме On-Line; в некоторых
модемах это устанавливается с помощью команды &C1, а в
остальных - внешними переключателями;
    - если сигнал Терминал готов (DTR) сброшен, модем должен
отсоединиться от линии ("положить трубку") и сброситься
(команда &D2);
    - модем должен выдавать все сообщения и ответы на команды
в полном (не числовом) виде (команды X4, V1 и Q0);
    - отсутствует "эхо" при передаче в модем команд и данных,
т.е. модем не возвращает в компьютер принятые от него знаки;
во всех модемах Hayes это команды E0 и F1;
    - сигнал от модема CTS не зависит от цепи RTS; в
некоторых модемах это достигается командой &R1, все остальные
модемы удовлетворяют этому требованию всегда независимо от
настройки.

    Рекомендуемая строка инициализации модема

         AT E0 Q0 X4 V1 S0=0 &D2 &C1 &R1

    Если модем не имеет каких-то команд, например, &R1, &D2
или &C1, то следует убрать отсутствующий параметр из строки
настройки и переключателями на самом модеме настроить его
так, чтобы его работа соответствовала инструкциям &R1, &D2 и
&C1.
    Многие модемы производят отбой от линии при сбросе
сигнала DTR (заданного при инициализации по команде &D2) не
сразу, а лишь после некоторого интервала времени. Обычно это
время 50 мСек и изменяется записью в регистр модема S25.
ProCarry для гарантированного отбоя модема от линии
использует интервал 1 сек, т.е. в течение 1 сек сигнал DTR
удерживается в состоянии 0. Длительность этого интервала
можно изменить с помощью PROCRINS.EXE.
    Большинство модемов 1200 бит/с использует внешние
переключатели, чтобы заранее установить все необходимые
опции. С другой стороны, большинство современных модемов
настраивается по строке инициализации. Кроме того, многие
модемы имеют команду &V для сохранения текущей настройки в
энергонезависимой долговременной памяти. Во избежание
недоразумений, пользуйтесь инструкцией по вашему модему.
Обращайтесь за консультациями к вашему дилеру ProCarry.


Настройка MNP-модемов

    Если модем использует протоколы V.42/V.42bis и MNP 2-10,
то для работы с ProCarry необходимо соответствующим образом
его инициализировать. Главные требования при этом:
    - модем не должен "подстраивать" скорость на стыке с
RS-232 после выдачи команды CONNECT под физическую скорость в
канале связи; скорость работы модема с компьютером должна
быть неизменной и соответствовать первоначальной скорости
RS-232, установленной программой PROCRINS.EXE; в большинстве
модемов это достигается командой \J0;
    - модем должен буферизовать принимаемые из компьютера
данные для передачи в линию (в большинстве модемов - команда
\C1);
    - скорость, устанавливаемая PROCRINS.EXE, должна в 2-4
раза превышать физическую скорость работы модема в линии,
тогда порт успеет полностью загрузить модем данными для
передачи и успеет взять от него все принятые данные;
    - модем должен управлять потоком данных, идущих от
компьютера с помощью цепи CTS (в большинстве модемов -
команда \Q2);
    - программное управление потоком данных должно быть
всегда отключено командами \G0\X0.

    Для модемов, работающих в режиме MNP5, рекомендуемая
строка инициализации

   AT E0 Q0 X4 V1 S0=0 &D2 &C1 &R1 \J0 \Q2 \C1 \N3 \G0

    Если модем совместим с V.42/V.42bis, то команда \N3
заменяется на \N7 или иногда на \N6. В некоторых модемах
V.42/V.42bis инициализируется командой &Q5.
    Во многих MNP-модемах следует также выполнить и запомнить
в памяти модема команды

             AT \G0 %C1 \V1 \E0 \X0 -P0


Соединительные кабели

    Модемы типа V.23 и совместимые с AT-командами используют
немного отличающиеся кабели для подключения к персональному
компьютеру.
    Для модема типа V.23 (номера возможных вариантов
настройки 2, 5, 6, 8, 9) изготавливается кабель, в котором
обязательно соединяются сигналы:

  Сигнальная земля (цепь С102 по описанию V.24)  -  контакт 7
25-контактного разьема DB25 или 5-й контакт 9-контактного
разьема DB9);
  Передаваемые данные TxD (C103)  -  к.2  DB25 или к.3 DB9;
  Принимаемые данные  RxD (C104)  -  к.3  DB25 или к.2 DB9;
  Запрос передачи     RTS (C105)  -  к.4  DB25 или к.7 DB9;
  Готов к передаче    CTS (C106)  -  к.5  DB25 или к.8 DB9;
  Терминал готов      DTR (C108)  -  к.20 DB25 или к.4 DB9;
  Модем готов         DSR (C107)  -  к.6  DB25 или к.6 DB9;
  Детектор несущей    DCD (C109)  -  к.8  DB25 или к.1 DB9;
  Индикатор вызова    Ri  (C125)  -  к.22 DB25 или к.9 DB9.

    Остальные сигналы стыка V.24 не используются, всего 9
соединительных проводов. При изготовлении кабеля сигналы
компьютера соединяются с такими же сигналами модема.
    Если используется модем совместимый с Hayes (варианты 1 и
7 при настройке), то не используется сигнал Ri, т.е. всего 8
соединительных проводов.


Трехпроводные кабели "нуль-модем"

    Если используется соединение компьютеров кабелем без
модемов (вариант 3 при настройке ProCarry), то скорость
работы сети будет максимальной, но расстояние при этом не
может превышать 15 - 50 м.
    Изготавливается 3-х проводный кабель, называемый иногда
"нуль-модем". Поскольку RS-232 имеет 2 варианта разьемов -
из 9-ти контактов (DB9) или из 25-ти контактов (DB25), то
возможные варианты подключений такие:

          DB9-разьем  с   DB9-разьемом

         Номер контакта        Номер контакта

         3  (передача)   -------   2  (прием)
         2  (прием)      -------   3  (передача)
         5  (земля)      -------   5  (земля)

           DB25-разьем  с  DB25-разьемом

         Номер контакта        Номер контакта

         2  (передача)   -------   3  (прием)
         3  (прием)      -------   2  (передача)
         7  (земля)      -------   7  (земля)

           DB9-разьем   с  DB25-разьемом

         Номер контакта        Номер контакта

         3  (передача)   -------   3  (прием)
         2  (прием)      -------   2  (передача)
         5  (земля)      -------   7  (земля)

    Обычно для уменьшения влияния помех используется две
"витые" пары проводов, сигнал "земля" присутствует в каждой
из пар проводов.
    Сигналы стыка RS-232 могут быть заменены интерфейсом
"токовая земля".


Подключение к PAD сети Х.25

    Через сети Х.25 ProCarry может работать только с помощью
двунаправленного протокола программы SFAST.EXE, похожего на
протокол Zmodem.
    Компьютеры с ProCarry подключаются к асинхронным выходам
PAD. Подключение может выполняться через кабель
непосредственно к порту PAD или через дуплексный модем по
выделенному каналу связи или физической цепи. Тип модема в
настройке ProCarry номер 4. Если используется коммутируемая
линия для подключения к PAD и модем, совместимый с Hayes, то
тип модема 7.
    Для подключения к порту PAD могут использоваться разные
кабели в зависимости от типа порта PAD. В некоторых случаях
используются точно такие же кабели, как и для подключения
обычных модемов, в других случаях кабель напоминает
нуль-модем.
    Все PAD имеют управление потоком данных, принимаемых от
терминала. Для 4-го типа модема система ProCarry использует
управление потоком с помощью цепей CTS/RTS точно так, как и
для модемов типа 7 с MNP или V.42.
    Многие PAD не умеют управлять потоком данных с помощью
цепей стыка V.24 CTS/RTS (такое управление обычно называется
аппаратным). Такие PAD имеют только программное управление
с помощью вставляемых в поток данных знаков Xon и Xoff.
    ProCarry можно переключить и на программное управление
потоком с помощью Xon/Xoff. Для этого имеется специальное
поле в настройке ProCarry с помощью программы PROCRINS.EXE.
Переключение на программное управление Xon/Xoff выполняется
независимо для каждого отдельного канала ProCarry и может
быть использовано только для модемов типа 4 и 7.


Подключение модемов к 4-проводным линиям связи

    Все полудуплексные модемы имеют задержку включения
передатчика после включения цепи RTS - запрос передачи (кроме
модемов типа 5 - для них задержка формируется программно).
Эта задержка необходима для пропуска "эхо"-сигналов в линиях
связи. Если вы используете 4-проводную линию связи, то "эхо"
от противоположного передатчика отсутствует и вовсе
необязательно каждый раз перед началом передачи выдерживать
паузу.
    Если вы работаете с полудуплексным модемом с 4-проводной
линией связи, то вы можете ускорить обмен данными за счет
уменьшения времени ожидания включения передатчиков модемов и,
самое главное, за счет использования дуплексного быстрого
протокола передачи программы SFAST.EXE. Но следует иметь в
виду, что далеко не каждый модем рассчитан на работу по
4-проводке.
    Как правило, 4-проводными бывают только выделенные линии
связи. Поэтому ProCarry следует настраивать на 4-й тип
модема.
    Модемы, совместимые с Hayes, имеют тип 1 или 7 независимо
от того, используются они на выделенных или коммутируемых
линиях связи. Если линия связи 4-проводная, то настройка для
нее производится установкой перемычек в самом модеме,
ProCarry это никак не касается.


Подключение к выделенным линиям связи

   Если ProCarry используется на выделенной линии связи (или
на физической цепи) с обычными Hayes-модемами, то тип модема
все равно остается 1 или 7.
   Однако некоторые из Hayes-модемов имеют кнопку для
переключения в неинтеллектуальный режим (Dumb-режим). В этом
режиме модем перестает реагировать на команды и пытается
установить соединение автоматически. Если вы используете
такой модем, то для ProCarry указывается 4 тип модема, т.е.
неинтеллектуальный дуплексный модем.
   К стати, модемы в Dumb-режиме имеют возможность
автоматически набирать записанный в их память номер телефона.
Потеряв соединение, модем опять набирает номер, пока не
установит связь. Это уже не выделенный канал связи, но для
ProCarry нет никаких отличий и поэтому все равно
настраивается 4 тип модема.


Скорость передачи данных

    Скорость обмена должна соответствовать скорости модема.
Программа PROCRINS.EXE устанавливает скорость для каждого
стыка RS-232 отдельно, максимальная скорость может быть
115200 бит в секунду.
    На больших скоростях, превышающих 9600 бит/с, обычная
микросхема приемо-передатчика UART 8250 начинает делать
сбои. Совместимые с ней UART 82450 и все остальные, не
имеющие буфера для запоминания принятых знаков, также
работают не намного лучше.
    Выходом может служить использование UART, имеющих буфер
(FIFO) 16 байт для запоминания принятых знаков. Микросхемы с
FIFO значительно повышают максимальные скорости приема и
передачи информации. С их помощью ProCarry в состоянии
обслуживать на одном компьютере до 10 модемов на скоростях
38400 бит/с и даже выше.


Программное обеспечение

    Система ProCarry может использоваться со всеми наиболее
распространенными и популярными пакетами программ. Однако
недопустимо, чтобы прикладные программы пытались использовать
те же последовательные порты, что и ProCarry, это может
помешать работе программ телекоммуникации.
    Вы должны быть уверены, что все программы из вашего
пакета ProCarry одной версии. Кроме того, все компьютеры
одной сети должны использовать одну версию ProCarry, т.к.
разные версии системы могут использовать разные протоколы
обмена данными и сеть не сможет нормально функционировать.


Операционная система

    ProCarry работает с операционной системой MS-DOS версии
3.0 и выше или с любой операционной системой, совместимой с
MS-DOS. Для обслуживания нескольких последовательных портов
одновременно не требуются никакие программные оболочки,
создающие в среде MS-DOS многопользовательские или
многозадачные режимы работы.


Совместимость программного обеспечения

    При создании сети ProCarry на разных компьютерах сети у
вас могут оказаться различные версии операционной системы
MS-DOS. Хотя разные версии MS-DOS в основном совместимы между
собой и ProCarry совместим со всеми версиями MS-DOS, тем не
менее рекомендуем вам установить одну и ту же версию MS-DOS
на всех компьютерах сети. Версии MS-DOS, начиная с 4.00,
имеют возможность работать с разделами дисков, превышающими
32 мегабайта, а для младших версий это максимальный размер
одного тома дискового пространства. Если сателлит с версией
MS-DOS ниже, чем 4.00, попытается работать с файлом,
превышающим 32 мегабайта, возможны ошибки.


Создание рабочих копий дискетт

    Всегда будет полезно сделать несколько рабочих копий
ваших оригиналов дисков ProCarry. Оригиналы дисков будут
оставаться вашими резервными копиями.

ЧАСТЬ 3: НАСТРОЙКА PROCARRY


Главные модули ProCarry

    Пакет программ ProCarry включает три главных модуля -
PROCARRY.SYS, PROCRSRV.COM и SFAST.EXE. Все три модуля
находятся резидентно (т.е. постоянно) в оперативной памяти и
работают параллельно с выполняющейся в компьютере
программой. Остальные программы из пакета ProCarry используют
эти 3 модуля для организации связи.
    Для облегчения установки системы ProCarry на "жестком"
диске компьютера в пакет программ включена утилита
INSTALL.EXE.


PROCARRY.SYS

    Ведущий модуль пакета программ ProCarry - драйвер
PROCARRY.SYS. Этот драйвер содержит все программное
обеспечение, достаточное для создания локальных сетей
программным способом.
    В процессе работы PROCARRY.SYS не задает никаких вопросов
и не выдает никаких сообщений. Для пользователя работа
драйвера ничем не отличается от обычной работы с устройствами
операционной системы MS-DOS. Он добавляет к системе несколько
дисков и принтеров, которые на самом деле физически
отсутствуют в этом компьтере и расположены совершенно в
другом месте - в компьютере-сервере. Работа с этими дисками и
принтерами для пользователя ничем не отличается от работы со
стандартными дисковыми устройствами. Диски-сателлиты могут
служить для записи, чтения, удаления файлов и каталогов,
загрузки программ, чтения-записи секторов или записей в базах
данных и т.д. К сетевым принтерам обращение точно так, как и
к обычым, по именам PRN или LPT.
    Все программы MS-DOS работают с сетевыми дисками и
принтерами ProCarry точно так, как и с самыми обычными
устройствами компьютера. Те программы, которые вы раньше
использовали на своем компьютере, теперь точно так же можете
использовать и в работе уже с далеко находящимися от вас
ресурсами и для этого вам не потребуется вносить в них
никакие изменения. Для дисков существует лишь одно
ограничение: сетевой диск нельзя отформатировать.
    Работа сервера вообще незаметна для пользователя. На
время обращения сателлитов работающие на компьютере-сервере
программы не прерываются, разве только может быть, немного
замедляют работу из-за дополнительной загрузки процессора.
Благодаря этому ProCarry дает возможность вам из любой своей
программы осуществлять передачу или прием данных в другой
компьютер (или даже сразу в несколько), когда там в этот
момент продолжает свою работу совершенно произвольная
программа.


PROCRSRV.COM

    Сети ProCarry имеют многообразные возможности для
облегчения работы через коммутируемые телефонные линии.
Использование телефонных коммутаторов позволит вам
географически расширить свою локальную сеть на весь земной
шар. ProCarry и модем сделают доступной для любой из ваших
программ информацию, находящуюся за многие тысячи километров
от вас.
    Управление подключением абонентов к сети ProCarry
выполняет программа PROCRSRV.COM. Эта программа управляет
соединениями через коммутируемые телефонные линии и является
дополнением главного драйвера сети PROCARRY.SYS. Она, так же,
как и основной драйвер сети, находится резидентно в памяти и
поэтому доступна вам и каждой из ваших программ в любой
момент времени.
    PROCRSRV.COM, находящаяся в оперативной памяти,
инициируется к работе нажатием определенных клавиш на
клавиатуре или специальными командами MS-DOS. Задав
определенную операцию, можно выйти из PROCRSRV в прерванную
программу и продолжить основную работу, а PROCRSRV продолжит
выполнение команды уже самостоятельно.


SFAST.EXE

    Драйвер PROCARRY.SYS выполняет обмен информацией между
компьютерами, эмулируя для этого виртуальные диски MS-DOS.
Даже, если необходимо передавать целые файлы или группы
файлов, связь поддерживается с помощью дисковых операций
MS-DOS. Поэтому, хотя имеется множество полезных функций, нет
возможности организовать быстрый обмен файлами. Для того,
чтобы избавиться от этого недостатка, предназначен драйвер
SFAST.EXE. Этот модуль создает второй, ускоренный, протокол
связи ProCarry.
    SFAST.EXE не предоставляет такого разностороннего
сервиса, как PROCARRY.SYS, эмулирующий диски MS-DOS. Кроме
того, SFAST.EXE работает только с дуплексными модемами и
устройствами передачи данных. Но зато, сокращая
предоставляемый сервис, SFAST.EXE организовывает передачу
файлов между двумя компьютерами таким образом, что файлы
передаются в обе стороны одновременно. Скорость за счет этого
возрастает в 3-4 раза. В большинстве случаев, например, в
электронных почтах или электронных досках объявлений связь,
осуществляемая по протоколу SFAST.EXE, полностью
удовлетворяет всем потребностям.


Запуск ProCarry в работу

    Для запуска компьютера в сети ProCarry необходимо вызвать
и запустить в работу все главные модули сети. В отдельных
случаях допускается запускать не все 3 модуля, а только 2 или
даже один драйвер PROCARRY.SYS. Например, SFAST.EXE не нужен,
если не предполагается связь по ускоренному протоколу.
Драйвер PROCRSRV.COM может не понадобиться, если ProCarry
используется только для создания локальной сети без модемов и
коммутируемых линий.
    Главные модули ProCarry находятся в памяти резидентно.
Имеются возможности удаления модулей из памяти и освобождения
всех ресурсов, занимаемых ProCarry.


Запуск PROCARRY.SYS

    Драйвер ProCarry.SYS инициируется одновременно с MS-DOS и
вызывается через файл конфигурации операционной системы
CONFIG.SYS. При вызове драйвера не указываются никакие
параметры. Все параметры предварительно записываются в
драйвер PROCARRY.SYS программой настройки PROCRINS.EXE. Для
его вызова необходимо в файл CONFIG.SYS включить запись

         DEVICE = [путь] PROCARRY.SYS

где [путь] указывает местонахождение файла ProCarry.SYS.
Например,

         DEVICE = C:\PROCARRY\PROCARRY.SYS

загружает драйвер ProCarry из директории PROCARRY диска C:.


Загрузка драйвера PROCARRY.SYS как COM-файла

    Программа DEVLOAD.COM загружает драйвер PROCARRY.SYS так,
как будто это обычный COM-файл. Это дает возможность
загружать систему ProCarry не через CONFIG.SYS при старте
системы, а только в тот момент, когда необходимо начать
работу с каналами связи.
    Для загрузки драйвера необходимо выполнить команду

                  [путь] DEVLOAD

    Драйвер PROCARRY.SYS программа DEVLOAD.COM ищет на том же
диске и в той же директории, откуда она вызвана сама.
    По сравнению с загрузкой через CONFIG.SYS, запуск
драйвера PROCARRY.SYS как COM-файла имеет одно ограничение.
PROCARRY.SYS добавляет к операционной системе новые блочные,
т.е. дисковые устройства. При этом можно воспользоваться
только устройствами, зарезервированными при старте MS-DOS с
помощью команды LASTDRIVE= в CONFIG.SYS. Если же PROCARRY.SYS
загружается не как COM-файл, а как обычный SYS-драйвер через
CONFIG.SYS, то такого ограничения нет, так как MS-DOS сам
заранее распределит необходимое для ProCarry количество
дисков.
    Поэтому в CONFIG.SYS необходимо заранее с помощью команды
LASTDRIVE= зарезервировать число блочных устройств,
достаточное при загрузке PROCARRY.SYS. Например, если E: -
последнее устройство в системе без ProCarry и ProCarry
добавляет два новых диска, то в CONFIG.SYS нужна команда
LASTDRIVE=G. Если при загрузке драйвера с помощью DEVLOAD.COM
окажется, что для загрузки PROCARRY.SYS с помощью LASTDRIVE=
не зарезервировано достаточное число устройств, часть
коммуникационных дисков ProCarry не подключится.

    Если ProCarry не используется для создания локальной сети
и диски ProCarry не используются по их прямому назначению,
драйвер PROCARRY.SYS можно запустить, непосредственно указав
начальный диск ProCarry. Для этого программа DEVLOAD.EXE
стартует с одним параметром - именем начального диска. Имя
диска может быть от C: до Z:. Например,

                   DEVLOAD  T:

    Указывая конкретно коммуникационные диски ProCarry при
запуске DEVLOAD.EXE, необходимо следить за тем, чтобы они не
пересекались с другими дисками операционной системы.
    Если имя диска при старте DEVLOAD.EXE не задано, то
программа автоматически пытается взять нужные диски из числа
еще свободных разрешенных параметром LASTDRIVE= в CONFIG.SYS.
В этом случае ProCarry организовывает нормальные диски DOS, с
которыми могут работать любые программы как с самыми обычными
дисками.
    Если же при старте DEVLOAD.EXE указан начальный диск, то
диски ProCarry имеют некоторые особенности. Для большинства
программ и команд DOS они "невидимы" и они даже не
подозревают об их существовании. Но с ними все же можно
работать, используя заданные при запуске DEVLOAD.EXE имена.
    Запуск драйвера PROCARRY.SYS с указанием конкретного
имени диска при старте DEVLOAD.EXE, для большинства случаев
более предпочтителен. В этом случае исключаются различные
конфликты программ и операционной системы с коммуникационными
дисками ProCarry.


Запуск PROCRSRV.COM

    Поскольку программа управления коммутируемыми линиями
PROCRSRV.COM является дополнением главного драйвера сети
PROCARRY.SYS, то вызвать ее для работы можно только в том
случае, когда драйвер PROCARRY.SYS уже загружен через файл
CONFIG.SYS или с помощью DEVLOAD.COM. Программа PROCRSRV.COM
после запуска остается резидентной в памяти компьютера. Для
этого необходимо вызвать ее на выполнение без параметров или
с параметром /F или /G.

               [Путь] PROCRSRV  [Параметр]

    Эту команду можно включить и в файл стартовой загрузки
AUTOEXEC.BAT, но обязательно после запуска PROCARRY.SYS.
    Параметр, если он есть, при загрузке может быть только
/F (или /G). Этот параметр указывается с числом от 1 до 12
сразу вслед за буквой F. Параметр /F задается для указания
функциональной клавиши на клавиатуре (из диапазона F1 - F12)
для инициацииPROCRSRV. Если /F не задан, то по умолчанию для
входа в программу используется одновременное нажатие клавиш
Ctrl-Alt-F4. Если /F задан, то вместо F4 используется
указанная функциональная клавиша. Например,

            C:\PROCARRY\PROCRSRV  /F12

записывает PROCRSRV в оперативную память и предписывает
использовать для входа в ручной режим работы с PROCRSRV
комбинацию клавиш Ctrl-Alt-F12.
   Параметр /G аналогичен /F. Он задан номер функциональной
клавиши. Но /G кроме этого имеет еще одну функцию. Если он
задан, то при использовании компьютера в качестве сервера
связь с ним возможна только по протоколу SFAST. Вызов
программой PROCRUCS.EXE невозможен. Например,

            C:\PROCARRY\PROCRSRV  /G12

записывает PROCRSRV в оперативную память, предписывает
использовать для входа в ручной режим работы с PROCRSRV
комбинацию клавиш Ctrl-Alt-F12 и запрещает вызов сервера
программой PROCRUCS.EXE, оставляя только связь по протоколу
SFAST.EXE.


Запуск SFAST.EXE

    Драйвер SFAST.EXE для своей работы использует два других
резидентных модуля ProCarry - PROCARRY.SYS и PROCRSRV.COM.
Поэтому SFAST.EXE может быть загружена в память только после
запуска этих модулей.
    Для запуска SFAST.EXE выполняется команда

                  [Путь] SFAST

    Никаких параметров для старта SFAST.EXE не нужно. В
процессе работы SFAST.EXE никаких сообщений и запросов на
экран не выдает, а все результаты своей работы выводит в
журналы на диске.


LOAD.BAT и UNLOAD.BAT

    После перезаписи ProCarry на диск компьютера с помощью
программы INSTALL.EXE в главной директории ProCarry
появляется командный файл LOAD.BAT, содержащий все
необходимые команды для загрузки ProCarry в память.
    Как комментарий Rem в файл LOAD.BAT введена строка, с
помощью которой можно сделать все коммуникационные диски
ProCarry невидимыми для программ MS-DOS.

    Файл UNLOAD.BAT содержит команду для выгрузки ProCarry из
памяти и освобождения всех занимаемых системой ресурсов.


CONFIG.SYS

    Для установки сети ProCarry необходимо внести изменения в
файл конфигурации операционной системы CONFIG.SYS: включить
команду DEVICE= с вызовом драйвера сети PROCARRY.SYS и
настроить параметры загрузки операционной системы FILES= и
FCBS=. Если PROCARRY.SYS запускается с помощью DEVLOAD.COM,
то нужен еще и параметр LASTDRIVE=. Все остальные параметры и
команды в CONFIG.SYS не имеют значения для ProCarry.
    При настройке параметра FILES= в файле CONFIG.SYS следует
учитывать, что в количество открываемых файлов входят и
коммуникационные файлы. Параметр FILES= должен включать
суммарное максимальное количество файлов, которые
одновременно может использовать сам компьютер и все
подключенные к нему каналы связи. Обычно используется
параметр FILES=20. Поэтому рекомендуется использовать FILES=
с числом 20+20*N, где N - число каналов связи, подключенных к
компьютеру и обслуживаемых ProCarry.
    Точно также необходимо устанавливать и параметр FCBS= с
учетом подключенных каналов связи. FCBS= должен состоять из
суммарного максимального количества файлов, используемых
одновременно самим компьютером и подключенными к нему
абонентами. По умолчанию FCBS=4,0 для однопользовательской
системы, для каждого канала связи необходимо добавить
соответствующее число.


AUTOEXEC.BAT

    Операционная система MS-DOS и ProCarry имеют возможности
разделять доступ к одним и тем же файлам сразу между
несколькими пользователями одновременно. Это выполняется с
помощью программы SHARE.COM.
    Вызов программы SHARE.COM необходимо поместить в файл
AUTOEXEC.BAT на всех компьютерах, где предполагается
использовать ProCarry.


Выгрузка ProCarry из оперативной памяти

    Для выгрузки ProCarry используется команда

                  [Путь] PROCRSRV  /U

Эта команда выгружает одновременно все драйверы системы
ProCarry: PROCARRY.SYS, PROCRSRV.COM и SFAST.EXE. Для того,
чтобы выгрузка драйверов происходила успешно, необходимо
выполнять некоторые требования:
   - драйвер PROCARRY.SYS должен быть загружен с помощью
программы DEVLOAD.COM, а не через CONFIG.SYS;
   - после драйвера PROCARRY.SYS в память обязательно должна
быть загружена программа PROCRSRV.COM;
   - между PROCARRY.SYS и PROCRSRV.COM в памяти не должно
быть никаких других резидентных программ;
   - PROCRSRV.COM перед выгрузкой должна быть последней
резидентной программой, загруженной в оперативную память,
если не используется драйвер SFAST.EXE;
   - если используется драйвер ускоренной связи SFAST.EXE, то
он должен быть загружен после драйвера PROCRSRV.COM; драйвер
SFAST.EXE должен быть последней резидентной программой в
памяти и между SFAST.EXE и PROCRSRV.COM не должно быть
никаких других резидентных программ.
    Если все эти требования выполнены, то ProCarry
освобождает занимаемую ею оперативную память, восстанавливает
в исходное состояние векторы прерываний и все буферы DOS.

    ProCarry может быть инсталлирована, а затем удалена из
памяти любое число раз, перезагрузка операционной системы при
этом не требуется.


Отключение коммуникационных дисков ProCarry

    Коммуникационные диски ProCarry можно сделать невидимыми
для операционной системы. Это дает возможность использовать
без проблем некоторые программы, которые в своей работе
пытаются обратиться ко всем дискам, которые определены в
операционной системе. В некоторых случаях эти программы
конфликтуют с ProCarry.
    Если коммуникационные диски ProCarry сделать невидимыми,
то они недоступны для операционной системы, однако работа
абонентской программы электронной почты PROCRUCS.EXE при этом
не нарушается.
    Диски ProCarry можно делать невидимыми только в том
случае, если коммуникационные диски - последние в DOS. Для
этого команда DEVICE= с вызовом PROCARRY.SYS должна быть в
CONFIG.SYS последней или драйвер должен быть загружен с
помощью DEVLOAD.COM.
    Для отключения коммуникационных дисков необходимо выдать
команду
                  [Путь] PROCRSRV  /I

Для того, чтобы опять сделать виртуальные коммуникационные
диски доступными из DOS, необходимо выполнить

                  [Путь] PROCRSRV  /V


Отключение сообщений об ошибках коммуникационных дисков

    Если при работе с коммуникационными дисками возникает
сбойная ситуация, драйвер ProCarry выдает на экран сообщение

      Not ready error reading (или writting) drive x

С клавиатуры компьютера необходимо ввести знак A (прервать
работу программы), R (повторить операцию) или F (завершить
дисковую операцию с ошибкой, но продолжить выполнение
программы).
    Имеется возможность отменить вывод на экран сообщений об
ошибках. Тогда в случае сбоя выполнение программы
продолжается автоматически, а дисковая операция завершается с
ошибкой; это соответствует той ситуации, когда на клавиатуре
компьютера нажимается клавиша F (Fail).
    Разрешение или запрещение вывода сообщений на экран для
каждого из каналов связи выполняется отдельно.
    Для отключения вывода сообщений на экран выполняется
команда
                  [Путь] PROCRSRV  /Nx

где x - номер канала.
    Команда
                  [Путь] PROCRSRV  /Mx

указывает выводить сообщения на экран в случае сбоев в канале
связи x.

    Примеры.
    Отключить вывод сообщений на экран для 1-го канала

           c:\procarry\procrsrv /n1

    Включить вывод сообщений на экран для 0-го канала

           c:\procarry\procrsrv /n0


Настройка драйвера сети с помощью программы PROCRINS.EXE

    Драйвер сети PROCARRY.SYS при запуске операционной
системы стартует с уже заданными заранее параметрами и до
самого сброса операционной системы или выгрузки ProCarry из
памяти эти параметры не изменяются. Чтобы изменить
конфигурацию вашей сети, необходимо программой PROCRINS.EXE
перенастроить драйвер сети PROCARRY.SYS и затем перезапустить
ProCarry.
    При вызове программа PROCRINS.EXE может иметь параметры.

 [Путь] PROCRINS   [Путь поиска драйвера сети] [/x-,,,]

    Первый параметр указывает, где искать драйвер сети
PROCARRY.SYS. Задается путь поиска по правилам операционной
системы MS-DOS, само имя файла PROCARRY.SYS при этом не
указывается. Путь поиска всегда располагается первым среди
параметров. Например,

       C:\PROCARRY\PROCRINS.EXE  C:\PROCARRY

Если параметр поиска при вызове не задан, то по умолчанию
используется текущий каталог текущего диска.


Настройка канала связи в командном режиме

    Все данные для настройки одного канала связи можно задать
при вызове PROCRINS.EXE через параметр  /x-,,,  Здесь x
означает цифру - порядковый номер настраиваемого порта
RS-232. Под этим номером система ProCarry выполняет все
операции с каналом связи - портом RS-232. Нумерация каналов
связи может быть произвольной и она никаким образом не
связана с физической адресацией портов в компьютере.
Нумерация каналов связи начинается с 0 и максимально может
быть 9-й номер - всего ProCarry поддерживает до 10 портов
RS-232.
    Если порядковый номер порта x совпадает с уже настроенным
ранее номером RS-232, то PROCRINS.EXE произведет замену
данных старой настройки новыми параметрами. Если же
настроенного порта с таким порядковым номером еще не было, то
в драйвер PROCARRY.SYS добавляется настройка для нового
порта. Но следует помнить, что будет добавлен новый порт не с
тем номером x, который вы указали в параметре /x-, а со
следующим по порядку в драйвере PROCARRY.SYS. Например, если
ранее PROCARRY.SYS был настроен на 2 порта, то /1- будет
означать замену данных для 2-го канала связи, а /8- добавит
новый, 3-й по счету, канал связи и его номер будет 2-м.


Параметры настройки канала связи

    Сразу же вслед за /x- следуют данные для настройки канала
связи. Эти данные следуют в строке один за другим и
отделяются друг от друга запятыми. Если при перенастройке
порта какой-либо параметр нужно оставить прежним, то он
пропускается и вместо него ставится запятая, если же такой
параметр в конце строки, то запятая не нужна. Всего 15
параметров:
    - тип порта или драйвера INT14. В обычных случаях тип
порта должен быть равен 0 или 1. Значения, начиная с 2-х,
означают различные драйверы, использующие прерывание BIOS
INT14 (в этих случаях IRQ и Мультипорт должны быть не
заполненными, а значение в графе Скорость хотя и должно быть
проставлено, но оно тоже будет игнорироваться).
    - Номер линии прерывания IRQ, число от 0 до 15.
    - Адрес порта RS-232. Адрес задается трехзначным
шестнадцатиричным числом или в виде COM1, ..., COM4. Для
портов COM1 - COM4 можно указать номер IRQ равным 0, тогда
программа автоматически проставит номер IRQ равный 4 для COM1
(COM3) и 3 для COM2 (COM4). Для всех остальных адресов портов
номер IRQ проставляется обязательно ненулевой.
    Если тип порта не равен 0 или 1, т.е. используется
драйвер INT14, то в этой графе записывается номер канала BIOS
INT14 (от 0 до 3fh).
    - Скорость передачи. Задается число в пределах от 50 до
115200 Бод. Если проставляется скорость 0, то это означает
удалить строку настройки порта.
    - Тип модема. Задается цифра от 1 до 9. Подробно о типах
модемов можно посмотреть в Части 2 настоящего руководства.
    - Строка для инициализации модема (эта графа используется
только для 1 и 7 типа модемов, в остальных случаях она
игнорируется);
    - Адрес регистра прерываний на 4-портовой плате Multi
Port (или на сдвоенной 8-портовой). Эта графа используется
только для карт устаревшего типа, имеющих специальный адрес
регистра прерываний, во всех остальных случаях графа должна
быть незаполненной.
    - Номер порта на 4-портовой плате Multi Port. Задается
цифра 8, означающая, что порт находится на карте Multi Port и
может разделять одинаковый IRQ с другими портами на этой же
карте.
    Для некоторых мультипортовых карт устаревшего типа в этой
графе ставится цифра от 1 до 4 - номер порта на карте. В этом
случае должна быть обязательно заполнена и графа адреса
регистра прерываний.
    - Число минут задержки сеанса связи SFAST после передачи
и приема всех файлов. Если у абонента число минут равно 0, то
задержки нет и сеанс завершается сразу же после окончания
обмена. На сервере число минут задержки означает максимально
допустимое время, на которое можно задержать сеанс связи SFAST.
    На выделенных каналах связи рекомендуется использовать
значение 63 минуты (настроить это необходимо и у абонента, и
на сервере). В этом случае сеанс связи не будет прерываться
вообще до тех пор, пока модем не потеряет несущую или не
будет дана команда отбоя с клавиатуры.
    - Начальный диск сервера. Это начальный диск диапазона
дисков, предоставляемых вашим компьютером в распоряжение
сетевых пользователей.
    - Количество дисков сервера, предоставляемых в
распоряжение сети.
    - Начальный диск сервера. 2-й диапазон.
    - Количество дисков сервера, предоставляемых в
распоряжение сети. 2-й диапазон.
    - Начальный диск сервера. 3-й диапазон.
    - Количество дисков сервера, предоставляемых в
распоряжение сети. 3-й диапазон.
    - Количество дисков сателлитов. Это те диски в чужих
компьютерах, которые ваш компьютер через сеть присоединяет к
себе. Нумерация этих дисков начинается сразу же вслед за
последним диском в вашем компьютере. Число дисков-сателлитов
для отдельного порта может быть равно 0, но в целом для всего
PROCARRY.SYS хотя бы один диск-сателлит должен
присутствовать.
    - Номер начального LPT сетевого принтера-сателлита. Если
вы обратитесь к этому номеру LPT, то ProCarry через сеть
передаст данные сетевому принтеру-серверу. Нумерация LPT
может начинаться с 1. MS-DOS поддерживает всего не более 3
принтеров.
    - Количество сетевых принтеров-сателлитов. В сумме с
номером начального LPT принтера-сателлита это число не может
превышать 3.
    Все три диапазона задания дисков-серверов равнозначны,
они необходимы для удобного распределения дисков,
предоставляемых в распоряжение сети. Например, B,1,c,2,f,1
указывает предоставить в сеть диски B:, C:, D:, F:.
    Примеры.

     PROCRINS E:\PROCARRY /9-1,0,COM1,9600,7,,,,,C,3,,,,,1
     procrins  /0-,,,9600,7,AT&FE0,,,2
     procrins  /0-,9,120,115200,3,,,8,,c,1,e,1,,0,0,2,1
     procrins  /0-,9,2a0,9600,3,,2bf,1,,c,1,e,1,,0,0,2,1

    За один вызов PROCRINS.EXE через командную строку может
быть настроен только один канал связи, т.е. в строке может
быть только один параметр /x-,,, . Если необходимо настроить
несколько каналов связи, то можно несколько раз вызвать
PROCRINS.EXE с параметром /x-,,, или выполнить настройку в
ручном режиме.
    Настройка сетевых принтеров-серверов производится только
в ручном режиме PROCRINS.EXE.


Настройка плат Multi Port

    ProCarry требует, чтобы каждый последовательный порт имел
свою отдельную линию прерывания IRQ (на самом деле, это не
ограничение ProCarry, а особенности аппаратного построения
IBM-совместимых компьютеров). Однако, это требование
необязательно, если используется специальная карта Multi Port
Serial. В этом случае на одной шине прерывания IRQ может
находиться до 4 последовательных портов.

   Если используется мультипортовая карта, то в графе "Номер
порта" карты Multi Port нужно поставить значение 8. В этом
случае ProCarry знает, что разные порты используют одинаковые
линии IRQ.

   Для некоторых карт Multi Port устаревшего типа при
настройке обязательно задаются адрес регистра прерываний и
номер порта. Все строки настройки портов с одинаковым адресом
регистра должны обязательно содержать одинаковый номер
прерывания IRQ и разные номера портов в диапазоне от 1 до 4.


Настройка нескольких модемов на одной линии IRQ

    Некоторые типы внутренних модемов имеют возможность
работать на одной линии IRQ и не мешать друг другу. Кроме
того, некоторые платы расширения, в частности, ProCarry
MultiPort Serial 4, могут выводить сигналы от всех портов
RS-232 на одну линию IRQ.
    ProCarry имеет возможности работы с такими платами и
модемами. Для этого в строке настройки каждого канала,
совмещающего одну линию IRQ с другими каналами, в графе номер
порта платы Multi Port долна стоять цифра 8. Эта цифра, с
одной стороны, указывает, что канал разделяет шину IRQ с
другим каналом, с другой стороны, отличает этот порт RS-232
от порта на плате Multi Port. Платы Multi Port, имеющие
регистр прерываний, отличаются от стандартных RS-232 и
поэтому для них необходимо задавать номер порта цифрами от 1
до 4 и регистр прерываний.
    Количество портов и модемов в группе, использующих одну
одинаковую линию IRQ, не может превышать 4. Поэтому число
каналов, имеющих цифру 8 в графе номер порта и одинаковый
номер IRQ, не может быть больше 4. Однако может быть
несколько таких групп. Например, допустима настрока двух карт
Multi Port, в каждой из них по 4 порта RS-232, подключенных к
шинам IRQ3 и IRQ4.
    Следует быть особенно осторожными при подключении модемов
и портов RS-232 к одинаковым шинам IRQ. Далеко не все из них
позволяют это сделать. В случае возникновения затруднений,
обратитесь к своему дилеру для консультаций.


Ручной режим настройки

    Если при вызове PROCRINS.EXE не задавать параметр /x- ,
то программа войдет в ручной режим настройки. В ручном режиме
настраивается сразу любое число портов RS-232. При входе в
программу главное окно предназначено для инсталляции тех же
15 параметров, которые можно настроить и в командном режиме
PROCRINS.EXE. Второе окно служит для настройки сетевых
принтеров-серверов. Если вам по каким-либо причинам
потребуется изменить данные настройки модемов, то это можно
сделать после нажатия клавиши F2.
    Программа PROCRINS.EXE имеет достаточно подробные
текстовые подсказки. Для вызова Help необходимо после вызова
PROCRINS.EXE нажать F1.


Настройка программы PROCRSRV.COM

    После инсталляции ProCarry на дисках вашего компьютера
появляются командные файлы, содержащие все необходимые
команды для набора номера и установления соединения с
сервером почты. Автоматически генерируются также командные
файлы для перевода компьютера в режим ожидания соединения
(хостовой режим). Все параметры программы PROCRSRV.COM в этих
файлах каждый раз перенастраиваются заново и начальные их
значения не играют никакой роли.
    Тем не менее, программа PROCRSRV.COM имеет специальный
режим для постоянного сохранения всех параметров настройки.
Если выполнить команду

              [Путь] PROCRSRV.COM  /S

то все текущие параметры настройки будут записаны в саму
программу PROCRSRV.COM. После этого при всех последующих
перезапусках ProCarry автоматически будут восстанавливаться
текущие параметры настройки PROCRSRV.COM.
    Если вы имеете в разных директориях несколько копий
программы PROCRSRV.COM, то необходимо, чтобы при ее вызове с
ключом /S путь доступа указывал именно на ту копию программы,
в которой вы хотите сохранить параметры.

ЧАСТЬ 4: РАБОТА С ЛИНИЯМИ СВЯЗИ


    Программа PROCRSRV.COM управляет соединениями компьютеров
через коммутируемые и выделенные линии связи и выполняет все
необходимые для этого вспомогательные действия. Предусмотрено
несколько различных вариантов установления соединения.
Имеются возможности проверки имен подключающихся абонентов,
задания паролей, управления доступом к различным ресурсам
серверов сети, ведения журналов и накопления статистики
работы.
    Данные об абонентах записаны в специальные справочники и
содержат все необходимые сведения для набора номера абонента
и его вызова, а также все сведения для приема вызова от
абонентов.


Процедура установления соединения двух абонентов

    Установить соединение могут два абонента, один из которых
находится в пассивном состоянии ожидания вызова (входящее
соединение), другой, активная, вызывающая сторона, набирает
его номер телефона (исходящее соединение).


Процедура идентификации

   Для исключения ошибочного или несанкционированного доступа
предусмотрена процедура идентификации. Оба компьютера
обмениваются несколькими строками данных, с помощью которых
они могут проверить правильность соединения, обменяться
своими именами и паролями и, соответственно, определить
возможности доступа к различным ресурсам друг друга.
    После установления соединения пассивный, ожидающий вызова
компьютер посылает в линию строку - свои позывные, в ответ на
который вызывающий компьютер посылает свое имя. Вызванный
компьютер проверяет это имя и, если он разрешает подключиться
к сети, посылает вызвавшему абоненту строку - подтверждение.
После этого оба компьютера считаются соединенными в сеть и
могут использовать ресурсы друг друга - диски и принтеры, или
передавать друг другу файлы электронной почты.

      Абонент Б                            Абонент А
Сторона, пославшая вызов           Cторона, принявшая вызов
-.-.-.-.-.-.-.-.-.-.-.-.-          -.-.-.-.-.-.-.-.-.-.-.-.-
        Связь установлена (сообщение модемов CONNECT)
       -----------------------------------------------

                                    Передача запроса имени
                                          (позывные)
 Проверяет позывные <─────────────────────────┘
     абонента А
         │
Передает свое имя и
   идентификатор
         └───────────────────────> Получает идентификатор и
                                          читает имя
                                              │
                                  Проверяет имя в справочнике
                                              │
                                      Передает разрешение
                                       подключения к сети
Принимает разрешение  <───────────────────────┤
подключения к сети                            │
         │                            Подключается к сети с
Подключается к сети с                шифро-паролем, считанным
заданным с шифро-паролем                  из справочника


Шифро-пароль

    Подключаясь к сети, оба компьютера устанавливают у себя
шифро-пароли.
    Пароль служит для шифрования информации, посылаемой в
канал связи. Шифро-пароль не используется для того, чтобы
определить разрешен или нет доступ к тем или иным ресурсам,
но тем не менее он надежно предохраняет абонентов от
несанкционированного доступа. Обе станции будут одинаково
кодировать - декодировать данные, если они одинаково задали
шифро-пароли. Если шифро-пароли не совпадают на обоих концах,
то, хотя формально связь между абонентами и существует, они
не смогут понять друг друга, т.к. кодируют по-разному
информацию, посылаемую в линию.
    Шифро-пароль через канал связи не проходит, поэтому, даже
имея аналогичное оборудование и программы, невозможно
расшифровать информацию, "подслушанную" в канале связи, не
зная точно шифро-пароля.
    Таким образом, PROCRSRV.COM осуществляет двухступенчатую
защиту: невозможно войти в сеть, не зная идентификатора и
правильного имени, но даже имея эти данные без шифро-пароля
невозможно работать в сети.
    Все данные об абонентских станциях, необходимые как для
проверки подключающихся абонентов, так и для вызова станций
через коммутируемые линии связи можно занести в справочники.
Поэтому процедуры установления соединения и проверок не могут
вызвать особенных трудностей, но зато надежно защитят вашу
сеть от постороннего вмешательства.


Идентификация со стороны вызванной станции

    Получив сигнал о вызове вызываемый абонент отсчитывает
заранее запрограммированное количество звонков и подключается
к линии. Модемы устанавливают между собой контакт и выдают
сообщение CONNECT.
    После этого вызванный (находившийся до этого в состоянии
ожидания) компьютер запрашивает имя подключившегося абонента.
Запрос имени одновременно играет роль позывных или, иначе
говоря, автоответчика вызванной станции. Позывные посылаются
в линию несколько раз и каждый раз в течение определенной
паузы ожидается имя вызвавшей станции. Если имя так и не
будет получено, то станция отбивается и опять устанавливается
в состояние ожидания. Длительность паузы и количество
запросов имени легко перенастраиваются в зависимости от
потребностей пользователей.
    Имя вызывающей станции состоит из определенной строки -
идентификатора и собственно имени. Идентификатор имени
заранее программируется и используется вызванной станцией для
определения месторасположения абонентского имени в
принимаемой от подключившейся станции последовательности
знаков. Этот идентификатор одновременно является ключом в
попытке войти в связь с вызванным абонентом.
    Вызванная станция, получив идентификатор с именем
подключившегося абонента, в справочнике отыскивает это имя и
считывает шифро-пароль этого абонента. После этого новому
абоненту разрешается подключиться к сети со считанным из
справочной карты пользователя шифро-паролем. В линию
посылается строка с подтверждением о разрешении подключиться
к сети.
    Если имя в справочнике не найдено, то это означает
запрещенную попытку подсоединиться, вызванная станция делает
запись в журнале и отключается.
    Если справочник входящей связи не задан (состояние off),
то подключение разрешено любому абоненту, шифро-паролем
служит само имя абонента.


Идентификация со стороны вызывающей станции

    Вызывающий абонент, набрав номер и получив сообщение
CONNECT от модема, принимает и сравнивает позывные вызванной
станции.
    Выловив из последовательности знаков, принимаемых от
вызванной станции, строку - позывные (автоответчик) вызванной
станции, вызывающий компьютер посылает в линию свое
абонентское имя вместе с определенной строкой -
идентификатором, которую распознает вызванная станция.
    Далее вызывающая станция начинает ожидать подтверждения
о разрешении подключиться к сети.
    Если вызывающая станция получает разрешение, то она
подключается к сети. Устанавливается заранее записанный
шифро-пароль. Если шифро-пароли на разных концах не совпадут,
то работа сети невозможна.
    Если после определенного промежутка времени подтверждение
о подключении к сети не получено, то свое имя посылается в
линию еще несколько раз. Если и после этого нет подтверждения,
происходит отбой.


Команды установления соединения в зависимости от типа модемов

    ProCarry имеет несколько различных команд для
установления соединения двух абонентов в зависимости от типа
модемов и от того, коммутируемые линии связи или
некоммутируемые. С помощью этих команд можно реализовать
любые варианты установления связи в зависимости от конкретных
потребностей.


Коммутируемые линии связи

    Если вы используете модемы с автонабором номера,
например, модемы с AT-командами Хейза, то для того, чтобы
установить связь со стороны активной, вызывающей станции,
необходимо нажать одну из клавиш F7, Ctrl-F9, Alt-F2 или
Alt-F6 - набрать номер телефона и проверить идентификаторы.
Со стороны пассивной, ожидающей вызова станции, перед этим
нажимается клавиша F4 - ожидать вызовы со стороны
коммутируемой линии связи.
    В некоторых случаях возникает необходимость набрать номер
телефона вручную (или вызов происходит через телефонистку) и
только затем подключить модем. Тогда сохраняется прежний
порядок - один компьютер находится в состоянии ожидания
вызова после команды F4, а на другом, после того, как в
телефонной трубке будет слышен сигнал модема, выдается
команда F7 или Alt-F2. Но вместо номера телефона в параметрах
команды F7 или Alt-F2 задается указание модему сразу
включиться в вызывном режиме ATX3D.
    Для модемов типа V.23, не имеющих возможности автонабора
номера, предусмотрена отдельная процедура подсоединения к
сети. Вызываемая станция находится в состоянии ожидания
вызова после нажатия F4. Вручную набирается ее номер телефона
и после подсоединения в трубке телефона прослушивается сигнал
запрос идентификатора - позывные вызванной станции. После
этого нажимается клавиша F6 - проверить идентификаторы и
подключиться к сети и кладется трубка телефонного аппарата.
Дальше происходит процедура идентификации и присоединения к
сети, описанная в предыдущем разделе.


Некоммутируемые линии связи

    Связь на некоммутируемых линиях также имеет различия в
зависимости от типа используемых модемов.
    Если вы пользуетесь модемами Хейза, то на пассивном,
ожидающем вызовы компьютере выдается команда Shift-F6. Эта
команда аналогична команде F4 для коммутируемых линий, однако
вместо ожидания звонков по ATS0=  указывается ATA -
подключиться к линии связи в ответном режиме. Компьютер
находится в состоянии ожидания непрерывно. Как только на
другом конце линии подключится другой модем, сразу же будет
запущена процедура идентификации, как после приема звонка на
коммутируемой линии связи. Второй, вызывающий абонент выдает
команду F7 или Alt-F2, но вместо строки с номером телефона в
параметрах записывается ATX3D. После отбоя связи пассивный
абонент опять перейдет ожиданию вызова.
    Для модемов V.23 процедура работы с выделенными каналами
связи аналогична, только пассивный абонент выдает команду
Shift-F4, а вызывающий - F6.


Облегченные процедуры установления соединения

    Предусмотрены дополнительные несколько облегченные
варианты для установления соединений. В дополнительных
процедурах проверок идентификаторов и позывных нет.
    Инициация облегченных процедур производится на
вызывающем компьютере командой Shift-F7, а на вызываемом -
командой Shift-F5.
    Вызывающая станция, дав модему набрать номер и дождавшись
соединения, сразу подключается к сети. Вызванная станция
также сразу же после установления соединения подключается к
сети.
    Абоненты должны сами проследить за установлением
одинаковых шифро-паролей (или в этом случае можно стереть
шифро-пароли - но на обоих станциях).


Подключение к сети после разговора по телефону голосом

    Возможен вариант включения сети после разговора по
телефону. Абоненты сначала устанавливают контакт между собой
по телефону голосом и затем одновременно выдают команду
включения сети F3. Предварительно следует договориться и
установить соответствующие шифро-пароли.
    В целом процедура связи при таком варианте выглядит
следующим образом. Абоненты оба дают команду F1 отключиться
от линии, если это не было сделано ранее. Устанавливается
связь голосом и абоненты договариваются о шифро-пароле и
устанавливают его по Ctrl-F10. Если модемы с AT-командами, то
в режиме F8 Диалог один из абонентов вводит команду для
перехода модема в On-Line вызывном режиме, например, ATX3D, а
другой переводит свой модем в On-Line в ответном режиме,
введя ATA. Получив сообщение CONNECT, оба подключаются к
сети, нажав F3.
    ProCarry предоставляет и другие варианты установить связь
вручную, если используются модемы Хейза. Например, оба
абонента выдают команду Shift-F7. При этом один из них в
строке команды для модема указывает параметр ATA, другой -
ATX3D.
    Если модемы V.23, то сразу же после соединения и
разговора по телефону из состояния отбой дается команда F3,
вход в режим Диалог не нужен.


Установление соединения вручную в режиме терминала

    Возможен вариант управления соединением из состояния
F8 Диалог. В этом состоянии можно управлять модемом с
AT-командами вручную. Можно вызвать находящуюся в ожидании
станцию и после соединения, увидев ее позывные, нажать F6 или
Alt-F5 - команды проверки идентификаторов без набора номера.


Коды команд для набора номера модемом

    Система ProCarry поддерживает все модемы с автонабором
номера телефона. Данные для набора номера переписываются в
модем и далее он сам устанавливает соединение. Большинство
модемов управляется с помощью AT-команд Хейза, поэтому
приведем здесь коды Хейза, необходимые для набора номера
телефона. Эти коды эффективны не только для интеллектуальных
дуплексных модемов типа 1 или 7 (модемов Хейза), но и для
модемов V.23 типа 2, 5 и 6, если они оборудованы специальным
вызывным прибором. Полный список кодов и команд приводится в
описании вашего модема.
    Всем командам Хейза вначале строки обязательно
предшествует комбинация знаков AT. Сразу вслед за ними в
строке располагаются коды команд. Код набора номера D. Эта
команда инструктирует модем снять трубку и набирать цифры,
которые следуют в строке вслед за ней. Команда D - набор
номера - может быть модифицирована некоторыми символами и
буквами. Приведем некоторые, имеющие важное значение для
ProCarry.
    P - инструктирует модем осуществлять набор номера в
импульсном режиме.
    T - набор номера частотным способом.
    W - указывает модему сделать паузу в наборе номера до тех
пор, пока не появится гудок - сигнал станции. Параметр
необходим при выходе в междугороднюю сеть. Если гудок не
появится, через некоторое время модем "положит трубку" и
прекратит набор номера.
    0-9 - цифры набираемого номера телефона.
    , (запятая) - указывает модему сделать паузу 2 сек, а
затем продолжить набор номера.
    / - пауза длительностью 1/8 сек.
    ! (восклицательный знак) - "положить трубку" на 1/2 сек.
    Кроме того, большинство модемов распознает знаки R ; @
как служебные. Все остальные буквы и знаки после команды D до
конца строки модемом пропускаются и могут служить для
удобства разделителями в номере телефона.
    Например,
               AT DP 8-W-(095)012-3456

означает снять трубку телефона и, услышав гудок, набрать
цифру 8 - выход на междугороднюю АТС. После того, как
появится гудок - разрешение набора, набирается номер
0950123456 и ожидается соединение с вызванным абонентом.


Управление доступом к ресурсам вызванных станций

    Система Procarry предоставляет большие возможности для
разделения доступа к ресурсам серверов. Каждому абоненту
могут быть выделены только определенные области на дисках
серверов и различные возможности использования этих областей.
    Выделение ресурсов производится станцией-сервером при
приеме ею вызова со стороны коммутируемой телефонной линии.
Приняв вызов и прочитав имя подключившегося абонента, в
справочнике отыскивается карта этого пользователя. Из карты
абонента определяется шифро-пароль и список директорий, к
которым разрешен доступ этому абоненту.
    Директории для использования подключившимися абонентами
могут быть любыми на сетевых дисках. При этом эти каталоги
не обязательно должны быть субдиректориями корневого
каталога. Можно, например, задать доступ к директории, но
запретить обращения к главным по отношению к ней каталогам.
Имеется только одно единственное ограничение - длина имени
каталога не может превышать 63 знака.
    Подключившийся абонент всегда имеет доступ к корневым
каталогам всех предназначенных для использования в сети
дисков вызванной станции. Код доступа к корневым каталогам -
0, т.е. только чтение файлов в корневой директории. Код
доступа к корневому каталогу можно изменить, указав его
непосредственно в карте пользователя с нужным кодом доступа.
    Если канал связи настроен для проверки всех
подключившихся абонентов по справочнику и в списке не указана
ни одна директория, то абоненту предоставляются только
корневые каталоги всех дисков сервера, которые выделены в нем
для использования в сети, причем разрешено только чтение в
этих директориях.
    ProCarry предоставляет гибкие возможности для управления
доступом. Имеются возможности использовать только саму
директорию, но можно задать использование директории и всех
ее субдиректорий. Можно задавать только чтение файлов или
только запись файлов в директорию. Можно разрешить или
запретить удаление или переименовывание файлов. Возможность
записи файлов в директорию с запретом чтения ее каталога
может быть полезна при организации "электронных" почт. Для
работы "электронных почт" предусмотрены еще и специальные
коды доступа.


Коды доступа к директориям вызванных станций

    Кодами доступа к директориям могут быть только цифры от 0
до 9 и латинские буквы A, B и C. Если код доступа не задан,
то к директории нет доступа.
    Коды от 0 до 3, 9 и буквы A, B, C разрешают доступ только
в саму директорию. Если заданы коды от 4 до 8, то операции
разрешены в самой директории и во всех ее субдиректориях.
    Латинскими буквами A, B, C определяются директории
электронной почты IN (для приема файлов от абонента), SEND
(для передачи файлов абоненту) и COMMON (для передачи файлов
разным абонентам - общего доступа). Для каждого абонента в
сервере могут быть определены только по одной директории
почты с кодами A, B, C.
    Директории с кодом доступа A, B, C не должны содержать в
имени знак # - этот знак используется как служебный.

  0   Только чтение файлов в директории.
  1   Только запись файлов в директорию.
  2   Только чтение и запись файлов в директорию.
  3   Все операции с файлами в директории.
  4   Только чтение файлов в директории и во всех ее
      субдиректориях.
  5   Только запись файлов в директорию и во все ее
      субдиректории.
  6   Только чтение и запись файлов в директорию и во
      все ее субдиректории.
  7   Все операции с файлами в директории и во всех ее
      субдиректориях.
  8   Все операции с файлами в директории и во всех ее
      субдиректориях и удаление/создание субдиректорий.
  9   Только запись файлов в директорию и запрещена выдача
      каталога директории.
  A   Директория "электронной почты" для приема файлов от
      абонента; разрешена только запись файлов в директорию,
      т.е. соответствует коду 1.
  B   Директория "электронной почты" для передачи абоненту
      файлов с его личной корреспонденцией; разрешены все
      операции с файлами в директории, т.е. соответствует
      коду 3.
  C   Директория "электронной почты" для передачи абоненту
      файлов из списка общего доступа; в этой же директории
      находится файл - список с комментариями; разрешено
      только чтение файлов из субдиректорий, т.е.
      соответствует коду 4.


Справочники

    Чтобы установить соединение между двумя абонентами,
необходимо, чтобы оба из них знали такие сведения, как номера
телефонов, позывные, шифро-пароли и др. Вся информация для
набора номеров телефонов и вызова абонентов, а также для
приема вызова от абонентов, проверки их паролей и определения
степени их доступа к ресурсам вызванных компьютеров
записывается в специальные справочники. Системе PROCARRY для
работы с коммутируемыми линиями связи требуется два вида
справочников: отдельно для входящих и исходящих соединений.
    Справочники представляют собой директории, состоящие из
отдельных файлов - карточек пользователя. Файлы - карты
пользователей имеют расширение .PCR и создаются или
изменяются с помощью специальной программы - PROCMAIL.EXE или
SCRIBERS.EXE.
    Имя пользователя - до 8 знаков, является именем файла.
Каждому пользователю соответствует одна или несколько карт.
Карты пользователей используются при исходящей связи для
определения параметров вызываемого абонента и при входящей
связи для проверки подключающегося абонента и выделения ему
соответствующих ресурсов на дисках. Одна карта пользователя
содержит различные данные, часть из которых используется при
входящем соединении, а другая часть - при исходящем.
    Одна карта пользователя может быть использована во всех
случаях - как при вызове этого пользователя, так и, наоборот,
при приеме вызова от него. Однако можно для одного
пользователя иметь и несколько различных карт - отдельно для
его вызова и для приема вызова от него. Справочные директории
для исходящей связи (т.е. для набора номера и вызова других
абонентов) и для входящей связи (т.е. для ожидания
подключений других абонентов) задаются в программе
PROCRSRV.COM отдельно и могут иметь различные имена. Можно,
разумеется, и объединять справочные директории в одну.
    Каждый канал связи, управляемый ProCarry, может иметь
свои отдельные справочники, но можно их объединять.


Карта пользователя

     Карта пользователя представляет собой текстовый файл,
имя которого - имя абонента коммутируемой сети связи, а
каждая строка самого файла - отдельная графа карты абонента.
Карты пользователей можно редактировать с помощью любого
текстового редактора, однако имеется специальная утилита
PROCMAIL.EXE, значительно облегчающая их обработку.
    Список всех граф карты пользователя приводится в таблице.
Имя абонента не содержится как строка файла, оно является
именем самого файла (расширение имени - .PCR).
    Графа "Примечания" системой ProCarry не используется и
может содержать любую информацию. Имя абонента должно
соответствовать правилам присвоения имен файлов в системе
MS-DOS. Имена директорий должны содержать полный путь поиска,
включая и номер диска. Коды доступа - обязательно цифры от 0
до 9 или буквы A, B или C. Все остальные графы содержат любую
текстовую информацию.
    Если карта пользователя используется только для входящей
связи, то в ней нужны только шифро-пароль и имена директорий
и коды доступа к ним. Остальные графы при проверке
подключившегося абонента игнорируются. Карты пользователя на
узлах электронной почты автоматически создаются программой
SCRIBERS.EXE.
    В карте пользователя для вызова абонента используются все
графы, кроме имен директорий и кодов доступа к ним.
    Только одна графа карты пользователя предназначена для
использования как при входящей, так и при исходящей связи.
Эта графа - "Шифро-пароль". Все остальные реквизиты карты
абонента используются только в одном из случаев - или при
вызове абонента, или при приеме вызова со стороны телефонной
линии.

N  Наименование поля        Кто передает в линию        Длина
-------------------------------------------------------------
   Имя абонента              Передается вместе с идентифи-  8
                             катором вызывающей станцией
 1 Шифро-пароль              Не передается                 30
 2 Позывные вызываемой       Вызванная станция             30
   станции
 3 Идентификатор имени       Вызывающая станция            30
   вызывающей станции или
   строка для подключения
   к сети Х.25
 4 Разрешение подключения    Вызванная станция             30
   к сети
 5 Строка для набора номера  Вызывающая станция            40
   телефона                  передает своему модему
 6 Имя директории            Не передается                 64
 7 Код доступа к директории      - " -                      1
 8 Имя директории                - " -                     64
 9 Код доступа к директории      - " -                      1
10 Имя директории                - " -                     64
11 Код доступа к директории      - " -                      1
12 Имя директории                - " -                     64
13 Код доступа к директории      - " -                      1
14 Имя директории                - " -                     64
15 Код доступа к директории      - " -                      1
16 Имя директории                - " -                     64
17 Код доступа к директории      - " -                      1
18 Имя директории                - " -                     64
19 Код доступа к директории      - " -                      1
20 Имя директории                - " -                     64
21 Код доступа к директории      - " -                      1
22 Примечания                    - " -                     50

    Поскольку шифро-пароль в линию не передается, поля с
шифро-паролем должны совпадать в справочнике входящей связи у
вызванного абонента и в справочнике исходящей связи у
вызывающего абонента.


Классы доступа в директории общего доступа

    Если директория в карточке пользователя определена знаком
C - общего доступа COMMON, то абонент имеет доступ только для
чтения всех файлов из самой директории и всех ее
поддиректорий, т.е. соответствует коду 4.
    Имеется возможность ограничить доступ в поддиректории
COMMON. Для этого в карточке пользователя сразу вслед за
именем самой директории помещается знак # и вслед за ним
перечисляются латинские буквы и цифры. Буквы и цифры вслед за
знаком # запрещают абоненту доступ к тем поддиректориям, имя
которых начинается со знака, указанного вслед за #.
    Запретить доступ можно только к тем поддиректориям, имя
которых начинается с цифры или латинской буквы. Если имя
начинается с другого знака, обращение к поддиректории
запретить нельзя. Всего, таким образом, имеется 36 классов
имен поддиректорий, с помощью которых можно управлять
доступом абонентов в поддиректории общего доступа.

    Вслед за знаком # перечисляются все знаки - классы,
обращение к которым абоненту запрещено. Для удобства с
помощью знака "-" можно указывать диапазоны запрещенных
классов.
    Например, если в карточке пользователя определена
директория с кодом доступа C

        D:\PROCARRY\HOST\COMMON#24-79EGR-Y

то к директориям

        D:\PROCARRY\HOST\COMMON\1B.LC
        D:\PROCARRY\HOST\COMMON\AIST
        D:\PROCARRY\HOST\COMMON\!TEMP
        D:\PROCARRY\HOST\COMMON\CLASS

доступ абоненту разрешен, а к

        D:\PROCARRY\HOST\COMMON\200
        D:\PROCARRY\HOST\COMMON\511
        D:\PROCARRY\HOST\COMMON\E1
        D:\PROCARRY\HOST\COMMON\R100
        D:\PROCARRY\HOST\COMMON\T
        D:\PROCARRY\HOST\COMMON\Y

запрещен.
    Классы не влияют на доступ к файлам в самой директории. В
главной директории общего доступа разрешено чтение всех
файлов. Например, даже если обращение к поддиректориям с 1-й
буквой F в имени запрещено, файлы, начинающиеся с F, абонент
прочитать сможет.
    С помощью классов доступа можно гибко управлять
использованием электронных досок объявлений и информационно-
справочных систем, разрешая или запрещая различным абонентам
доступ к различной информации.


Совместное использование телефона и модема

    Все время, пока модем не работает с телефонной линией, вы
можете свободно без всяких помех пользоваться телефоном.
Проблемы могут возникнуть только в том случае, если по одному
номеру телефона приходят вызовы как для установленного в
ожидание модема, так и для обычного голосового разговора.
    Обычно в таких случаях ProCarry настраивается таким
образом, чтобы модем отвечал на вызов с 5-го или 6-го звонка.
За это время, если необходимо, вы успеете сами снять трубку
телефона и ответить на вызов. Если вызов пришел от модема, то
вы должны сначала войти в программу PROCRSRV, затем выдать
команду отбоя F1 и команду ручного включения модема в
ответном режиме F10 (или Shift-F4 для модема Хейза).

ЧАСТЬ 5: ПРОГРАММА PROCRSRV.COM


Назначение драйвера PROCRSRV.COM

    Для управления набором номера, приемом вызовов со стороны
коммутируемых телефонных линий связи, выполнения различных
вспомогательных процедур в системе ProCarry используется
фоновый драйвер PROCRSRV.COM. Программа PROCRSRV.COM получает
команды для работы с линиями связи с клавиатуры компьютера, с
помощью процедур MS-DOS или из пользовательских программ
через прерывание int 2f.
   Управление с клавиатуры - это ручной режим работы. Другие
два режима позволяют организовывать автоматическую работу с
линиями связи.


Работа с PROCRSRV.COM в ручном режиме

    Программа PROCRSRV.COM находится резидентно в оперативной
памяти компьютера и всегда готова к приему команд. В любой
момент времени из любой пользовательской программы вы можете
нажать клавиши Ctrl-Alt-F4 и работа вашей программы будет
прервана, а на экране появится специальная заставка. В этот
момент PROCRSRV становится готовой к управлению в ручном
режиме.
    Если при запуске PROCRSRV.COM вы задали параметр /F с
номером функциональной клавиши, то вместо F4 будет служить
заданная вами клавиша.
    На экране видны состояния параметров по каждому из
обслуживаемых ProCarry каналов связи (портов RS-232). Номер
канала, к которому будут относиться все ваши команды,
отображается в строке посреди экрана. В этой же строке
содержится подсказка, что номер канала меняется нажатием
клавиши Alt и одновременно цифры - номера нужного вам канала.
    Нумерация каналов от 0 и максимально до 9.
    Текущий номер канала указывает канал, к которому будут
относиться ваши команды в настоящий момент времени. Это вовсе
не означает, что программа работает только с одним каналом
связи. Все драйверы ProCarry работают сразу со всеми каналами
связи. Команды дают только указание начать определенную
операцию. Окончания выполнения операции программа
PROCRSRV.COM не ожидает. Поэтому, задав, например, командой
Alt-F6 начать набор номера по одному из каналов, вы, пока
происходит набор, можете выйти из PROCRSRV в свою программу
или перейти к другому каналу связи и работать уже с ним.
Состояние каждого из каналов связи имеется на экране и оно
автоматически корректируется, если происходят изменения.


Список кодов состояний

    Код состояния канала связи виден на экране при входе в
программу PROCRSRV.COM. Состояние в текстовом виде можно
получить, нажав клавиши Ctrl-F1. Эти же коды состояний
выводятся при выходе из команд управления, выдаваемых через
MS-DOS. Код состояния передается как код выхода из программы
(в сумме с кодом ошибки) и может быть проанализирован
командой IF.
    Если код состояния 1 - "работа в сети" и связь была
установлена после входящего вызова, то на экран будет
выдаваться и имя подключившегося абонента. При остальных
вариантах установления связи имя абонента не выдается.

      1 -  Работа в сети
      2 -  Ожидание вызова
      3 -  Проверка вызвавшей станции
      4 -  Передача своих позывных
      5 -  Отбой связи
      6 -  Набор номера
      7 -  Диалог
      8 -  Сеть отключена


Список команд PROCRSRV.COM

    Экран программы PROCRSRV одновременно является подсказкой
об имеющихся командах управления в ручном режиме. Все команды
инициируются нажатием клавиш F1 - F10, Ctrl-F1 - Ctrl-F10,
Shift-F1 - Shift-F10, Alt-F1 - Alt-F10.


F1 Отбой

    Происходит отключение сети и отбой модема от линии связи.
В линию посылается сообщение об отбое. В случае модема Хейза
происходит повторная инициализация модема, начальная
инициализация производится автоматически после старта
ProCarry. Данные для инициализации настраиваются программой
PROCRINS.EXE.

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых может быть выполнена команда: все.


F2 Отключить сеть без разрыва соединения

    Это дополнительная команда. Позволяет отключать сеть, но
не отбиваться от линии. Модем Хейза при этом не меняет своего
состояния: из состояния On-Line он не переходит в командный
режим и наоборот.

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: 1,5,
   7,8.


F3 Включить сеть

    Команда подключения к сети. При этом используется ранее
заданный шифро-пароль (по Ctrl-F10 или как-то иначе). Команда
может быть использована для модемов Хейза в том случае, если
ранее уже было установлено соединение, например, вручную в
режиме Диалог. Для модемов V.23 команда F3 может быть
использована совместно с отбоем по F1 для переключения
режимов разговора по телефону голосом и работы в сети.

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых может быть выполнена команда: 5,8.


F4 Ожидание вызова

    Канал связи настраивается на ожидание входящих вызовов.
После получения вызова от АТС модем подключается к линии и
начинается процедура проверки подключившегося абонента. Если
инициирован справочник входящей связи, то имя проверяется в
нем и доступ получают только те абоненты, для которых
заведена карточка пользователя. После отбоя связи (кроме
отбоя нажатием клавиши F1 на своем компьютере) канал
автоматически настраивается на ожидание новых вызовов.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой, из других состояний команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров входящей связи (или его
         длина равна нулю): запрос имени - позывные,
         идентификатор имени вызвавшей станции, подтверждение
         о подключении к сети. Параметры задаются командами
         Shift-F1 или Shift-F2.
     Состояния, из которых разрешено выполнение команды: 5.


F5 Ожидание вызова для одного сеанса связи

    Дополнительная команда. Совершенно аналогична команде F4,
но после любого отбоя канал устанавливается в состояние 5 -
отбой.

     Вопросы: нет.
     Сообщения об ошибках: см. F4.
     Состояния, из которых разрешено выполнение команды: 5.


F6 Проверить идентификаторы и подключиться к сети после
исходящего соединения

    Команда начать проверку идентификаторов со стороны
вызывающей станции. Предварительно должно быть установлено
соединение, а в случае AT-совместимых модемов оба модема
должны установить контакт и перейти в режим On-Line. Все
параметры для проверки предварительно должны быть заданы
командами F9 или Shift-F9 и командой Ctrl-F8 - свое имя
абонента.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой или 8 - сеть отключена, из других состояний
         команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров исходящей связи (или
         его длина равна нулю): запрос имени - позывные
         вызванной станции, идентификатор своего имени,
         разрешение подключиться к сети, шифро-пароль или не
         задано свое абонентское имя. Параметры задаются
         командами F9 или Shift-F9, а свое имя абонента
         командой Ctrl-F8.
     Состояния, из которых разрешено выполнение команды: 5,8.


F7 Набрать номер и установить соединение

    Команда начать набор номера и подключиться к сети
вызываемой станции. Если абонент занят, то попытка набора
повторяется столько раз, сколько установлено командой
Ctrl-F6. После установления соединения начинается проверка
идентификаторов. Все параметры для проверки должны быть
заданы командами F9 или Shift-F9 и командой Ctrl-F8 - свое
имя абонента.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой или 8 - сеть отключена, из других состояний
         команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров исходящей связи (или
         его длина равна нулю): запрос имени - позывные
         вызванной станции, идентификатор своего имени,
         разрешение подключиться к сети, шифро-пароль, номер
         телефона или не задано свое абонентское имя.
         Параметры задаются командами F9 или Shift-F9, а свое
         имя абонента командой Ctrl-F8.
     Состояния, из которых разрешено выполнение команды: 5,8.


F8 Диалог

    По этой команде компьютер переходит в состояние эмуляции
ANSI-терминала. Иногда вместо работы в сети может
потребоваться просто "переговорить" между собой. Если на
противоположном конце пользователь также перейдет в состояние
Диалога, то можно просто вести переговоры с клавиатуры, как с
двух обычных терминалов, соединенных между собой.
    После нажатия клавиши F8 появляется текстовая подсказка и
ваш компьютер готов принимать от вас знаки и посылать их в
линию.

    Из режима Диалог можно выполнить некоторые команды из
списка основного экрана ProCarry: F1, F2, F3, F6, Alt-F5,
F10, ESC, об этом и сообщает тектовая подсказка. Выход из
режима Диалог происходит после ввода одной из этих команд.
После выполнения всех команд, кроме ESC, компьютер переходит
к основному экрану PROCRSRV.COM, а после ESC - возвращается
сразу в прерванную программу.
    Имеется две дополнительные команды управления режимом
терминала. Alt-E переключает вывод знаков на экран, введенных
с клавиатуры. В одном из состояний знаки выводятся на экран
(режим "эхо"), в другом, хотя в линию или модему передаются,
но на экран не выводятся. Alt-F указывает, выполнять перевод
строки автоматически после клавиши Enter (знак перехода в
начало строки) или нет.
    Клавиша Alt-F1 открывает ввод знаков в буфер. Размер
буфера - 126 знаков. После нажатия на Alt-F1 все вводимые с
клавиатуры знаки отображаются на экране, но в линию или
модему не передаются. Клавиша Alt-F2 закрывает ввод знаков в
буфер и передает все его содержимое в линию.
    Режим Диалог может понадобиться для "ручного" управления
модемом, совместимого с AT-командами. После нажатия клавиши
F8 модем будет получать все знаки, введенные вами с
клавиатуры. Если модем в состоянии On-Line, то перевести его
в командный режим можно, введя +++. В режиме управления
модемом можно выполнить набор номера и подключиться к
какому-либо абоненту, а затем, нажав F6, перейти к процедуре
обмена идентификаторами, или после F3 сразу подключиться к
сети. Режим работы с модемом может понадобиться для
выполнения каких-либо нестандартных операций, не
предусмотренных в самой программе, например, переключить
модем на разговор по телефону голосом, а затем переключиться
к работе опять.
    В этом же режиме можно управлять компьютером на
противоположном конце линии связи. Вы можете настроить свою
систему таким образом, что ваш дисплей и клавиатура станут
системной консолью взаимодействующего с вами компьютера и вы
сможете выполнять всевозможные команды MS-DOS уже в "чужом"
компьютере, вплоть даже до того, что запускать там по своему
желанию на выполнение различные программы. Для этого
необходимо сначала каким-либо способом установить между собой
связь и, если вы пользуетесь модемами, совместимыми с
AT-командами, они должны быть в состоянии On-Line. Вы
переводите свой компьютер в режим Диалога. Ваш партнер также
переводит свой компьютер в режим Диалога и после этого сразу
же, дав команду ESC, из режима Диалога возвращается в
операционную систему. Если в данный момент выполняется
какая-либо программа, то от нее необходимо перейти к MS-DOS и
выдать команду

               CTTY COM1  или  CTTY AUX

Если используется не COM1, то необходимо указать то
устройство, которое и будет служить вместо консоли. Теперь
ваш компьютер готов для управления компьютером вашего
товарища. Вы можете, запустив там какую-либо программу,
вернуться к выполнению своей программы, нажав ESC. Для
переключения компьютера вашего товарища назад в нормальный
режим работы вы должны в режиме Диалога ввести команду

              CTTY CON

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение
       команды: 1,5,8.


F9 Данные о вызываемой станции в справочнике по имени

    Задаются данные после просмотра справочника исходящей
связи для выполнения команд F6, F7, Shift-F7, Alt-F2, Alt-F5.
Предварительно должно быть задано имя справочной директории
командой Ctrl-F7. Данные из справочника выбираются после
того, как вы введете имя абонента.

     Вопросы:
       "Имя абонента:"
          В ответ нужно ввести имя абонента, которого вы
         будете вызывать. Если вы хотите, чтобы набор номера
         начался сразу, то завершите ввод имени не нажатием
         Enter, а командой F7, тогда, найдя нужное имя в
         справочнике и считав все параметры, PROCRSRV сразу
         же приступит к выполнению команды набора F7.
     Сообщения об ошибках:
       "Имя в справочной директории отсутствует"
          Сообщение означает, что заданное вами имя или не
         найдено в справочной директории, или не найдена сама
         директория.
     Состояния, из которых разрешено выполнение команды: все.


F10 Проверить идентификаторы после входящего соединения

    Дополнительная команда. Может быть использована после
того, как уже установлена связь и оба абонента договорились
провести процедуру идентификации. При этом один абонент
нажимает клавишу F10, а другой - F6.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой или 8 - сеть отключена, из других состояний
         команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров входящей связи (или его
         длина равна нулю): запрос имени - позывные,
         идентификатор имени вызвавшей станции, подтверждение
         о подключении к сети. Параметры задаются командами
         Shift-F1 или Shift-F2.
     Состояния, из которых разрешено выполнение команды: 5,8.


Ctrl-F1 Состояние канала связи

    Если вы забыли, что означают коды состояний каналов
связи, то нажав Ctrl-F1 вы получите текстовую расшифровку
состояния текущего канала.
    Если код состояния 1 - "работа в сети" и связь была
установлена после входящего вызова, то на экран будет
выдано и имя подключившегося абонента.

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых может быть выполнена команда: все.


Ctrl-F2 Журнал

    Переключатель состояния системного журнала этого канала
связи. В состоянии ON все сведения о подсоединении абонентов
или отбоях будут заноситься в журнал. При переключении
журнала из состояния OFF в ON запрашивается имя файла
журнала.
     Вопросы:
       "Путь доступа и имя файла:"
          В ответ необходимо ввести имя файла. Необходимо
         конкретно указывать номер диска и полный путь поиска
         файла в директориях, т.к. обращение к файлу может
         происходить в любое время работы компьютера.
     Сообщения об ошибках:
       "Ошибка в параметрах"
          Имя файла не задано.
     Состояния, из которых может быть выполнена команда: все.


Ctrl-F3 Справочник при входящей связи

    Переключатель состояния справочника входящей связи этого
канала. После команд F4, F5, F10, Shift-F3, Shift-F4,
Shift-F6 в состоянии ON проверка имен пытающихся подключиться
абонентов производится в соответствии с указанным
справочником. В состоянии OFF имя абонента не проверяется и,
если абонент правильно передал свой идентификатор, ему
разрешается подключиться к сети. При переключении справочника
из состояния OFF в ON запрашивается имя директории -
справочника.

     Вопросы:
       "Имя директории:"
          В ответ необходимо ввести имя директории,
         содержащей карточки пользователей. Необходимо
         конкретно указывать номер диска и полный путь поиска
         в директориях, т.к. обращение к карточкам
         пользователей может происходить в любое время работы
         компьютера.
     Сообщения об ошибках:
       "Ошибка в параметрах"
          Имя директории не задано.
     Состояния, из которых может быть выполнена команда: все.


Ctrl-F4 К-во секунд молчания для сброса

    Для того, чтобы автоматически работающая система не
"зависала" в состоянии сети до бесконечности (такое может
произойти, например, если абонент на протипоположном конце
линии отбился, а ваша система этого не заметила - это вполне
возможно в случае модемов V.23), вводится лимит времени на
"бездействие" сети. После того, как программа определит, что
на линии нет никакого обмена в течение заданного времени,
происходит отбой связи и, если канал находился в состоянии
ожидания вызова по команде F4, то он опять устанавливается на
ожидание.

     Вопросы:
       "Число секунд - интервал для сброса:"
           В ответ необходимо задать интервал в секундах или
          ввести 0 - нет сброса по таймеру.
     Сообщения об ошибках:
       "Число д.б. 0 или в диапазоне 3-1800 сек"
           Задаваемый интервал времени не может превышать
          0.5 часа (1800 сек).
     Состояния, из которых может быть выполнена команда: все.


Ctrl-F5 Звонок при входящей связи

    Команда переключает состояния ON/OFF сигнала о
подсоединении к сети абонента с линии после того, как вы
настроили свою систему на ожидание вызова с помощью одной из
команд F4 или F5.

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Ctrl-F6 Количество попыток набора

    Задается количество попыток вызвать абонента командами
F7, Alt-F2 или Shift-F7, если он окажется занят. Это же число
задает количество циклов перебора номеров абонентов командами
Alt-F6 и Ctrl-F9.

     Вопросы:
       "Число в интервале 1-255:"
           Если введено число 0, то по умолчанию оно
          заменяется на 1.
     Сообщения об ошибках:
       "Число д.б. в диапазоне 1-255"
           Количество циклов набора не может превышать 255.
     Состояния, из которых разрешено выполнение команды: все.


Ctrl-F7 Имя справочника для исходящей связи

    Задается имя справочной директории для поиска карточек
пользователей и установки параметров вызываемых абонентов по
командам F9, Ctrl-F9 или Alt-F6.

     Вопросы:
       "Имя директории:"
          В ответ необходимо ввести имя директории,
         содержащей карточки пользователей. Необходимо
         конкретно указывать номер диска и полный путь поиска
         в директориях, т.к. обращение к карточкам
         пользователей может происходить в любое время работы
         компьютера.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Ctrl-F8 Свое имя абонента

    Свое имя абонента используется при вызове других
пользователей коммутируемой сети. Оно должно быть обязательно
задано до выдачи команд набора номера F7, Alt-F2, Ctrl-F9,
Alt-F6 или идентификации после исходящего вызова F6 или
Alt-F5. Свое имя абонента вместе с идентификатором передается
вызванной станции для проверки.

     Вопросы:
       "Свое имя:"
          В ответ нужно ввести свое абонентское имя длиной до
         8 знаков.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Ctrl-F9 Вызвать абонента по альтернативному списку имен

    Команда начать набор номеров абонента по альтернативному
списку имен карточек пользователей. Команда во многом сходна
с F7, но в отличие от нее номер телефона набирается не один и
тот же, а используется целый список имен карточек
пользователей, в которых заданы разные номера.
    Список имен карточек пользователей абонента задается
командой Shift-F10. Карточки пользователей будут отыскиваться
в директории, заданной предварительно командой Ctrl-F7.
    Вызов абонента начинается с 1-го имени в списке. Если
номер занят, то система переходит к следующему имени и т.д.
После попытки вызова по последнему имени в списке система
опять возвращается к 1-му имени и переходит к следующему
циклу. Количество циклов повтора предварительно должно быть
задано командой Ctrl-F6.
    Предварительно, до выдачи команды Ctrl-F9, необходимо
командой Ctrl-F8 задать свое имя абонента.
    Чтобы иметь возможность "спрятать" шифро-пароль, команда
Ctrl-F9 может использовать шифро-пароль, заданный не в
карточках пользователей. Карточки пользователей находятся на
диске в текстовом виде и доступны всем. "Спрятать" в них
шифро-пароль невозможно. Поэтому в команде Ctrl-F9
предусмотрена возможность выбора, откуда брать шифро-пароль в
момент установления соединения. После выдачи команды Ctrl-F9
система задает вопрос "Код:". Если в ответ ввести цифру "1",
то шифро-пароль будет использован тот, что был задан командой
Ctrl-F10. Любой другой знак означает, что шифро-пароль не
секретный и его необходимо брать из карточек пользователей.
Команда Ctrl-F10 для задания секретного шифро-пароля должна
быть обязательно выдана непосредственно перед самой выдачей
команды Ctrl-F9.
    В момент выполнения команд Ctrl-F9 или Alt-F6 все
остальные команды, кроме отбоя F1 и считывания состояния
Ctrl-F1, запрещены.
    Команда Ctrl-F9 должна выдаваться из командных файлов или
из программ пользователя. Если же она выдана вручную, то для
того, чтобы набор номера не останавливался, следует покинуть
окно программы PROCRSRV, нажав ESC.

     Вопросы:
       "Код:"
          В ответ необходимо ввести знак "1" - использовать
         ранее заданный по Ctrl-F10 шифро-пароль, или любой
         другой знак (или вообще ничего) - шифро-пароль брать
         из самих карточек пользователей вызываемого
         абонента.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой, из других состояний команду выдавать нельзя.
     Состояния, из которых разрешено выполнение команды: 5.


Ctrl-F10 Изменить шифро-пароль в сети

    Шифро-пароль можно задать в любой момент времени. В
соответствии с этим паролем шифруются все данные,
передаваемые по каналу связи во время работы сети. При
программной идентификации абонентов по командам F4, F5, F6,
F7, F10, Ctrl-F9, Alt-F2, Alt-F5, Alt-F6, Shift-F3, Shift-F4,
Shift-F5 шифро-пароль устанавливается автоматически.
    После старта сети ProCarry устанавливается стандартный
шифро-пароль KEY.
    Введенные с клавиатуры знаки на экране не отображаются.
Прежнее значение шифро-пароля также не показывается. Если вы
хотите сохранить прежнее значение пароля, то для этого
необходимо нажать ESC или Enter из первой позиции. После
нажатия Tab устанавливается стандартное значение KEY шифро-
пароля.

     Вопросы:
       "Новый шифро-пароль (Tab - стандартное значение KEY):"
          Если вы находитесь в состоянии 3 - работа сети, то
         шифро-пароль будет установлен немедленно после
         нажатия Enter. В других случаях строка будет
         запомнена для последующих подключений к сети, если
         шифро-пароль не будет изменен процедурами
         программной идентификации абонентов.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Shift-F1 Параметры ожидания вызова вручную

    Если вы хотите использовать свой компьютер в качестве
ожидающего вызовы со стороны АТС, вам обязательно необходимо
задать параметры, по которым программа будет определять,
может ли тот или иной подсоединившийся абонент подключиться к
вам. Параметры вводятся после соответствующих вопросов
программы.

     Вопросы:
       "Свои позывные:"
          Введите свои позывные. Одновременно это запрос для
         вызывающей станции ее имени и идентификатора.
       "Идентификатор вызывающей станции:"
          Идентификатор дает возможность определить из
         принимаемых с линии знаков, что вызывающая станция
         правильно обращается к вашей сети, т.е. это
         своеобразный пароль. Кроме того, с помощью
         идентификатора в принятой строке определяется имя
         подсоединившегося абонента. По имени затем будет
         окончательно определено, можно ли этому абоненту
         подключаться к вам.
       "Подтверждение для вызывающей станции о подключении к
        сети:"
           Если абоненту разрешено включаться в вашу сеть, то
          в линию посылается заданная строка знаков, по
          которой вызвавший абонент определит, что он он
          подключен к вашему компьютеру.
     Сообщения об ошибках:
       "В момент ожидания вызова корректировать параметры
        нельзя"
          Канал запрограммирован на работу с входящими
         вызовами, поэтому выполнение этой команды испортит
         параметры настройки программ ожидания текущих
         вызовов. Необходимо отключить канал от ожидания
         вызовов и тогда выполнить эту команду.
     Состояния, из которых разрешено выполнение команды: 5.


Shift-F2 Параметры ожидания вызова из справочника по имени

    Дополнительная команда. В отличие от команды Shift-F1,
данные отыскиваются в справочнике входящей связи по заданному
имени. Поскольку параметры входящей связи настраиваются в
сети очень редко, то обычно свои данные можно в справочник не
помещать, а задать их командой Shift-F1.

     Вопросы:
       "Имя абонента:"
          В ответ нужно ввести имя длиной до 8 знаков для
         поиска в справочнике входящей связи.
     Сообщения об ошибках:
       "В момент ожидания вызова корректировать параметры
        нельзя"
          Канал запрограммирован на работу с входящими
         вызовами, поэтому выполнение этой команды испортит
         параметры настройки программ ожидания текущих
         вызовов. Необходимо отключить канал от ожидания
         вызовов и тогда выполнить эту команду.
       "Имя в справочной директории отсутствует"
          Сообщение означает, что заданное вами имя или не
         найдено в справочной директории, или не найдена сама
         директория.
     Состояния, из которых разрешено выполнение команды: 5.


Shift-F3 Проверить идентификаторы после входящего соединения
многократно

    Команда для выделенных некоммутируемых линий связи.
Действие ее аналогично действию F10, однако в отличие от F10
опрос линии связи выполняется непрерывно. Абонент на другом
конце для установления связи выдает команду F6. Непрерывный
опрос дает возможность подключающемуся абоненту выдать
команду F6 в любое время, не надо ловить момент, когда выдана
команда F10. После установления соединения, сеанса связи и
последующего отбоя опрос возобновляется опять.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой или 8 - сеть отключена, из других состояний
         команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров входящей связи (или его
         длина равна нулю): запрос имени - позывные,
         идентификатор имени вызвавшей станции, подтверждение
         о подключении к сети. Параметры задаются командами
         Shift-F1 или Shift-F2.
     Состояния, из которых разрешено выполнение команды: 5,8.


Shift-F4 Проверить идентификаторы после входящего соединения
для модемов Hayes

    Команда полностью идентична команде F10, но применяется
для модемов Хейза. Перед началом процедуры идентификации
подключающегося абонента модему выдается команда подключения
к линии в ответном режиме (по умолчанию это команда ATA).
Подключающийся абонент выдает команду F7 или Alt-F2, где
вместо номера телефона указано модему немедленно подключиться
к линии в вызывном режиме (например, ATX3D). После того, как
модемы установят контакт и выдадут сообщение CONNECT,
начинается процедура идентификации и дальше все аналогично
команде F10.
    Команда может быть использована для подключения к сети
после разговора по телефону или, например, после того, как вы
сняли трубку телефона и поняли, что вас вызвал модем.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой или 8 - сеть отключена, из других состояний
         команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров входящей связи (или его
         длина равна нулю): запрос имени - позывные,
         идентификатор имени вызвавшей станции, подтверждение
         о подключении к сети. Параметры задаются командами
         Shift-F1 или Shift-F2.
     Состояния, из которых разрешено выполнение команды: 5,8.


Shift-F5 Ожидание вызова для одного сеанса связи без
идентификации

    Команда облегченной процедуры соединения абонентов в сеть
через коммутируемые каналы связи. Канал связи настраивается
на ожидание входящего вызова. После получения сигнала вызова
от АТС модем подключается к линии и канал устанавливается без
всяких проверок сразу в режим 1 - работа в cети.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой, из других состояний команду выдавать нельзя.
     Состояния, из которых разрешено выполнение команды: 5.


Shift-F6 Проверить идентификаторы после входящего соединения
для модемов Hayes многократно

    Команда для выделенных некоммутируемых линий связи, если
используются модемы Хейза. Действие полностью аналогично
команде Shift-F3. Разница только в том, что перед началом
процедуры идентификации подключающегося абонента модему
выдается команда подключения к линии в ответном режиме (по
умолчанию это команда ATA). Подключающийся абонент выдает
команду F7 или Alt-F2, где вместо номера телефона указано
модему немедленно подключиться к линии в вызывном режиме
(например, ATX3D). После того, как модемы установят контакт и
выдадут сообщение CONNECT, начинается процедура идентификации
и дальше все аналогично команде F10.
    Непрерывные опросы дают возможность подключающемуся
абоненту выдать команду F7 или Alt-F2 в любое время, не надо
ловить момент, когда выдана однократная команда Shift-F4.
После установления соединения, сеанса связи и последующего
отбоя опрос возобновляется опять.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой или 8 - сеть отключена, из других состояний
         команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров входящей связи (или его
         длина равна нулю): запрос имени - позывные,
         идентификатор имени вызвавшей станции, подтверждение
         о подключении к сети. Параметры задаются командами
         Shift-F1 или Shift-F2.
     Состояния, из которых разрешено выполнение команды: 5,8.


Shift-F7 Набрать номер и установить соединение без
идентификации

    Команда облегченной процедуры соединения абонентов в сеть
через коммутируемые каналы связи. После нажатия Shift-F7
начинается набор номера, предварительно установленного по
команде F9 или Shift-F9. Если абонент занят, номер телефона
набирается столько раз, сколько установлено командой Ctrl-F6.
Вызываемый абонент должен находиться в состоянии ожидания
после команды Shift-F5. После установления соединения и
перехода модемов в режим On-Line устанавливается состояние
канала 1 - работа в сети.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой, из других состояний команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан номер телефона или свое абонентское имя.
         Номер телефона задается командами F9 или
         Shift-F9, а свое имя абонента командой Ctrl-F8.
     Состояния, из которых разрешено выполнение команды: 5.


Shift-F9 Данные о вызываемой станции вручную

    По этой команде устанавливаются все необходимые сведения
для вызова абонента, проверки идентификаторов и вхождения в
сеть. Запись сведений происходит после вопросов, которые
будет задавать вам программа.

     Вопросы:
       "Позывные вызываемой станции:"
          Введите позывные вызываемой станции.
       "Свой идентификатор:"
          Свой идентификатор затем будет присоединен к вашему
         абонентскому имени и передан вызванной станции для
         проверки.
       "Подтверждение от вызванной станции о подключении к
        сети:"
          Введите строку, по которой затем программа сможет
         определить, что вызванная станция разрешает
         подключиться к сети.
       "Шифро-пароль:"
          Если вы не зададите здесь шифро-пароль, то это
         означает, что вызываемая станция не ведет проверку
         по справочнику и шифро-паролем служит имя вашей
         станции. В этом случае на место шифро-пароля
         программа переписывает ваше абонентское имя.
       "Командная строка для модема Хейза:"
          Командная строка задается полностью, вместе с самой
         командой AT. Если вы хотите сразу же начать набор
         номера, то завершите ввод строки не нажатием Enter,
         а командой F7, тогда, записав все параметры,
         PROCRSRV приступит к выполнению команды набора F7.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Shift-F10 Список имен абонентов

    Задается список альтернативных имен карточек абонента,
которого система будет пытаться вызвать по командам Ctrl-F9
или Alt-F6. Карточки пользователей будут отыскиваться в
справочной директории, заданной командой Ctrl-F7. Команды
Ctrl-F9 или Alt-F6 будут последовательно перебирать имена
карточек из введенного списка до тех пор, пока хотя бы по
одному из них не будет установлено соединение.

     Вопросы:
       "Список имен (разделитель - "/"):"
          В ответ нужно ввести список имен карточек, которые
         будут использоваться для вызова сервера электронной
         почты. Указываются только имена файлов карточек без
         расширений .PCR. В качестве разделителя имен
         используется знак дробной черты "/". Имен может быть
         любое количество, сколько помещается в строке.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Alt-F1 Включить экран программы ускоренной связи

    Если в память загружен драйвер ускоренной связи
SFAST.EXE, то на экране можно просматривать текущее состояние
связи. Команда Alt-F1 выводит на экран состояние только
текущего канала.
    Выход из просмотра состояния канала ускоренной связи -
после нажатия любой клавиши.
    Команда Alt-F1 не может быть выдана из прикладной
программы или в командном режиме работы PROCRSRV.COM.

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Alt-F2 Набрать номер и установить соединение

    Команда начать набор номера и после получения разрешения
на подключение начать обмен по ускоренному протоколу связи.
Если абонент занят, то попытка набора повторяется столько
раз, сколько установлено командой Ctrl-F6. После установления
соединения начинается проверка идентификаторов. Все параметры
для проверки должны быть заданы командами F9 или Shift-F9 и
командой Ctrl-F8 - свое имя абонента.
    Команда Alt-F2 - аналог команды F7, но после получения
разрешения к работе связь начинается по ускоренному протоколу
электронной почты. Доступа к виртуальным коммуникационным
дискам в этом случае нет.
    Если в момент выполнения команды Alt-F2 драйвер SFAST.EXE
не загружен, или команда выдана не для дуплексного модема, то
автоматически ALT-F2 заменяется на F7.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой или 8 - сеть отключена, из других состояний
         команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров исходящей связи (или
         его длина равна нулю): запрос имени - позывные
         вызванной станции, идентификатор своего имени,
         разрешение подключиться к сети, шифро-пароль, номер
         телефона или не задано свое абонентское имя.
         Параметры задаются командами F9 или Shift-F9, а свое
         имя абонента командой Ctrl-F8.
     Состояния, из которых разрешено выполнение команды: 5,8.


Alt-F3 Имя файла-журнала сервера при ускоренной связи

    Задается имя текстового файла, в который будет
записываться протокол работы сервера электронной почты при
ускоренной связи с помощью драйвера SFAST.EXE. Если команда
Alt-F3 выполнена во время сеанса связи, то имя журнала в
текущем сеансе не меняется, но следующий сеанс будет
выполняться уже с новым введенным значением.
    Если для какого-то канала связи имя журнала не задано, то
протокол работы для этого канала не будет записываться на
диск.

     Вопросы:
       "Путь доступа и имя файла:"
          В ответ необходимо ввести имя файла. Необходимо
         конкретно указывать номер диска и полный путь поиска
         файла в директориях, т.к. обращение к файлу может
         происходить в любое время работы компьютера.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Alt-F4 Имя директории абонента при ускоренной связи

    Задается имя главной директории абонента для ускоренной
связи с помощью драйвера SFAST.EXE. Команда Alt-F4 должна
предшествовать командам Alt-F2, Alt-F5 и ALT-F6, инициирующим
ускоренную связь со стороны абонента. Если команда Alt-F4
выполнена во время сеанса связи, то имена директорий и файлов
в текущем сеансе не меняются, но следующий сеанс будет
выполняться уже с новым введенным значением.

     Вопросы:
       "Имя директории:"
          В ответ необходимо ввести имя директории,
         содержащей поддиректории IN, OUT, SENT, COMMON,
         файл журнала JOURNAL.TXT и файл запросов LIST.REQ.
         Необходимо конкретно указывать номер диска и полный
         путь поиска, т.к. обращение к директории может
         происходить в любое время работы компьютера.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Alt-F5 Проверить идентификаторы и установить ускоренную связь
после исходящего соединения

    Команда начать проверку идентификаторов со стороны
вызывающей станции и после получения разрешения на
подключение начать обмен по ускоренному протоколу связи.
Предварительно должно быть установлено физическое соединение
модемов, а в случае AT-совместимых модемов оба модема должны
установить контакт и перейти в режим On-Line. Все параметры
для проверки предварительно должны быть заданы командами F9
или Shift-F9 и командой Ctrl-F8 - свое имя абонента.
    Команда Alt-F5 - аналог команды F6, но после получения
разрешения к работе связь начинается по ускоренному протоколу
электронной почты. Доступа к виртуальным коммуникационным
дискам в этом случае нет.
    Если в момент выполнения команды Alt-F5 драйвер SFAST.EXE
не загружен, или команда выдана не для дуплексного модема, то
автоматически ALT-F5 заменяется на F6.

     Вопросы: нет.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой или 8 - сеть отключена, из других состояний
         команду выдавать нельзя.
       "Ошибка в параметрах"
          Не задан один из параметров исходящей связи (или
         его длина равна нулю): запрос имени - позывные
         вызванной станции, идентификатор своего имени,
         разрешение подключиться к сети, шифро-пароль или не
         задано свое абонентское имя. Параметры задаются
         командами F9 или Shift-F9, а свое имя абонента
         командой Ctrl-F8.
     Состояния, из которых разрешено выполнение команды: 5,8.


Alt-F6 Вызвать абонента по альтернативному списку имен и
установить ускоренную связь

    Команда начать набор номеров абонента и после соединения
и получения разрешения на подключение начать обмен по
ускоренному протоколу связи. Команда во многом сходна с
Alt-F2, но в отличие от нее номер телефона набирается не один
и тот же, а используется целый список имен карточек
пользователей, в которых заданы разные номера.
    Список имен карточек пользователей абонента задается
командой Shift-F10. Карточки пользователей будут отыскиваться
в директории, заданной предварительно командой Ctrl-F7.
    Вызов абонента начинается с 1-го имени в списке. Если
номер занят, то система переходит к следующему имени и т.д.
После попытки вызова по последнему имени в списке система
опять возвращается к 1-му имени и переходит к следующему
циклу. Количество циклов повтора предварительно должно быть
задано командой Ctrl-F6.
    Предварительно, до выдачи команды Alt-F6, необходимо
командой Ctrl-F8 задать свое имя абонента.
    Чтобы иметь возможность "спрятать" шифро-пароль, команда
Alt-F6 может использовать шифро-пароль, заданный не в
карточках пользователей. Карточки пользователей находятся на
диске в текстовом виде и доступны всем. "Спрятать" в них
шифро-пароль невозможно. Поэтому в команде Alt-F6
предусмотрена возможность выбора, откуда брать шифро-пароль в
момент установления соединения. После выдачи команды Alt-F6
система задает вопрос "Код:". Если в ответ ввести цифру "1",
то шифро-пароль будет использован тот, что был задан командой
Ctrl-F10. Любой другой знак означает, что шифро-пароль не
секретный и его необходимо брать из карточек пользователей.
Команда Ctrl-F10 для задания секретного шифро-пароля должна
быть обязательно выдана непосредственно перед самой выдачей
команды Alt-F6.
    Команда Alt-F6 - аналог команды Ctrl-F9, но после
получения разрешения к работе связь начинается по ускоренному
протоколу электронной почты. Доступа к виртуальным
коммуникационным дискам в этом случае нет.
    Если в момент выполнения команды Alt-F6 драйвер SFAST.EXE
не загружен, или команда выдана не для дуплексного модема, то
автоматически ALT-F6 заменяется на Ctrl-F9.
    В момент выполнения команд Ctrl-F9 или Alt-F6 все
остальные команды, кроме отбоя F1 и считывания состояния
Ctrl-F1, запрещены.
    Команда Alt-F6 должна выдаваться из командных файлов или
из программ пользователя. Если же она выдана вручную, то для
того, чтобы набор номера не останавливался, следует покинуть
окно программы PROCRSRV, нажав ESC.

     Вопросы:
       "Код:"
          В ответ необходимо ввести знак "1" - использовать
         ранее заданный по Ctrl-F10 шифро-пароль, или любой
         другой знак (или вообще ничего) - шифро-пароль брать
         из самих карточек пользователей вызываемого
         абонента.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой, из других состояний команду выдавать нельзя.
     Состояния, из которых разрешено выполнение команды: 5.


ALT-F7 Установить паузу в конце сеансов Zmodem

    По этой команде устанавливается такое состояние канала
связи, при котором все сеансы связи по протоколу Zmodem,
инициированные этим каналом в качестве сателлита, не будут
обрываться сразу, как только у обоих сторон закончились файлы
для передачи. После окончания передачи всех файлов и сервер,
и сателлит находятся в состоянии ожидания новых файлов
приблизительно еще 2 минуты и только после этого обрывают
соединение. За это время какая-то из сторон может возобновить
передачу, проверка директорий для передачи производится
каждые 15 секунд.
    Сбросить состояние паузы после сеансов связи можно
только командой ALT-F8. Первоначально, после старта программы
SFAST.EXE, состояние паузы отсутствует и может быть
установлено только командой ALT-F7. Команды ALT-F7 и ALT-F8
действуют для каждого канала связи по отдельности.
    Состояние паузы по команде ALT-F7 устанавливается только
для саталлита. Сервер состояние паузы у себя включает только
на время текущего сеанса связи, получив соответствующую
команду от сателлита.

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


ALT-F8 Отменить паузу в конце сеансов Zmodem

    По этой команде отменяется состояние паузы в конце каждого
сеанса связи по протоколу Zmodem, установленное для этого
канала командой Alt-F7.

     Вопросы: нет.
     Сообщения об ошибках: нет.
     Состояния, из которых разрешено выполнение команды: все.


Alt-F9 Вызывать абонента по альтернативному списку имен и
устанавливать ускоренную связь непрерывно

    Команда запускает цикл непрерывного выполнения команд
Alt-F6. Перебор списка номеров телефонов, заданного командой
Shift-F10, ведется непрерывно без всяких счетчиков до тех
пор, пока не будет установлена ускоренная связь. После
окончания сеанса связи немедленно автоматически выдается
новая команда Alt-F6 и перебор номеров будет продолжаться,
пока связь не установится заново.
    Прекратить выполнение команды Alt-F9 можно только, нажав
отбой F1.
    Команда Alt-F9 во всем аналогична команде Alt-F6, за
исключением того, что, во-первых, счетчик циклов перебора
номеров телефонов для Alt-F9 не ограничен числом, заданным по
Ctrl-F6, и, во-вторых, после успешного окончания сеанса связи
по Alt-F9 начинается новая попытка войти в связь в отличие от
Alt-F6, действие которой на этом заканчивается.
    Команда Alt-F9 необходима, в основном, для выделенных
каналов с модемами Hayes или, когда компьютеры связаны
кабелем нуль-модем. В таких случаях команда Alt-F9 в паре с
командой F4, выданной на другом конце линии связи,
обеспечивает непрерывную связь по ускоренному протоколу. Если
все файлы переданы и сеанс связи заканчивается, тут же
соединение восстанавливается заново и если появились новые
файлы, они немедленно передаются на другой конец линии.
    В принципе, Alt-F9 может применяться и для коммутируемых
каналов с перебором целых списков номеров телефонов сервера.
Список имен карточек пользователей абонента задается, как и
для Alt-F6, командой Shift-F10. Карточки пользователей будут
отыскиваться в директории, заданной предварительно командой
Ctrl-F7.
    Предварительно, до выдачи команды Alt-F9, необходимо
командой Ctrl-F8 задать свое имя абонента.
    Точно так, как и по команде Alt-F6, шифро-пароль можно
"спрятать" или взять готовый из карточки пользователя.
    В момент выполнения команды Alt-F9 все остальные команды,
кроме отбоя F1 и считывания состояния Ctrl-F1, запрещены.
    Команда Alt-F9 должна выдаваться из командных файлов или
из программ пользователя. Если же она выдана вручную, то для
того, чтобы набор номера не останавливался, следует покинуть
окно программы PROCRSRV, нажав ESC.

     Вопросы:
       "Код:"
          В ответ необходимо ввести знак "1" - использовать
         ранее заданный по Ctrl-F10 шифро-пароль, или любой
         другой знак (или вообще ничего) - шифро-пароль брать
         из самих карточек пользователей вызываемого
         абонента.
     Сообщения об ошибках:
       "Канал связи не подготовлен"
          Канал связи должен быть только в состоянии 5 -
         отбой, из других состояний команду выдавать нельзя.
     Состояния, из которых разрешено выполнение команды: 5.


ESC  Выход в прерванную программу

    Нажав ESC, вы возвратитесь в MS-DOS или в ту программу,
которая была прервана нажатием Ctrl-Alt-F4.


Работа с PROCRSRV.COM в командном режиме

    В командном режиме PROCRSRV.COM управляется с помощью
команд MS-DOS. Командный режим работы PROCRSRV.COM дает
возможности заранее запрограммировать определенные операции с
каналами связи и далее выполнять все эти работы автоматически
без участия оператора.


Задание команды

    Все операции в командном режиме работы полностью
соответствуют командам в ручном режиме, кроме F8 Диалог -
этой операции в командном режиме нет. Для выполнения операции
неоходимо вызвать PROCRSRV.COM с параметрами /A и /C. /A
указывает номер канала, к которому производится обращение. /C
указывает саму операцию с каналом связи. Дополнительно могут
потребоваться строковые параметры, если они необходимы для
выполняемой команды. Параметр /A задается с цифрой вслед за
буквой A - номер канала. Номер канала может быть 0 или выше,
но не больше максимального номера канала связи. Параметр /С
задается с числом - номером операции вслед за буквой C. Число
может быть одно-двузначным в диапазоне 1-40. Каждое число
соответствует команде PROCRSRV в ручном режиме работы:

    F1   1      Ctrl-F1  11      Shift-F1  21      Alt-F1  31
    F2   2      Ctrl-F2  12      Shift-F2  22      Alt-F2  32
    F3   3      Ctrl-F3  13      Shift-F3  23      Alt-F3  33
    F4   4      Ctrl-F4  14      Shift-F4  24      Alt-F4  34
    F5   5      Ctrl-F5  15      Shift-F5  25      Alt-F5  35
    F6   6      Ctrl-F6  16      Shift-F6  26      Alt-F6  36
    F7   7      Ctrl-F7  17      Shift-F7  27      Alt-F7  37
    F8   8      Ctrl-F8  18      Shift-F8  28      Alt-F8  38
    F9   9      Ctrl-F9  19      Shift-F9  29      Alt-F9  39
    F10 10      Ctrl-F10 20      Shift-F10 30      Alt-F10 40

    Другими словами, клавишам F1-F10 соответствуют номера от
1 до 10, Ctrl-F1 - Ctrl-F10 номера от 11 до 20, Shift-F1 -
Shift-F10 номера от 21 до 30 и Alt-F1 - Alt-F10 номера от 31
до 40. Например, номер 1 - отбой, 7 - набор номера, 1 -
проверить состояние, 29 - задать данные о вызываемой станции
вручную.
    Команда в целом задается следующим образом

       PROCRSRV /Ax /Cy [строка 1][,строка 2][, ...]

Параметр /A должен обязательно предшествовать /C. Между ними
могут быть пробелы. Строковые параметры от числа - номера
операции отделяются одним или более пробелом. Допускается
наклонную черту перед C опускать: /AxCy. Строковые параметры,
если их несколько, отделяются друг от друга запятыми.
Строковые параметры вводятся вместо вопросов, задаваемых
программой пользователю в ручном режиме работы. Число таких
параметров равно числу вопросов для этой команды. Например,
для команды номер 29 - Shift-F9 (задать параметры для
исходящей связи) нужно задать 5 строк, разделенных запятыми.
    Параметр /A может отсутствовать. В этом случае команда
предназначена для канала связи, который был установлен ранее.
Команда тогда выглядит следующим образом:

       PROCRSRV /Cy [строка 1][,строка 2][, ...]

Рекомендуется использовать команды без параметра канала /A в
случае, если сеть ProCarry использует только один стык
RS-232. Если используется несколько стыков RS-232, то без
задания номера канала возможны недоразумения и лучше
исключить их, задавая /A.


Примеры команд PROCRSRV.COM

    Отбой канала 0:

          PROCRSRV /a0 /c1

    Задать свое имя абонента "Абонент 3" для канала
номер 1:

          PROCRSRV /A1C18 Абонент 3

    Задание параметров для ожидания вызова "Введите свое
имя:", "Код", "O'Key":

          PROCRSRV /A2/C21 Введите свое имя:,Код,O'Key

    Прочитать состояние текущего канала связи:

          PROCRSRV /c11


Анализ выполненных команд и состояния каналов связи

    После выполнения каждой операции программа устанавливает
код выхода с помощью которого командой IF в BAT-файлах MS-DOS
можно получить информацию о состоянии канала связи и о
выполненной операции. Код выхода - это состояние канала связи
от 1 до 8 сложенное с кодом ошибки. Коды ошибок перечислены в
списке сообщений. Таким образом, если операция завершилась
успешно, то код выхода в MS-DOS равен от 1 до 8, в противном
случае код выше 20H (32-х в десятичном виде).
    Следует учитывать, что действие команды, как и в ручном
режиме, заключается только в инициировании операции, PROCRSRV
не ожидает конца операции и возвращает управление MS-DOS. При
выходе код состояния соответствует состоянию канала именно в
этот момент. Например, после команды номер 7 - F7 (начать
набор номера), если команда принята к выполнению, будет выдан
код 6 - идет набор номера. Если это имеет важное значение, то
ожидать подключения к сети (код 1), или отбоя (код 5),
необходимо в цикле, используя команду IF.
    Таким образом, предоставлены возможности инициировать
любую команду PROCRSRV из командных файлов MS-DOS и возможно
проверить выполнение каждой операции и состояние канала
связи. PROCRSRV.COM дает возможность выполнять любые операции
с каналами связи в автоматическом режиме.


Список сообщений PROCRSRV.COM

    PROCRSRV.COM выдает на экран сообщения во время ручной
работы с ней, а также после обращения к ней в командном
режиме. Для того, чтобы результаты работы можно было
проверить командой IF операционной системы или из
пользовательских программ, все сообщения дублируются
определенным кодом выхода из программы PROCRSRV.COM.
    Поскольку при выходе из программы PROCRSRV.COM код
сообщения складывается с кодом состояния этого канала, то в
таблице все сообщения перечисляются с диапазоном кодов
выхода.

 Код выхода
Шестн Десятич     Наименование сообщения
----- -------  ----------------------------------------------
 1-8    1-8    Нормальный выход без ошибки - сообщение не
               выдается. Код выхода соответствует состоянию
               канала связи.

81-88 129-136  "Канал связи не подготовлен"

91-98 145-152  "Ошибка в параметрах"

A1-A8 161-168  "Число д.б. 0 или в диапазоне 3-1800 сек"

A1-A8 161-168  "Число д.б. в диапазоне 1-255"

B1-B8 177-184  "В момент ожидания вызова корректировать
               параметры нельзя"

C1-C8 193-200  "Имя в справочной директории отсутствует"

    Сообщения о ненормальных ситуациях, при которых не
выдаются коды состояний каналов:

  29     41   ProcrSrv.COM parameters saved.
              Команда сохранить параметры выполнена успешно.

  2a     42   ProCarry uninstalled.
              ProCarry удалена из оперативной памяти
              компьютера и область, занимаемая ею, возвращена
              в MS-DOS.

  32     50   ProCarry.sys driver not installed.
              Попытка загрузить PROCRSRV.COM, но драйвер сети
              PROCARRY.SYS не установлен.

  33     51   Error in parameters.
              Выдана команда PROCRSRV.COM с ошибочными
              параметрами.

  34     52   ProcrSrv.COM already installed.
              Попытка повторно загрузить PROCRSRV.COM в
              память: выдана команда без параметров.

  35     53   ProCarry cannot be uninstalled.
              Попытка удалить ProCarry из памяти не
              удалась. До перезагрузки операционной системы
              это уже сделать не получится.

  36     54   Некорректный номер канала.
              В командном режиме работы попытка обратиться к
              несуществующему каналу, т.е. заданный номер
              больше максимального номера канала связи.

  37     55   Некорректная команда.
              Выдана неправильная команда: или ее номер
              больше 40, или запрещенная команда, как,
              например, 08 - Диалог.


Пример DEMO1.BAT

Echo off
cls
Echo Командный файл для вызова абонента
Echo Имя абонента 1-й параметр вызова BAT-файла
Echo Сетевой диск 2-й параметр вызова
Echo Диск с директорией PROCARRY, 3-й параметр вызова
Echo Номер адаптера RS-232 4-й параметр вызова
Echo.
Echo Пример:  C:\PROCARRY\DEMO\DEMO1.BAT UserMain F: C: 0
Echo  - работа с %4-м портом RS-232, вызвать абонента с
Echo    именем %1, который подключится как диск %2
Echo Карты пользователя д.б. в директории \procarry\cards
Echo.
%3
md \PROCARRY\demo
rem Во временную директорию переписываются файлы для передачи
md \PROCARRY\demo\COMM
copy \*.* \PROCARRY\demo\COMM
\PROCARRY\PROCRSRV /a%4/c18 User1 >nul
\PROCARRY\PROCRSRV /a%4/c17 %3\PROCARRY\CARDS >nul
\PROCARRY\PROCRSRV /a%4/c14 60 >nul
\PROCARRY\PROCRSRV /a%4/c16 2 >nul
:Lab1
Rem Задать параметры вызываемой станции с именем,
Rem указанным как параметры команды вызова BAT-файла
\PROCARRY\PROCRSRV /a%4/c9 %1
Rem Проверить: ошибка есть?
If  Errorlevel = 20  Goto :Lab3
Rem Отбой линии
\PROCARRY\PROCRSRV /a%4/c1
Rem Выдать команду начать набор номера
\PROCARRY\PROCRSRV /a%4/c7
If  not Errorlevel = 20  Goto :Lab2
:Lab3
Echo Ошибка в параметрах вызываемой станции
Goto :Labe
Rem Ожидание или отбоя или подключения к сети
:Lab2
\PROCARRY\PROCRSRV /a%4/c11
If  Errorlevel = 6  Goto :Lab2
If  Errorlevel = 5  Goto :Lab1
If  Errorlevel = 2  Goto :Lab2
Rem Подключена сеть. Передать подключенному абоненту данные в
Rem сетевой диск %2 и затем переписать к себе приготовленные
Rem уже там файлы
Copy \PROCARRY\demo\COMM\*.* %2\PROCARRY\demo\RECEIVE
Del \PROCARRY\demo\COMM\*.*
COPY %2\PROCARRY\demo\TRANSMIT\*.* \PROCARRY\demo\COMM
del  %2\PROCARRY\demo\TRANSMIT\*.*
Rem отбить линию
\PROCARRY\PROCRSRV /a%4/c1
Echo Работа с электронным ящиком закончена нормально.
Echo Переданы все файлы
Echo Файлы приняты в \PROCARRY\demo\COMM
:Labe


Пример DEMO2.BAT

Echo off
cls
Echo Командный файл для настройки ожидания вызова от АТС
Echo Диск, где находится директория PROCARRY, 1-й параметр
Echo вызова BAT-файла
Echo Номер адаптера RS-232 2-й параметр вызова
Echo.
Echo Пример:  C:\PROCARRY\DEMO\DEMO2.BAT C: 0
Echo. (работа с 0-м портом RS-232)
%1
md \PROCARRY\demo
rem Во временную директорию переписываются файлы для
Rem передачи абоненту, который подключится
md \PROCARRY\demo\TRANSMIT
md \PROCARRY\demo\RECEIVE
copy \*.* \PROCARRY\demo\TRANSMIT
Rem Настройка справочника и жуpнала состоит из двух команд на
Rem случай, если ранее эти параметы уже были инсталлированы
\PROCARRY\PROCRSRV /a%2/c12 >nul
\PROCARRY\PROCRSRV /a%2/c12 %1\PROCARRY\Demo\Journal.bin >nul
\PROCARRY\PROCRSRV /a%2/c13 >nul
\PROCARRY\PROCRSRV /a%2/c13 %1\PROCARRY\HOST\CARDS >nul
\PROCARRY\PROCRSRV /a%2/c14 60 >nul
\PROCARRY\PROCRSRV /a%2/c15 >nul
\PROCARRY\PROCRSRV /a%2/c22 DEMO >nul
Rem Отбой линии
\PROCARRY\PROCRSRV /a%2/c1
Rem Выдать команду ожидания входящего вызова
\PROCARRY\PROCRSRV /a%2/c4
If  not Errorlevel = 20  Goto :Lab2
:Lab3
Echo Ошибка в параметрах команды ожидания вызова
Goto :Labe
:Lab2
Echo Ваш компьютер установлен на ожидание входящих вызовов
Echo по %2-каналу. При подключении к вам абонентов будет
Echo выдаваться сигнал и производиться запись в журнал.
:Labe


Управление линиями связи из программ пользователя

    Любая пользовательская программа имеет возможность
непосредственно обратиться к резидентной программе
PROCRSRV.COM для выполнения операций по управлению линиями
связи. Для этого пользовательская программа должна записать
определенные значения в регистры и выдать программное
прерывание 2F.


Обращение к PROCRSRV.COM из пользовательской программы

    Для передачи команды программе PROCRSRV.COM с помощью
прерывания 2F используются регистры процессора AX, BX, CX,
DX, DS. Ответная информация передается в регистре AX.
    При выдаче прерывания 2F значения регистров должны быть
следующие:
         AH - шестнадцатиричный код C1;
         DL - шестнадцатиричный код BB;
         AL - номер канала связи;
         BL - код команды;
         DS:CX - адрес строк текстовых параметров.
    Поскольку прерывание 2F используется разными программами
MS-DOS в разных целях, регистры AH и DL содержат
фиксированные числа для того, чтобы PROCRSRV.COM смогла
распознать запрос к ней пользовательской программы.
    Номер канала связи в регистре AL - число от 0 до 9. Если
номер в регистре AL превышает общее число задействованных
адаптеров RS-232, то команда игнорируется.
    Код команды в регистре BL - число от 1 до 40 -
соответствует кодам команд PROCRSRV.COM в командном режиме.
Соответствие этих кодов и команд в ручном режиме приведено в
таблице в описании командного режима работы PROCRSRV.COM.
    Регистры DS и CX задают соответственно сегмент и смещение
адреса строк текстовых параметров, необходимых при выполнении
некоторых команд. Все параметры располагаются в памяти один
за другим и каждый из них заканчивается байтом нулей. Все
текстовые параметры вводятся вместо вопросов, задаваемых
программой PROCRSRV.COM пользователю в ручном режиме работы.
Число таких параметров равно числу вопросов для этой команды.


Ответ PROCRSRV.COM пользовательской программе

    Ответная информация пользовательской программе
возвращается в регистре AX. Все регистры, кроме AX, CX, SI и
DI, после выхода из прерывания 2F остаются неизменными.
    В регистре AH возвращается номер канала связи, для
которого выполнялась команда. Этот номер должен совпадать с
номером канала в регистре AL перед выдачей прерывания 2F.
Если же в регистре AH возвратилось число C1, то это означает,
что система ProCarry не загружена вообще или номер канала в
регистре AL превышает количество каналов, настроенное в
драйвере PROCARRY.SYS.
    В регистре AL возвращается код состояния канала связи и
код ошибки, если она была. Значение в регистре AL точно
такое, как код выхода из PROCRSRV.COM при выполнении операций
в командном режиме - это сумма кода состояния канала связи и
кода ошибки. Коды состояний - числа от 1 до 8. Коды ошибок
перечислены в списке сообщений программы PROCRSRV.COM. Если
операция завершилась успешно, то код выхода в AL равен от 1
до 8, в противном случае код выше 20H (32-х в десятичном
виде).
    Регистры CX:DI содержат адрес поля, в котором находится
имя подключившегося абонента, если в настоящий момент с ним
установлено соединение. Имя заканчивается нулевым байтом.
    Если система ProCarry не инициирована или не загружена в
память программа PROCRSRV.COM, то регистры AX и SI не
изменяются. Это дает удобную возможность проверить, выполнена
ли вообще команда по прерыванию 2F: если регистр AH остался
равным C1, то это означает, что PROCRSRV.COM в оперативной
памяти нет и она, естественно, команду не выполнила.


Пример команды на языке Ассемблер

    Процедура Call_SRV на языке Ассемблер демонстрирует
команду по управлению линиями связи.

Nmb_Chn  db  1       ;Номер канала связи
Commn    db  29      ;Код команды - установить параметры
                     ; для исходящей связи
AddrParm dd  Text
Text     db  'Идент1',0,'Ключ',0,'OKey',0,'Шифр',0,'ATD12345'
Channel  db  ?       ;Номер канала связи после выхода
Kod_Exit db  ?       ;Код выхода из PROCRSRV.COM
Call_SRV proc
   push  ax          ;Сохранить регистры
   push  bx
   push  cx
   push  dx
   push  si
   push  ds
   mov   ah,0C1h     ;Фиксированное число
   mov   al,Nmb_Chn  ;Номер канала связи
   mov   bl,Commn    ;Код команды
   mov   dl,0BBh     ;Фиксированное число
   lds   cx,AddrParm ;Адрес текстовых строк параметров
   int   2fh         ;Обращение к PROCRSRV.COM
   pop   ds          ;Восстановить регистры (кроме AX)
   pop   si
   pop   dx
   pop   cx
   pop   bx
   mov   Channel,ah  ;Номер канала связи
   mov   Kod_Exit,al ;Код выхода
   pop   ax          ;Восстановить регистр AX
   ret               ;Выход из процедуры
Call_SRV endp


Пример программы на языке Паскаль

    Программа CONNECT.EXE, написанная на языке Турбо-Паскаль,
демонстрирует возможности обращения к PROCRSRV.COM для
установки параметров вызываемого абонента (команда SHIFT-F9 в
ручном режиме управления) и набора его номера телефона (в
ручном режиме команда F7). Параметры вызываемого абонента
задаются при запуске CONNECT.EXE сразу вслед за именем
программы и разделяются запятыми:

      CONNECT  Сервер1,Ключ,OKey,Шифр1,ATDP1234

Program Connect;
  {Программа считывает из командной строки параметры       }
  {и выдает команду начать набор номера телефона           }
  {Пример:                                                 }
  {CONNECT прм1,прм2,прм3,шифро-пароль,ATD8-W-(095)123-4567}

  Uses Dos, Crt;

  Const
   tip_AH  = $c1; {Значение регистра AH - константа        }
   tip_DL  = $bb; {Значение регистра DL - константа        }
   Nmb_Chn = 0;   {Номер канала связи                      }
   Commn1  = 29;  {Команда записи данных вызываемой станции}
   Commn2  = 7;   {Команда начать набор номера телефона    }

  Var
     i, j    : Integer;
     Stp     : string[255];
     KodSost : byte;
     reg     : Dos.Registers;

Begin
    {В Stp записываются данные для набора номера абонента}
    {Запятые заменяются разделителем - нулем             }
  For i:=1 to ParamCount  do  Stp := Stp + ParamStr(i);
  Stp := Stp + #0#0#0#0#0;
  For i:=1 to Length(Stp) do  If Stp[i]=',' then Stp[i]:=#0;

  Writeln('Записываются параметры вызываемого абонента.');
  reg.ds := Seg(Stp[1]);
  reg.cx := Ofs(Stp[1]);
  reg.ah := tip_AH;
  reg.dl := tip_DL;
  reg.al := Nmb_Chn;
  reg.bl := Commn1;
  intr($2f, reg);
  KodSost := reg.al;

  If  reg.ah = tip_AH  then
  Begin
     Writeln('Не загружен драйвер PROCRSRV.COM.');
     Halt(1);
  End;

  If  KodSost < 10  then
  Begin
    Writeln('Начало набора номера телефона.');
    reg.ah := tip_AH;  {Если параметры записаны без ошибки, }
    reg.dl := tip_DL;  {выдается команда начать набор номера}
    reg.al := Nmb_Chn; {телефона                            }
    reg.bl := Commn2;
    intr($2f, reg);
    KodSost := reg.al;
  End;

  If  reg.ah <> Nmb_Chn  then
  Begin
     Writeln('Обращение к несуществующему порту RS-232.');
     Halt(1);
  End;

  Writeln('Состояние после выполнения команды:');
  Write('Код ', KodSost, ' (');
  Case  KodSost and $0f  of
     1 : Writeln('Работа в сети)');
     2 : Writeln('Ожидание вызова)');
     3 : Writeln('Проверка вызвавшей станции)');
     4 : Writeln('Передача своих позывных)');
     5 : Writeln('Отбой связи)');
     6 : Writeln('Набор номера)');
     7 : Writeln('Диалог)');
     8 : Writeln('Сеть отключена)');
  End;
  If KodSost>10 then Writeln('Ошибка.Команда не выполнена.');
End.

ЧАСТЬ 6. ПРОГРАММА УСКОРЕННОЙ СВЯЗИ SFAST.EXE


    Программа SFAST.EXE организовывает двустороннюю быструю
передачу файлов и сообщений электронной почты.
    SFAST.EXE передает файлы из директорий OUT в директории
IN, а после освобождения директории OUT сервера передает
запрошенные абонентом файлы из директории COMMON. Работа
сервера несколько отличается от работы абонента при
ускоренной связи.

    Программа SFAST.EXE работает по нескольким протоколам
передачи файлов. Все эти протоколы основаны на Zmodem, но
отличаются от него тем, что передача идет одновременно в двух
направлениях. Это вдвое повышает производительность по
сравнению с Zmodem - самым быстрым из стандартных протоколов
передачи данных!
    Кроме двусторонней передачи данных протокол Sfast
отличается от обычного Zmodem тем, что передаваемые по каналам
связи данные шифруются.
    Протокол Sfast, если применить специальную аппаратную
заглушку, модифицируется таким образом, что связь между двумя
абонентами становится возможной, если они оба располагают
одинаковыми аппаратными ключами-заглушками. Это дает
возможность создавать специальные закрытые сети, работать в
которых могут только те абоненты, которые располагают только
определенного типа ключами.


Работа абонента ускоренной связи

    Связь по протоколу ускоренной связи со стороны абонента
запускается одной из команд Alt-F6, Alt-F2 или Alt-F5. Перед
запуском работы абонента предварительно необходимо командой
Alt-F4 задать главную директорию связи. В ней, в свою
очередь, должны быть следующие поддиректории и файлы:

            main_directory\IN
            main_directory\OUT
            main_directory\SENT
            main_directory\COMMON
            main_directory\JOURNAL.TXT
            main_directory\LIST.REQ

    Во время сеанса связи все полученные с линии файлы
записываются в поддиректорию IN. Все файлы, находящиеся в
поддиректории OUT, передаются в линию. После окончания
передачи файла он из поддиректории OUT удаляется и
переписывается в SENT.
    Внутри директории IN программа сама автоматически создает
промежуточный подкаталог $. Все файлы временно принимаются в
IN\$, а после окончания приема переписываются в IN. Это
позволяет прикладным программам правильно отделять файлы,
прием которых уже окончательно закончен, от файлов, которые
приняты еще не полностью.
    Имена файлов журнала JOURNAL.TXT и запросов LIST.REQ
фиксированные. Файл LIST.REQ содержит список запрашиваемых из
директории COMMON сервера файлов. Каждая строка в LIST.REQ
должна содержать одно имя файла. Имя файла может быть с
именами поддиректорий. Тогда такой файл отыскивается не в
главной директории COMMON сервера, а в соответствующей
поддиректории. Например, если на сервере директория COMMON
D:\PROCARRY\HOST\COMMON, а строка в файле ADVERT\COMP\AL.TXT,
то на самом деле из сервера запрашивается файл

         D:\PROCARRY\HOST\COMMON\ADVERT\COMP\AL.TXT

    В компьютере абонента директория COMMON должна содержать
такие же поддиректории, как и в строках запросов файла
LIST.REQ. Принятые из сервера запрошенные файлы будут
записываться в соответствующие поддиректории. Если же такой
поддиректории нет, то в журнале пишется "Open error" и связь
обрывается. Поэтому все необходимые поддиректории должны быть
созданы заранее.
    После окончания приема запрошенного файла в начале
соответствующей строки файла LIST.REQ ставится отметка '*'.
Этот файл повторно уже запрошен не будет. После окончания
приема всех запрошенных файлов LIST.REQ автоматически
удаляется.
    Если связь по ускоренному протоколу инициируется по
команде Alt-F6, то система автоматически перебирает все
номера телефонов, заданные командой Shift-F10, до тех пор,
пока не установит связь с сервером. Если после этого связь с
сервером в процессе работы по каким-либо причинам прервется,
то система автоматически начнет вызов сервера опять, и это
будет продолжаться до тех пор, пока все сообщения не будут
успешно переданы или оператор не прервет связь командой F1.
    Если связь была инициирована командами Alt-F2 или Alt-F6,
то в случае обрыва линии автоматического перезапуска, как в
случае с Alt-F6, система делать не станет.

    Внутри директории IN программа сама автоматически создает
подкаталог $$, а в нем только один специальный файл $. Файл
IN\$$\$ используется только самой програмой SFAST.EXE. Он
содержит в себе сведения о последних 15 принятых файлах. В
течение 4-6 часов после приема файла повторный прием этого же
файла программой SFAST.EXE блокируется. Это необходимо для
того, чтобы исключить возможность случайной повторной передачи
файла при плохой связи. Если файл IN\$$\$ стереть, то
повторный прием файла становится возможным.


Работа сервера при ускоренной связи

    Сервер электронной почты с использованием SFAST.EXE
включается автоматически из режима ожидания после получения
вызова с линии. Директории для работы с подключившимся
абонентом берутся из соответствующей карточки пользователя.
Это директории с кодами доступа A, B и C - для передаваемых,
принимаемых файлов и файлов общего доступа. Эти директории
соответствуют IN, OUT и COMMON у абонента. Директории,
соответствующей SENT, на сервере нет: все переданные абоненту
файлы из директории OUT просто стираются, а не переписываются
в SENT, как у абонента.
    Имя файла журнала для каждого канала сервера должно быть
задано предварительно командой Alt-F3.
    Файла запросов, аналогичного LIST.REQ, на сервере нет -
запросы в раздел COMMON можно делать только со стороны
абонента. Директория COMMON на сервере выполняет роль,
обратную COMMON абонента: из нее файлы читаются, а у абонента
они в COMMON записываются.
    В карточке пользователя можно ограничить доступ абонента
к файлам и поддиректориям COMMON; это достигается так же, как
и для обычного протокола ProCarry. Если в конце имени
директории, помеченной в карте кодом доступа C (COMMON),
стоит знак #, а вслед за ним буквы и цифры, то ко всем
поддиректориям и файлам COMMON, начинающимся с этих букв и
цифр, доступ абоненту будет запрещен. Вслед за знаком # можно
указывать целые диапазоны запрещенных начальных знаков имен
поддиректорий; символом-разделителем начала и конца диапазона
служит минус "-". Например, #16-9ADE-Z означает, что абоненту
будет запрещен доступ к файлам и поддиректориям в COMMON, имя
которых начинается с 1,6,7,8,9,A,D,E,...,Z.
    В случае окончания сеанса связи или любого другого
разрыва соединения сервер автоматически устанавливается в
режим ожидания новых вызовов.


Алгоритм передачи файлов

    Файлы передаются из директорий OUT и принимаются в IN, а
также из COMMON сервера - в COMMON абонента. При этом, если в
приемной директории уже имеется файл с таким же именем, как и
в новом передаваемом с линии файле, возможно несколько
различных вариантов реакции системы.
    Если файлы имеют разные дату и время создания, то они
считаются различными. Тогда файл в приемной директории COMMON
стирается, а в приемной директории IN переименовывается и
затем вместо него принимается новый.
    Если дата и время создания совпадают, то файл считается
одним и тем же. Здесь возможны 2 варианта. Если размеры
файлов совпадают, то передачи данных не будет, т.к.
считается, что этот файл уже был принят ранее. Если размеры
не совпадают, то считается, что ранее была оборвана связь в
момент передачи этого файла. В этом случае передача данных
начинается не с начала, а продолжается с прерванного места.
    Таким образом, программа ускоренной связи имеет простой и
надежный алгоритм "контрольной точки", а критерием служат
размер, дата и время создания файла.
    Выбор файлов в директориях OUT осуществляется с
использованием двухуровневых приоритетов. Сначала передаются
приоритетные файлы. Их имя должно начинаться с двух
определенных знаков - "0_" (ноль и знак подчеркивания).
Алгоритм выбора файла из директории OUT следующий: сначала
директория OUT сканируется для поиска файла с именем,
начинающимся с "0_". Если такой файл находится, то именно он
и передается в линию. Если приоритетных файлов нет, то тогда
отыскивается и передается любой файл. Перед передачей нового
файла поиск начинается каждый раз заново. Поэтому, если во
время передачи обыкновенного файла в OUT записать
приоритетный файл, следующим будет передаваться именно он.
    Если директория OUT оказалась пустой, другому абоненту
посылается специальное уведомление, что файлов на передачу
пока нет. Абонент может тогда послать запрос файла из COMMON
сервера. После передачи каждого запрошенного файла директория
OUT проверяется заново. Если она пуста, абоненту посылается
новое уведомление с разрешением запросить новый файл и т.д.,
до тех пор, пока у абонента не иссякнет список запросов
LIST.REQ.
    Если директория OUT оказалась пустой и запросов тоже нет,
то передача приостанавливается, т.к. нечего передавать. Если
к этому времени окажется, что и абоненту на другом конце тоже
нечего передавать, то сеанс связи заканчивается.
    Если одна сторона закончила передачу файлов, но еще
продолжает их принимать от другой, каждые 15 секунд она
проверяет директорию OUT заново. Если там за это время
появились какие-либо файлы или на другом конце появился
список запросов LIST.REQ, то передача файлов возобновляется.
    Поэтому алгоритм работы программы ускоренной связи
SFAST.EXE, работающей в фоновом режиме, допускает во время
сеанса связи все время "подбрасывать" для передачи в линию
новые файлы двух приоритетных категорий.
    Связь в конце каждого сеанса заканчивается сразу же после
того, как у обеих сторон закончатся файлы для передачи. По
команде ALT-F7 можно ввести паузу, в течение которой связь не
разрывается и обе стороны ожидают, не появятся ли еще файлы
для передачи. Длительность паузы регулируется при настройке
драйвера PROCARRY.SYS программой PROCRINS.EXE, а по умолчанию
равна приблизительно 2 минутам. Если в процессе выжидания
паузы у одной из сторон в выходной директории появятся файлы,
передача немедленно возобновится.


Журнал программы SFAST.EXE

    Журнал программы ускоренной связи записывается на диск в
текстовом виде. Все позиции в записях журнала строго
фиксированные и это дает возможность создавать программы
обработки и анализа записей журнала.
    Имя файла журнала у абонента JOURNAL\SFAST.TXT, а на
сервере имя задается командой Alt-F3.
    Журнал содержит в каждой строке сведения о номере канала
связи (1-я колонка), дате и времени начала операции, имени
файла, его размере, времени окончания операции, количестве
переданных байт. Если передавался или принимался файл из
раздела COMMON, то его имя может содержать имена
поддиректорий и поэтому не будет помещаться в отведенное для
этого поле. Имя такого файла полностью вместе с именами всех
поддиректорий записывается еще раз в конце строки, начиная с
81-й позиции.
    Имена операций с файлами могут быть следующие: Recv -
файл принят в раздел IN, Send - файл передан из раздела OUT,
CmnR - абонентом принят файл в раздел COMMON, CmnS - сервером
передан файл общего доступа.


Система защиты от несанкционированного доступа

   Программа SFAST.EXE в режиме сервера проверяет серийные
номера подключающихся абонентов. Проверка осуществляется в
том случае, если в той же директории, где находится файл
журнала, имеется файл с фиксированным именем INDEX.DAT.
   Файл INDEX.DAT содержит список серийных номеров программ
ProCarry тех абонентов, которым разрешено подключаться к
серверу. Файл INDEX.DAT создается и корректируется с помощью
программы SCRIBERS.EXE.
   Сразу после того, как установлено входящее соединение,
SFAST.EXE проверяет, имеется ли в директории журнала файл с
именем INDEX.DAT. Если такой имеется, то SFAST.EXE
настраивается на ожидание того, когда абонент передаст свой
серийный номер. До тех пор, пока от абонента серийный номер
не поступит, сервер передавать данные абоненту не начнет.
   Получив от абонента его серийный номер, сервер открывает и
читает базу INDEX.DAT. Если серийный номер в базе найден, то
сеанс связи считается открытым и сервер разрешает передачу и
прием.
   Если серийный номер в базе не найден, то сервер помещает в
журнал запись "Illegal serial number" и немедленно разрывает
соединение. Таким образом на сервере создается дополнительный
заслон от несанкционированного доступа.
   Имеется возможность совместить проверку серийного номера с
проверкой имени абонента. После того, как в базе INDEX.DAT
серийный номер подключившегося абонента найден, автоматически
просматривается графа "User's name". Если в строке с найденным
серийным номером графа "User's name" пустая, то на этом
проверка завершается, абоненту разрешается работать. Если же
в "User's name" имеются какие-то данные, то первые 8 знаков
"User's name" сравниваются с именем подключившегося абонента.
Если имена совпадают, то работа разрешается. Если нет, то
сервер разрывает соединение.
   Графа "User's name" позволяет не просто контролировать
серийные номера абонентов, которым разрешено подключаться к
узлу. С ее помощью указывается, какие имена абонентов должны
соответствовать серийным номерам.

   Если файл INDEX.DAT в директории журнала не найден, то
сервер проверку серийного номера не производит (но в журнале
серийный номер абонента все равно фиксируется) и передача на
сервере начинается немедленно.

   Если проверка серийных номеров выполняется в комплексе с
использованием аппаратных защитных заглушек, то защита от
несанкционированного доступа осуществляется уже на новом
уровне - на аппаратно-программном. Если программы ProCarry
обнаруживают заглушку специальной конструкции в стыке
Centronix, то изменяется протокол Sfast. Связь абонента без
заглушки невозможна с абонентом, у которого такая заглушка
имеется. Кроме того, серийный номер программы должен совпадать
с серийным номером в заглушке.
   Таким образом, заглушка выполняет следующие функции:
во-первых, она защищает серийный номер пользователя на
аппаратном уровне, во-вторых, она изменяет протокол связи
таким образом, что связь может поддерживаться только между
абонентами, имеющими одинаковые типы заглушек. Причем,
пользователи различных сетей также не могут связываться друг с
другом, поскольку типы заглушек у них разные.
   Для использования заглушек не требуются специальные версии
программ. Все возможные типы заглушек в программы уже
заложены. Поэтому, без заглушки программы работают по обычному
протоколу. Но стоит только подключить заглушку, как протокол
автоматически изменяется в соответствии с типом заглушки. Но
при этом серийный номер в заглушке должен совпадать с серийным
номером программы, иначе заглушка игнорируется и ничего не
происходит.
   Серийные номера в программах и в заглушках пользователей
уникальны. Контроль за этим осуществляется изготовителем
программ и заглушек, а также администрациями самих защищенных
сетей.
   Система паролей в системе ProCarry также имеет неоспоримые
преимущества перед другими традиционными системами. Пароль
после подключения абонента к серверу, в отличие от того, как
это делают другие коммуникационные системы, по каналам связи
не передается. После соединения абонент и сервер шифруют
передаваемые данные в соответствии с заданными им паролями.
Если пароли не совпадают, то абоненты не смогут понять друг
друга и связь не получится. Поскольку пароли по каналам связи
не передаются, подслушивание и перехват их невозможны.
   Канальное шифрование передаваемых данных - еще одно
неоспоримое преимущество протокола Sfast. Шифрование
производится в зависимости от паролей, через канал связи не
передаваемых и потому невидимых при подслушивании.
   Использование заглушек в комплексе с проверкой серийных
номеров на серверах позволяет создавать замкнутые защищенные
на аппаратно-программном уровне сети пользователей с
многоступенчатой системой обнаружения и нейтрализации
несанкционированного доступа: со своим собственным уникальным
протоколом Sfast, с контролем доступа по серийным номерам и с
системой изменяемых самими пользователями паролей.

ЧАСТЬ 7: ПРОГРАММА ПЕРЕЗАПИСИ ФАЙЛОВ PROCRUCS.EXE


    Программа PROCRUCS.EXE выполняет те же функции, что и
фоновый драйвер SFAST.EXE. Она принимает файлы из личного
почтового ящика абонента, передает исходящую корреспонденцию
на узел электронной почты и принимает запрошенные файлы из
разделов общего доступа COMMON узла почты.
    В отличие от SFAST.EXE, PROCRUCS.EXE работает не в
фоновом режиме. Протокол связи PROCRUCS.EXE основывается на
системе организации виртуальных дисков драйвером
PROCARRY.SYS. Поэтому эта программа не может работать в
фоновом режиме и время передачи и приема существенно больше,
чем это можно было бы сделать с помощью SFAST.EXE. Однако,
PROCRUCS.EXE работает со всеми типами модемов,
поддерживаемыми ProCarry, в т.ч. и с V.23, с которыми
SFAST.EXE не работает.


Вызов PROCRUCS.EXE

    Сразу после старта программа PROCRUCS.EXE автоматически
начинает операции по приему и передаче файлов через каналы
связи. Вызов ее имеет вид

[Путь]PROCRUCS /AИмя /PИмя /DИмя /Cx/Kxx/B/Z/S/Q/XИмя /Txx:yy

    Обязательные параметры /P, /A, /D. Все остальные ключи
используются только в том случае, если имеются какие-то
отклонения от стандартных вариантов запуска PROCRUCS.EXE.


Описание переключателей

    /AИмя - имя карты пользователя, используемой для вызова
сервера электронной почты. Возможно до 16 параметров /A в
одном запуске программы PROCRUCS.EXE. Программа будет
последовательно перебирать номера телефонов, заложенные в
карточках до тех пор, пока не будет установлено соединение по
одному из них.

    /B - используется выделенная линия связи и модем типа
V.23. Набор номера телефона не производится. Из группы
параметров /A используется только 1-й.

    /Cx - используется номер канала связи ProCarry "x". По
умолчанию используется 0-й канал, т.е. /C0.

    /DИмя - в качестве директории с картами пользователя
используется раздел "Имя". Имена карт пользователя задаются
ключами /A.

    /Kxx - количество циклов перебора номеров телефонов
сервера почты, заданных в картах пользователя переключателями
/A.

    /PИмя - путь поиска и имя файла параметров, откуда
PROCRUCS.EXE берет имена служебных файлов и директорий.

    /Q - перед запуском процедур установления связи с
клавиатуры запрашивается шифро-пароль. Пароль, заложенный в
карточках пользователей, игнорируется.

    /S - используется модем типа V.23 без вызывного прибора.
Номер телефона сервера набирается вручную.

    /XИмя - читать все параметры и ключи не из командной
строки вызова PROCRUCS.EXE, а из файла "Имя".

    /Txx:yy - автоматически начать набор номера телефона
сервера в тот момент, когда наступит время xx:yy.

    /Z - после завершения процедур связи не делать отбой
модема от телефонной линии и не разрывать соединение.

ЧАСТЬ 8: РЕДАКТОР ПОЧТЫ PROCMAIL.EXE


Редактор сообщений электронной почты PROCMAIL.EXE

    Программа PROCMAIL.EXE предназначена для подготовки и
отправки сообщений в электронную почту ProCarry и для
обработки сообщений, принятых из электронной почты.
    PROCMAIL.EXE включает в себя многооконный редактор
текстов, средства для подготовки и обработки сообщений
электронной почты в формате ProCarry Mail, справочник адресов
абонентов почты.
    Связь с узлом электронной почты может быть запущена прямо
из редактора.
    PROCMAIL.EXE имеет возможности использовать систему МАГ
для шифрования и электронного подписывания любых файлов и
сообщений электронной почты.
    Редактор почты имеет множество дополнительных сервисных
функций, таких, например, как калькулятор, календарь,
просмотр факсов и т.п.


Запуск PROCMAIL.EXE

    Вызов редактора почты PROCMAIL.EXE имеет вид

          [путь]PROCMAIL  /Pимя

    Единственный параметр /Pимя задает имя файла со списком
служебных файлов и директорий электронной почты, по умолчанию
PROCRUCS.PRM.
    Пример.

d:\procarry\procmail\procmail  d:\procarry\bel\bel.prm

    При выходе PROCMAIL.EXE формирует коды возврата, которые
можно проверить с помощью команды IF операционной системы.
    0 - нормальное завершение работы программы, линия связи
ProCarry в состоянии отбоя.
    2 - выход после команды 'Запустить связь'. Код выхода 2
используется для запуска в BAT-файлах программы PROCRUCS.EXE.
    3 - нормальное завершение работы программы, линия связи
ProCarry не в состоянии отбоя. Код выхода 3 используется в
BAT-файлах для того, чтобы не выгружать фоновые драйверы
ProCarry из памяти, если в настоящий момент происходят
какие-то операции с линией связи.


Моментальная экранная подсказка

    Программа PROCMAIL.EXE имеет интуитивно понятный экранный
интерфейс. На экране всегда видны разрешенные в настоящий
момент функциональные клавиши и команды. Надписи в меню и в
окошечках функциональных клавиш сами по себе являются
подсказками.
    Кроме того, в любой момент работы программы доступна
подробная контекстная экранная подсказка - моментальная
помощь. Для вызова моментальной помощи используется клавиша
F1.


Управление программой

    Управление программой PROCMAIL.EXE осуществляется с
помощью мыши, функциональных клавиш, меню или строки
состояний внизу экрана.
    Меню включается клавишей F10.
    Функциональные клавиши описаны в надписях меню или строки
состояний. Их можно нажимать независимо от того, включено
меню или нет. Например, клавиша F3 доступна в любой момент и
ее нажатие открывает новое окно редактора текстов.
    Удобнее всего переключать режимы программы с помощью
мыши. Для этого указатель мыши подводится к определенному
фрагменту экрана и нажимается левая кнопка.
    С помощью меню всегда можно определить разрешенные в
настоящий момент команды. Если команда разрешена, то в ее
надписи имеется выделенный красным цветом знак.
    В диалоговых окнах выбор кнопок-операций можно делать с
помощью Tab и Shift-Tab или сразу нажимать на клавиатуре Alt
и тот знак, который выделен в надписи красным цветом.


Многооконный редактор текстов

    Текстовый редактор имеет хорошо развитый сервис. Он
позволяет отмечать блоки, для этого нажимается клавиша Shift
и одновременно с ней клавиши сдвига курсора. Отметку можно
сделать и передвигая мышь с нажатой левой кнопкой. Через
специальное окно - 'Карман', блоки можно копировать и
переносить как в пределах одного окна, так и между различными
окнами и файлами. Имеются удобные функции поиска и замены
текста, с помощью команды Откат можно восстановить последнюю
редактировавшуюся строку. Размер редактируемых файлов - до
64К.


Окна программы

    С помощью меню или мыши можно менять размер окон,
передвигать их произвольным образом по экрану. Можно
разместить на экране сразу несколько окон или перекрыть их
любым способом.
    Для перехода в окно текстового редактора нажимается
клавиша Alt и цифра - номер окна. Для переходов в остальные
окна используются Shift-F5 или Alt-F5.
    Все окна, кроме 'Почтовый ящик', 'Письмо', 'Заголовок' и
'Карман' можно закрыть, нажав Alt-F3.


Структура сообщений в почте ProCarry Mail

    Каждое сообщение электронной почты ProCarry состоит из
'Заголовка', тела сообщения, и присоединенных файлов. Через
электронную почту сообщения передаются в упакованном виде.
    'Заголовок' сообщения несет в себе служебную информацию
и, главным образом, предназначен для самой электронной почты.
Заголовок состоит из полей, таких, например, как To:,
Subject:, From:. Главные поля в заголовке задают адресатов
сообщения, однако есть поля, описывающие отправителя, дату
отправления, маршрут следования сообщения и т.п.
    Тело сообщения представляет собой обычный текст - письмо.
Нет никаких ограничений на объем, структуру и содержание
письма. В редакторе почты тело сообщения готовится в окне
'Письмо'.
    Присоединенные файлы задаются полем Attach: в заголовке.
На эти файлы нет никаких ограничений по количеству, размеру и
содержанию. Это могут быть текстовые файлы, графические, базы
данных, электронные таблицы, программы и т.п.

    Сообщение упаковывается особым образом. Тело сообщения
оформляется в виде файла с названием $$$$MAIL.TXT и
упаковывается вместе со всеми присоединенными файлами.
Упаковщик и распаковщик, в принципе, могут быть любыми.
Однако в пакете ProCarry поставляется упаковщик,
обеспечивающий достаточно высокую степень сжатия и, самое
главное, при упаковке с паролем - очень высокую
криптографическую защиту информации.
    Сообщения, отправляемые в электронную почту, могут быть
зашифрованы с помощью системы МАГ, основанной на
использовании метода открытых ключей.

    В следующей таблице упакованное сообщение разбито на 2
части. Вторая часть формируется упаковщиком, редактор почты
берет ее без изменений и присоединяет к ней заголовок в
текстовом виде, контрольную сумму и длину упакованной части.
Такая структура сообщения обеспечивает ему минимальные
размеры и надежность в защите от несанкционированного
доступа; в то же время службы электронной почты могут
свободно манипулировать заголовком и контролировать искажения
сообщения, если они вдруг случатся.

 :-------------------------------------:
 : Заголовок в текстовом виде          :
 : Байт FF - конец заголовка           :
 : Байт FF или FE(упаковано с паролем) :
 : 4 байта - длина упакованной части   :
 :-------------------------------------:
 :      Упакованная часть:             :
 : Служебная информация упаковщика     :
 : Файл $$$$MAIL.TXT - тело сообщения  :
 : 1-й присоединенный файл             :
 :         . . .                       :
 : Последний присоединенный файл       :
 :-------------------------------------:
 : 4 байта - К.С. упакованной части    :
 :-------------------------------------:


Окно 'Заголовок'

    Окно 'Заголовок' предназначено для ввода заголовков
сообщений, отправляемых в электронную почту. Текст сообщений
формируется в окне 'Письмо'.
    Заголовок сообщения состоит из полей. Каждое поле
занимает одну строку и состоит из ключевой строки,
обязательно заканчивающейся знаком ":", и текста - содержания
поля. Кроме полей в заголовок ничего вводить нельзя.
Максимальная длина строки в заголовке (одного поля) - 255
знаков.
    При упаковке сообщения для передачи в электронную почту
редактор сам добавляет к заголовку дату и время и
переставляет поля в нужном порядке.
    Электронная почта на базе ProCarry использует несколько
типов полей. Полей каждого типа может быть несколько в любом
сообщении. В ProCarry Mail обрабатываются поля:

    To: адрес получателя сообщения
    Cc: адрес получателя копии сообщения
    Re: адрес для ответа на сообщение
    Subject: предмет или тема сообщения
    Handling: специальные операции
    From: адрес отправителя сообщения
    Via: имя узла электронной почты
    Ret: текст для квитанции
    Rets: текст для квитанции
    Retm: текст для квитанции
    Receipt: сведения о доставке сообщения
    Signature: имя пользователя
    MagPro: имя пользователя

    Все остальные поля электронная почта на базе ProCarry не
обрабатывает и игнорирует. Такие поля могут быть необходимы
при передаче сообщений во внешние электронные почты.
    С помощью определенных полей в заголовке можно
формировать специальные запросы. Такими запросами могут быть,
к примеру, объявления, помещаемые в разделы общего доступа
узлов почты или запросы информации из удаленных узлов почты
или серверов баз данных.

    'Заголовок', также как и 'Письмо', является обычным
ненумерованным окном редактора текстов. В окне 'Заголовок'
допустимы все операции редактора текстов. Можно набирать и
корректировать любые тексты. Разрешены все операции с
блоками, в т.ч. и сохранение и чтение блоков из файлов на
диске. Блоки можно переносить через 'Карман' между окнами
редактора.


Поля To:, Cc:, Re:

    To:  адрес получателя сообщения

    Cc:  адрес получателя копии сообщения

    Re:  адрес для ответа на сообщение

    Адресом может быть имя абонента почты, номер телефона или
телетайпа. Поля To: или Cc: формируются с помощью справочника
адресов или набиваются вручную. Для формирования поля Re:
имеется специальная команда.
    Действие всех трех типов полей одинаковое. Они задают
адрес, по которому электронная почта доставляет сообщение.
Службы электронной почты не делают никакой разницы между
этими полями. Разница лишь в толковании текста получателями.
To: задает одного из основных получателей, Cc: - адрес
получателя копии, Re: - адрес для ответа на полученное
сообщение.


Поле Subject:

    Subject:  предмет или тема сообщения

    Это поле необязательное. Получатель, не распаковывая все
сообщение, может по этому полю узнать, о чем идет речь в
письме.
    При посылке объявления в раздел общего доступа COMMON
одного из узлов почты поле Subject: должно содержать
комментарий к сообщению, который будет помещен в список
файлов.


Поле Handling:

    Handling:  специальные операции

    Поле Handling: указывает службе электронной почты
выполнить некоторые нестандартные или специальные операции с
сообщением. Это поле необязательное. Список возможных
нестандартных операций можно получить в самой службе
электронной почты.


Поле From:

    From:  адрес отправителя сообщения

    Поле From: указывает сетевой почтовый адрес отправителя
сообщения. Однако его формирует не сам отправитель, а сервер
электронной почты, куда он его переслал. Если в принятом
сообщении поле From: отсутствует, это означает, что
отправитель сообщения зарегистрирован в сети как узел. В этом
случае обратный адрес определяется по полю Via:.
    Поле From: формируется только узлами почты.


Поле Receipt:

    Receipt:  сведения о доставке сообщения

    Поле Receipt: формируется сервером электронной почты и
находится в квитанции на отправленное ранее сообщение.
Квитанция формируется в случае, если сообщение удачно
передано адресату - абоненту электронной почты, помещено в
раздел объявлений узла электронной почты, распечатано для
передачи обычной почтой или передано во внешнюю электронную
почту. Если адрес - факс или телетайп, то квитанция
формируется после удачного или неудачного окончания передачи
сообщения. Если в одном сообщении несколько адресов, то
квитанции будут сформированы для каждого из них.
    Посылая сообщение, абонент может отменить посылку ему
квитанций. Для этого ему необходимо поместить в заголовок
своего сообщения поле Receipt: без параметров.

    Квитанции могут быть двух типов: на сообщение, которое
доставлено самому абоненту (формируются по полю Ret: или
автоматически), и на сообщение, которое дошло до последнего
почтового ящика, откуда его может забрать абонент-получатель
(формируются по полям Rets: или Retm:).

    Поле Receipt: формируется узлами почты, но абоненты также
могут вводить это поле в сообщение, если они хотят подавить
автоматическое формирование квитанций.


Поле Via:

    Via:  имя узла электронной почты

    Служебное поле Via: формируется каждым из узлов почты,
через которое проходит сообщение. Via: используется для
взаиморасчетов между узлами.
    Поле Via: может формироваться только узлами почты.


Поле Ret:

    Ret:  текст для квитанции

    Поле Ret: формирует абонент-отправитель сообщения. Если в
тексте сообщения присутствует Ret:, то после доставки
сообщения будет сформирована квитанция, которая будет
возвращена отправителю. В отличие от полей Rets: и Retm:,
квитанция по полю Ret: формируется только после того, как
получатель заберет сообщение из своего почтового ящика.
    Текст, набранный в поле Ret:, будет введен в возвращаемую
квитанцию в поле Receipt: и это дает возможность точно
определить, в ответ на какое именно сообщение прислана
квитанция.


Поле Rets:

    Rets:  текст для квитанции

    Поле Rets: формирует абонент-отправитель сообщения. Если
в тексте сообщения присутствует Rets:, то после доставки
сообщения будет сформирована квитанция, которая будет
возвращена отправителю. В отличие от поля Ret:, квитанция по
полю Rets: формируется сразу после того, как сообщение
попадет в последний почтовый ящик, откуда его может забрать
получатель.
    Текст, набранный в поле Rets:, будет введен в
возвращаемую квитанцию в поле Receipt: и это дает возможность
точно определить, в ответ на какое именно сообщение прислана
квитанция.


Поле Retm:

    Retm:  текст для квитанции

    Поле Retm: формирует абонент-отправитель сообщения. Если
в тексте сообщения присутствует Retm:, то после доставки
сообщения в нем с помощью системы МАГ будет проверена
электронная подпись, а затем сформирована квитанция, которая
будет возвращена отправителю. В отличие от поля Ret:,
квитанция по полю Retm: формируется сразу после того, как
сообщение попадет в последний почтовый ящик, откуда его может
забрать получатель.
    Текст, набранный в поле Retm:, будет введен в
возвращаемую квитанцию в поле Receipt: и это дает возможность
точно определить, в ответ на какое именно сообщение прислана
квитанция.


Поле Signature:

    Signature:  имя пользователя

    Это поле формируется автоматически, если упакованное
сообщение подписано с помощью системы МАГ. Имя пользователя
соответствует имени на ключевой дискетте.
    При распаковке сообщения поле Signature: указывает
автоматически запустить процедуры проверки электронной
подписи.

Поле MagPro:

    MagPro:  имя пользователя

    Это поле формируется автоматически, если упакованное
сообщение зашифровано с помощью системы МАГ. Имя пользователя
соответствует имени на ключевой дискетте и при
расшифровывании указывает идентификатор абонента,
зашифровавшего сообщение.
    При распаковке сообщения поле MagPro: указывает
автоматически запустить процедуры расшифровывания системы
МАГ.


Адрес в почте ProCarry Mail

    Адрес в сообщениях, циркулирующих по почте, обязательно
должен включать внутренний почтовый адрес ProCarry Mail.
    Кроме того, адрес может включать дополнительные графы,
уточняющие адресата, если сообщение необходимо передать на
телетайп, на факс, во внешнюю электронную почту или в
традиционную бумажную почту. Внутренний адрес ProCarry Mail в
этом случае указывает узел ProCarry, на который пересылается
сообщение, там автоматически конвертируется и далее
пересылается заданным способом.

    Внутренний адрес в почте ProCarry Mail имеет вид:

To: xxxxxxx.xxxxxxxx.xxxxx.xxxxxx

    Адрес состоит из заголовка поля To:, Cc: или Re: и группы
имен, отделенных друг от друга точками. Внутри адреса
недопустимы пробелы.


Номер телефона факса

    Адрес - номер факса в почте ProCarry Mail имеет вид:

To: xxxx.xxxx.xx Fax: xxxxxxx Handling: xxxxx

    Адрес состоит из заголовка поля To:, Cc: или Re:, адреса
в почте ProCarry Mail и подполей Fax: и Handling:.
    Адрес ProCarry Mail задается в обычном виде - группа
имен, разделенных точками. В адресе недопустимы пробелы. Это
адрес узла в почте ProCarry, на который следует передать
сообщение и на котором сообщение будет автоматически
сконвертировано и передано на телефакс.
    В поле с адресом могут также присутствовать подполя Fax:
и Handling:. Все подполя должны следовать только вслед за
адресом в ProCarry Mail, далее их порядок не имеет значения.
    Fax: - номер телефона, к которому подключен телефакс. Для
получателей факсов номер телефона является их адресом.
Необходимо указывать полный телефонный номер с кодом города и
с кодом страны, если необходимо.
    Handling: - дополнительные сведения, передаваемые в
электронную почту вместе с номером телефона. В этой графе
сообщаются дополнительные команды, управляющие передачей
факса абоненту. Графа должна иметь вид

        ЧЧ-ЧЧ/Д(ККК/ИИИ)/D/F

    Здесь ЧЧ-ЧЧ/Д означает диапазон времени суток, когда факс
абонента включен, и дни недели. Дни недели задаются цифрой 0,
1 или 2. 0 означает, что передача разрешена в любой день
недели, 1 - с понедельника по пятницу, 2 - в любой день
недели, кроме воскресенья. Диапазон времени суток может
задаваться с переходом на следующие сутки, тогда второе число
меньше первого. Часы, указанные в выражении, сами также
включаются в диапазон.
    Выражение в скобках задает количество попыток вызвать
абонента - число ККК, и интервал между попытками в минутах  -
число ИИИ.
    Ключ /D необязательный, он задается в конце графы
Handling: и указывает, что абоненту не передается заголовок
сообщения; по умолчанию, если ключа /D нет, в факсе сначала
передается заголовок, а затем уже и само сообщение.
    Если указан ключ /F, то факс передается с повышенным
качеством изображения, но время передачи при этом
увеличивается вдвое.
    Если в поле To: подстроки Handling: нет, то по умолчанию
сервер почты пытается круглосуточно 255 раз вызвать абонента
с интервалом в 30 минут, факс будет передаваться с нормальным
качеством.
    Примеры:

    Handling: 17-17/1/D/F
    Handling: (005/025)
    Handling: 08-19(010/010)/F
    Handling: /D
    Handling: 20-08/1


Номер телетайпа

    Адрес - номер телетайпа в почте ProCarry Mail имеет вид:

To: xx.xx.xx Telex: xxx Type: x AnswerBack: xxx Handling: xxx

    Адрес состоит из заголовка поля To:, Cc: или Re:, адреса
в почте ProCarry Mail и подполей Telex:, Type: и т.д.
    Адрес ProCarry Mail задается в обычном виде - группа
имен, разделенных точками. В адресе недопустимы пробелы. Это
адрес узла в почте ProCarry, на который следует передать
сообщение и на котором сообщение будет автоматически
сконвертировано и передано по телексным линиям связи.
    В поле с адресом могут также присутствовать подполя
Telex:, Type:, AnswerBack: и Handling:. Все подполя должны
следовать только вслед за адресом в ProCarry Mail, далее их
порядок не имеет значения.
    Telex: - номер телетайпа. Для получателей телеграмм графы
Telex: и Type: являются их адресом.
    AnswerBack: - автоответчик телетайпа. Если автоответчик в
адресе сообщения будет указан, то телеграфный сервер почты,
прежде чем начать передачу телеграммы, проверит автоответчик
вызванного телетайпа. Хотя эта графа и необязательная,
желательно автоответчик задавать всегда, т.к. других
возможностей проверить правильность соединения с телетайпом
абонента нет.
    Type: - тип телеграфной сети. Эта графа обязательная,
вместе с номером телетайпа она задает адрес получателя
телеграмм. Существует несколько типов замкнутых телеграфных
сетей - международный телекс, абонентский телеграф АТ,
железнодорожный телеграф, 200-бодные сети ПС передачи
сообщений и др. Тип телеграфной сети задается цифрой. Коды
всех телеграфных сетей, к которым подключена почта ProCarry,
можно узнать в службе электронной почты.
    Handling: - дополнительные сведения, передаваемые в
электронную почту вместе с номером телетайпа. В этой графе
сообщаются дополнительные команды, управляющие передачей
телеграмм абоненту. Графа должна иметь вид

       ЧЧ-ЧЧ/Д(ККК/ИИИ)/D

    Здесь ЧЧ-ЧЧ/Д означает диапазон времени суток, когда
телетайп абонента включен, и дни недели. Дни недели задаются
цифрой 0, 1 или 2. 0 означает, что передача разрешена в любой
день недели, 1 - с понедельника по пятницу, 2 - в любой день
недели, кроме воскресенья. Диапазон времени суток может
задаваться с переходом на следующие сутки, тогда второе число
меньше первого. Часы, указанные в выражении, сами также
включаются в диапазон.
    Выражение в скобках задает количество попыток вызвать
абонента - число ККК, и интервал между попытками в минутах -
число ИИИ.
    Ключ /D необязательный, он задается в конце графы
Handling: и указывает, что абоненту не передается заголовок
сообщения; по умолчанию, если ключа /D нет, в телеграмме
сначала передается заголовок, а затем уже и само сообщение.
    Если в поле To: подстроки Handling: нет, то по умолчанию
сервер почты пытается круглосуточно 255 раз вызвать абонента
с интервалом в 30 минут.
    Примеры:

    Handling: 17-17/1/D
    Handling: (005/025)
    Handling: 08-19/2(010/010)
    Handling: /D


Адрес внешней электронной почты

    Адрес для передачи во внешнюю электронную почту имеет
вид:

To: xxxx.xxxx.xx EMS: xxxxx MBX: xxxxxxxxxxxxxxx

    Адрес состоит из заголовка поля To:, Cc: или Re:, адреса
в почте ProCarry Mail и подполей EMS: и MBX:.
    Адрес ProCarry Mail задается в обычном виде - группа
имен, разделенных точками. В адресе недопустимы пробелы. Это
адрес узла в почте ProCarry, на который следует передать
сообщение и на котором сообщение будет автоматически
сконвертировано и через шлюз передано в заданную электронную
почту.
    В поле с адресом могут также присутствовать подполя EMS:
и MBX:. Все подполя должны следовать только вслед за адресом
в ProCarry Mail, далее их порядок не имеет значения.
    EMS: - имя внешней электронной почты.
    MBX: - адрес абонента внутри электронной почты, заданной
в подполе EMS:. В одном адресе подполей MBX: может быть
несколько.


Адрес бумажной почты

    Почтовый адрес имеет вид:

To: xx.xx.x Country: xx Code: xx City: xx Line1: xx Title: xx

    Адрес состоит из заголовка поля To:, Cc: или Re:, адреса
в почте ProCarry Mail и подполей Country:, City: и т.д.
    Адрес ProCarry Mail задается в обычном виде - группа
имен, разделенных точками. В адресе недопустимы пробелы. Это
адрес узла в почте ProCarry, на который следует передать
сообщение и на котором сообщение будет автоматически
распечатано и отправлено обычной почтой или курьером.
    В поле с адресом могут также присутствовать подполя
Country:, Title:, Line1:, Line2:, City:, State:, Code:. Все
подполя должны следовать только вслед за адресом в ProCarry
Mail, далее их порядок не имеет значения.
    Country: - страна.
    Code: - почтовый индекс.
    State: - название штата США, область в России и т.п.
    City: - название города.
    Line1:, Line2: - текстовые строки с адресом, например,
название улицы с номером дома и т.п.
    Title: - фамилия с инициалами или название фирмы.


Окно 'Письмо'

    Окно 'Письмо' предназначено для ввода тела сообщения,
отправляемого в электронную почту, или, другими словами,
письма. Заголовок сообщения формируется в окне 'Заголовок'.
    Письмо, как и заголовок, - обязательный атрибут любого
сообщения в почте ProCarry Mail. Письмо оформляется в файл
с названием $$$$MAIL.TXT, упаковывается в "конверт" вместе с
присоединенными файлами специальной программой, а затем
"подклеивается" к заголовку, передаваемому в открытом виде.
Даже если никакого письма сообщение не содержит, все равно
упаковывается пустой файл $$$$MAIL.TXT.
    Упакованный конверт может быть зашифрован и подписан по
системе МАГ, поэтому почта ProCarry предоставляет абсолютно
надежные возможности для передачи секретных сообщений.
    Содержание и размер тела сообщения - письма ничем не
ограничены.

    Окно 'Письмо' является обычным ненумерованным окном
редактора текстов. В нем допустимы все операции редактора
текстов. Можно набирать и корректировать любые тексты.
Разрешены все операции с блоками, в т.ч. и сохранение и
чтение блоков из файлов на диске. Блоки можно переносить
через 'Карман' между окнами редактора.


Присоединенные файлы

    Любое сообщение в почте ProCarry Mail состоит из
заголовка, письма и присоединяемых файлов. Число
присоединяемых файлов ничем не ограничено.
    Все передаваемые в сообщении файлы упаковываются в один
конверт вместе с файлом письма $$$$MAIL.TXT. Упакованный
конверт может быть зашифрован и подписан по системе МАГ.
    Присоединяемые файлы могут иметь совершенно любые имена,
эти имена сохранятся и при распаковке получателем принятого
сообщения.
    На содержимое файлов не накладываются никакие
ограничения, т.е. это могут быть как текстовые, так и любые
двоичные файлы: базы данных, электронные таблицы, загрузочные
модули программ и т.п.
    Исключения из этого только при передаче сообщения на
телетайп, факс, во внешнюю электронную почту или при
распечатке сообщения. Передаваться на телетайп или
распечатываться на бумаге могут только текстовые файлы. Во
внешние электронные почты, в принципе, могут быть переданы
любые файлы, но некоторые почты имеют ограничения.
    В графическом виде на факс могут быть переданы только
файлы с расширениями PCX, TIF, FAX. Файлы с расширениями FAX
должны быть сформированы специальными программами при
получении факса в компьютер. Все остальные файлы для передачи
на факс должны быть текстовыми.


Окно 'Почтовый ящик'

    В окне 'Почтовый ящик' можно просмотреть все принятые из
электронной почты сообщения. Сообщения из электронной почты
принимаются в упакованном виде в отдельную директорию для
входящих файлов. Поэтому в окне просматриваются не сами
сообщения, а только часть их текстовых заголовков.
    Для просмотра всего сообщения необходимо выдать
специальную команду для распаковки и затем прочитать
полученные файлы в окна редактора текстов.


Подготовка сообщений для отправки в почту

    Сообщения почты ProCarry Mail имеют определенный формат и
поэтому должны быть подготовлены специальными программами.
Редактор почты PROCMAIL.EXE располагает всеми необходимыми
средствами для формирования сообщений. Для этого в нем
имеются окна редактора текстов 'Заголовок' и 'Письмо' и
множество различных команд, управляющих упаковкой и сборкой
сообщений.
    Все команды в редакторе почты задаются в интерактивном
режиме. Построить автоматическую систему подготовки и
отправки почты с его помощью нельзя.

    Встраивание подготовки и отправки сообщений в
автоматические пользовательские системы производится с
помощью программы PFM.EXE.
    Программа PFM.EXE умеет упаковывать и собирать любые
сообщения почты ProCarry Mail. Она может упаковать файл
письма и любые присоединенные файлы в "конверт", зашифровать
и подписать этот конверт с помощью системы МАГ, "подклеить"
конверт к заголовку.
    Все параметры для работы программы PFM.EXE задаются через
командную строку ее вызова. Поэтому PFM.EXE легко может быть
вызвана через командные файлы или прямо из пользовательских
программ.


Обработка принятых из электронной почты сообщений

    Принятые из почты ProCarry Mail сообщения имеют
специальный упакованный и зашифрованный формат. "Развернуть"
и прочитать их содержимое можно с помощью специальных
программ.
    В интерактивном режиме обработать принятые сообщения
можно с помощью редактора почты. Для этого он имеет
специальное окно 'Почтовый ящик'.
    Для встраивания распаковки сообщений в командные файлы и
в прикладные программы пользователя предназначена программа
PFM.EXE. Эта программа может распаковывать любые сообщения
почты, в т.ч. зашифрованные и подписанные по системе МАГ. Все
параметры для работы PFM.EXE задаются в командной строке при
ее вызове.


Справочник абонентов почты

    Адреса, кому предназначены сообщения почты, всегда
располагаются в заголовках в полях To:, Cc:, Re:. В редакторе
почты имеется специальное окно 'Заголовок', в котором можно
вручную с помощью текстового редактора ввести текст любого
адреса. Однако для облегчения задания адресов в программе
PROCMAIL.EXE имеется удобный справочник абонентов.
    Обычно справочник абонентов находится в файле с именем
PROCMAIL.DAT в той же директории, откуда запускается и сама
PROCMAIL.EXE. Однако есть возможности использовать и
несколько различных файлов-справочников.
    Справочник абонентов состоит из отдельных вложенных
справочников: абонентов почты ProCarry Mail, телеграфного,
факсового, абонентов внешних электронных почт и "бумажной"
почты.


Шифрование файлов

    Редактор почты PROCMAIL.EXE совмещен с системой
шифрования файлов МАГ. Система МАГ основывается на самых
современных криптографических методах, разработанных и
принятых в качестве стандарта правительственными органами
безопасности России.
    В PROCMAIL.EXE задействованы все элементы системы
шифрования МАГ. Редактор предоставляет удобную программную
оболочку для шифрования и расшифровывания любых файлов, для
создания ключей шифрования и ведения баз открытых ключей.
    Сообщения, передаваемые через электронную почту ProCarry
Mail, также могут быть зашифрованы с помощью МАГа.

    Собственный упаковщик из пакета ProCarry также имеет
криптографические возможности. Поэтому сообщения в почте
ProCarry могут быть зашифрованы и без системы МАГ. Главный
недостаток по сравнению с МАГом - упаковщик не использует
метод открытых ключей. Но, тем не менее, он использует
надежные методы шифрования и обеспечит достаточную
безопасность для тех пользователей, которые не имеют пакета
МАГ.


Электронная подпись по системе МАГ

    Электронная подпись по системе МАГ представляет собой
небольшой зашифрованный блок, "подклеиваемый" к файлу. В этом
блоке находится информация о самом файле и о том, кто
"подписал" его. Блок зашифрован по системе МАГ, поэтому
невозможно изменить ни сам файл, ни блок - электронную
подпись, без того, чтобы это не было замечено. Электронная
подпись по системе МАГ гарантирует, что подписанный файл не
искажен, и она однозначно указывает владельца этой подписи.
Подделать подпись невозможно, проверить ее и прочитать имя
подписавшего может каждый, имеющий пакет МАГ.
    Электронная подпись может применяться в комплексе с
шифрованием.
    Редактор почты располагает всеми необходимыми
процедурами, чтобы запустить систему МАГ и подписать любой
файл или сообщение электронной почты, проверить или удалить
электронную подпись из любого подписанного файла.


Запрос информации из разделов COMMON узлов почты

    Узлы почты ProCarry Mail не только выполняют роль шлюзов
и "сортировщиков" корреспонденции. Каждый из них имеет также
собственную информационно-справочную доску объявлений -
разделы общего доступа COMMON, в которых располагаются
различные файлы.
    Редактор почты имеет все необходимые средства для работы
с разделами COMMON. В нем имеются команды для просмотра
списков файлов и для запроса и приема к себе выбранной
информации.


Запуск процедур связи

    Редактор почты имеет команды для запуска и контроля
процедур связи. Можно запустить как фоновую коммуникацию
SFAST, так и медленную не фоновую PROCRUCS.EXE.
    Если запущена фоновая связь, то можно продолжить работу в
редакторе почты. Коммуникация при этом будет происходить
параллельно и без всякого ущерба для работы других программ.
Если выйти из редактора почты, то фоновая коммуникация все
равно не сбросится и продолжится до полной перезаписи всех
файлов. В случае обрыва связи автоматически, опять же в
фоновом режиме, программа SFAST.EXE заново наберет номер
телефона и продолжит коммуникацию.


Просмотр факсов

    Почта ProCarry Mail имеет специальные автоматические
серверы, с помощью которых можно передать сообщение от любого
абонента на телефакс. Принятые серверами факсы можно
доставить любому абоненту почты.
    Редактор почты имеет возможность обрабатывать принятые
факсы. Он содержит команды для просмотра и распечатки факсов
и для конвертирования их в формат PCX.


Редактирование карточек пользователя

    Карточки пользователей - текстовые файлы определенной
структуры с расширениями PCR - используются драйверами
системы ProCarry для набора номера и вызова абонентов через
коммутируемую телефонную сеть или через сети пакетной
коммутации Х.25, а также серверами почты для проверки
подключающихся к ним абонентов.
    В большинстве случаев карточки пользователя создаются
специальными программами. В программе PROCMAIL.EXE имеется
команда, с помощью которой можно вносить изменения в карточки
вручную.

ЧАСТЬ 9: УТИЛИТА ОБРАБОТКИ СООБЩЕНИЙ ПОЧТЫ


Утилита PFM.EXE обработки сообщений ProCarry Mail

    С помощью PFM.EXE можно встраивать обработку сообщений
ProCarry Mail непосредственно в пользовательские системы и
упаковывать-распаковывать сообщения в формате почты без
использования редактора PROCMAIL.EXE.
    PFM.EXE может быть вызвана как из командного файла DOS,
так и из любой пользовательской программы. Сообщения о
результатах своей работы PFM.EXE передает с помощью различных
кодов завершения программы.
    Программа PFM.EXE для упаковки и распаковки сообщений
использует упаковщик PROCRCMP.EXE из пакета ProCarry Mail.
Если сообщения "подписываются" или при распаковке проверяется
цифровая подпись, то используется программа SIGN.EXE. Для
шифрования на основе метода открытых ключей используются
программы ENCRYPT.EXE и DECRYPT.EXE.
    Все программы - PROCRCMP.EXE, SIGN.EXE, ENCRYPT.EXE и
DECRYPT.EXE должны находиться в той же директории, где и
сама программа PFM.EXE.


Упаковка сообщения

    За один вызов программы PFM.EXE упаковывается одно
сообщение. Вызов PFM.EXE для упаковки имеет вид

     PFM   /Pимя /Rимя /Kпароль /C /F /G /N"код"

    Обязательные только параметры /P и /R.
    /Pимя указывает результирующее имя упакованного
сообщения. Имя может задаваться с именем диска и директории.
Если в указанной директории файл с таким именем уже есть, то
PFM.EXE сама автоматически подберет имя таким образом, чтобы
не испортить ни один из уже имеющихся в директории файлов.
Это дает возможность прикладной программе вызывать PFM.EXE
всегда с одним и тем же параметром /P, т.е. не подбирать
каждый раз командную строку, а иметь только одну на все время
использования PFM.EXE.
    /Rимя - задает имя текстового файла параметров, в котором
указаны все необходимые данные для подготовки сообщения.
    /Kпароль - необязательный параметр, он задает строку с
ключом для шифрования сообщения упаковщиком PROCRCMP.EXE или
пароль для расшифровывания содержимого ключевой дискетты
электронной подписи системы МАГ.
    Параметры /C, /F и /G необязательные, они задают
использование системы МАГ. Одновременно может задаваться
только один из этих параметров.
    /C - упакованное сообщение должно быть "подписано".
    /F - упакованное сообщение должно быть зашифровано
системой МАГ.
    /G - упакованное сообщение должно быть сначала
зашифровано системой МАГ, а затем "подписано".
    /N"код" - задается только вместе с одним из ключей /F или
/G. В двойных кавычках должен быть задан код пользователя,
для которого шифруется сообщение. Необходимо точно повторять
текстовую строку - идентификатор, под которым абонент
зарегистрирован в базе, учитывая пробелы, знаки препинания и
большие-малые буквы.


Файл параметров

    Первая строка файла параметров описывает заголовок и
адрес сообщения. В ней задается или имя текстового файла, в
котором содержится заголовок сообщения, или поле To: с
адресом.
    Вторая строка в файле параметров - имя файла с письмом,
присоединяемым при распаковке к заголовку.
    Третья и все остальные строки - имена файлов,
упаковываемых и пересылаемых в сообщении; здесь можно
задавать и группы файлов с помощью знаков ? или *.
    В файле параметров обязательная только первая строка.
Если присоединенного письма нет, то вторая строка должна быть
пустой.
    Все задаваемые имена файлов должны содержать имя
дисковода и путь.


Коды завершения

     0 - нормальная упаковка сообщения;
     1 - не найден заданный во 2-й строке файл письма,
         присоединяемого к заголовку;
     2 - не найдены один или несколько файлов, указанных в
         файле параметров в 3-й или последующих строках для
         упаковки и пересылки в сообщении;
     5 - не найдена программа-упаковщик PROCRCMP.EXE;
     6 - не найден заданный в 1-й строке файл заголовка;
     7 - ключом /R не задан файл параметров;
     8 - ошибка при записи результирующего упакованного файла
         сообщения;
     9 - неверная строка параметров при вызове PFM.EXE;
    15 - не найдена программа цифровой подписи SIGN.EXE;
    16 - ошибки при подписывании сообщения;
    18 - программа шифрования не найдена;
    19 - ошибка чтения ключевой дискетты;
    21 и выше - ошибки, замеченные программой шифрования;
         код ошибки равен 20 плюс код, выданный ENCRYPT.EXE
         или DECRYPT.EXE.

    Коды выхода 1 и 2 выдаются для привлечения внимания. Они
означают, что сообщение упаковано, но при этом не найдена
часть файлов. Все остальные коды больше 4-х означают
аварийный выход из процедуры упаковки; сообщение для передачи
в почту при этом не оформлено.


Примеры

Echo off
pfm /pmessage.1 /rparm.txt /k%1 /G /N"SCRIB000"
If  ErrorLevel = 5  goto :quit
If  ErrorLevel = 1  goto :m1
Echo Сообщение подготовлено нормально
goto :quit
:m1
Echo Сообщение подготовлено, есть не найденные файлы
:quit


Echo off
PFM.EXE /RFILE.T01 /PLETTER.TTT


Примеры файлов параметров

TO:abonent.pronet              1 строка
c:\work\letter.doc             2  "-"
c:\fx\*.*                      3  "-"
c:\tr\command.com              4  "-"


D:\DB\subt.prn                 1 строка
                               2  "-"
c:\fox\12\M723A544.OUT         3  "-"


D:\DB\subt.prn                 1 строка
c:\mail\lett.12                2  "-"


Распаковка сообщения

    За один вызов программы PFM.EXE распаковывается одно
сообщение. Программа PFM.EXE для распаковки вызывается с
параметрами /U, /W и /K

          PFM   /Uимя /Wимя /Kпароль

    При распаковке сообщения параметры /U и /W обязательные.
    /Uимя задает исходный файл в формате ProCarry Mail для
распаковки.
    /Wимя указывает директорию, где будут размещены все
файлы, образовавшиеся в результате распаковки. Файл с
заголовком и письмом будут иметь тоже имя, что и исходное
упакованное сообщение, все остальные файлы будут иметь те же
имена, которые они имели еще до упаковки в сообщение и
отправки почтой.
    Перед началом распаковки все файлы из заданной ключом /W
директории автоматически будут удалены. Поэтому для
распаковки необходимо назначать специально отведенную для
этого рабочую директорию.
    /Kпароль - необязательный параметр, задает ключ для
расшифровки сообщений (без использования системы МАГ). Если
сообщение зашифровано с помощью МАГа, то /K игнорируется.

    При распаковке нет необходимости задавать использование
системы МАГ. Программа автоматически распознает, что
сообщение было подписано или зашифровано МАГом, по наличию
специальных полей Signature: и MagPro: в заголовке сообщения.
    Если после проверки подписей в сообщении ошибок не будет
найдено, то результаты проверки будут записаны в заголовок
распакованного сообщения и в файл ########.SIG. Файл
########.SIG будет находиться в той же директории, где
программа PFM.EXE и все остальные программы, а структура его
описывается в руководстве по системе МАГ.
    Поскольку при распаковке сообщения проверка электронной
подписи производится автоматически, то после завершения
работы программы проверить, было ли подписано упакованное
сообщение, можно по наличию файла ########.SIG. Если файла
########.SIG не окажется, значит сообщение не было подписано.


Коды завершения

     0 - нормальная распаковка сообщения;
     3 - не совпадает контрольная сумма в исходном сообщении;
     4 - ключом /K не указан пароль, но исходное сообщение
         зашифровано;
     5 - не найдена программа-распаковщик PROCRCMP.EXE;
     9 - неверная строка параметров при вызове PFM.EXE;
    10 - ошибка записи результирующих распакованных файлов в
         директории, заданной ключом /W;
    11 - не найден или не читается распаковываемый файл
         сообщения;
    12 - ключом /W не задана результирующая директория для
         файлов распакованного сообщения;
    14 - нарушена структура сообщения или введен неправильный
         пароль;
    15 - не найдена программа цифровой подписи SIGN.EXE;
    17 - ошибки при проверке подписи.
    18 - программа расшифровывания не найдена;
    20 - ошибка чтения файла результатов проверки подписей;
    21 и выше - ошибки, замеченные программой расшифровывания;
         код ошибки равен 20 плюс код, выданный DECRYPT.EXE
         или ENCRYPT.EXE.

    Коды завершения 3 и 4 выдаются в том случае, если файл
сообщения распакован, но при этом нарушена контрольная сумма
или замечены не критические нарушения в структуре сообщения.
Все коды больше 4 выдаются при аварийном завершении
распаковки, в этом случае, хотя в рабочей директории /W и
могут образоваться временные промежуточные файлы,
пользоваться ими нельзя.


Примеры

Echo off
pfm /U%1 /Wc:\unpacked /k%2 /ca
If  ErrorLevel = 5  goto :quit
If  ErrorLevel = 1  goto :m1
Echo Сообщение распаковано нормально
If  Exist ########.SIG  Echo Сообщение подписано
goto :quit
:m1
Echo Сообщение распаковано, но замечены нарушения в структуре
:quit


Echo off
PFM.EXE /Uc:\in\CR020492.M02 /pd:\procarry\inunpack


Подавление вывода на экран

    Если в командную строку при вызове PFM.EXE вставить ключ
/Z, то вывод сообщений на экран подавляется.


Утилита PTM.EXE проверки сообщений почты

    С помощью PTM.EXE можно быстро проверить структуру
сообщения почты ProCarry, не распаковывая его. Имя
проверяемого файла задается в качестве параметра при вызове
программы

                PTM.EXE  ИмяФайла

    Результаты проверки сообщаются на экране и с помощью
кодов выхода:
     0 - сообщение имеет нормальную структуру;
     1 - сообщение имеет правильную структуру, но испорчена
контрольная сумма сообщения;
     2 - файл не имеет структуру сообщений почты ProCarry;
     3 - ошибка чтения файла или нарушена структура
сообщения.

ЧАСТЬ 10: УЗЕЛ ЭЛЕКТРОННОЙ ПОЧТЫ


Сортировщик почты SORTU.EXE

    Узел электронной почты ProCarry Mail работает под
операционной системой MS-DOS. Узел принимает сообщения,
сортирует их, передает получателям и другим промежуточным
узлам почты.
    Размер сообщений, количество адресатов в них ни чем не
ограничены.
    Узел ProCarry Mail обрабатывает не только обычные
сообщения электронной почты, но может передать их или принять
из телеграфной сети, с факса, из других электронных почт,
основанных не на базе ProCarry. Аппаратура для работы с
факсом и телеграфом - ProCarry Fax и ProCarry Telegraph.
    Сообщения электронной почты ProCarry Mail могут
передаваться в зашифрованном виде и с электронной подписью по
системе МАГ. Узел почты имеет средства для проверки подписей
и расшифровывания сообщений.
    Узлы почты могут формировать и передавать различные
квитанции отправителям о доставке их сообщений.
    Прием и передача сообщений на узле производятся с помощью
ProCarry в фоновом режиме. Сортировку почты выполняет
программа SORTU.EXE - ядро сортировщика почты.

    Сортировщик почты SORTU.EXE поставляется всем
пользователям ProCarry. Однако, без специальной аппаратной
защитной заглушки программа корреспонденцию не сортирует. Без
заглушки попробовать сортировку почты можно для двух
абонентов, имеющих специальные имена: USER1 и USER2.


Вызов SORTU.EXE

    Для вызова сортировщика почты необходимо предварительно
подготовить необходимые ему файлы и справочники, записать их
на определенные диски и директории. Система ProCarry,
обслуживающая модемы и коммуникационные линии в фоновом
режиме, должна быть запущена до старта SORTU.EXE.

Параметры командной строки

    Вызов SORTU.EXE имеет вид

   SORTU   t1,t2,key,t3  /S /Kx /Z /Y /T /I /U /C /B /Afile

    Первые 4 параметра позиционные, они отделяются друг от
друга запятыми. Можно не вводить параметр, если используется
его значение по умолчанию, но запятая, закрывающая этот
параметр, должна присутствовать обязательно. Переключатели
задаются после позиционных параметров.

    t1 - интервал времени в минутах между просмотрами
программой SORTU.EXE всех директорий - приемных почтовых
ящиков абонентов. По умолчанию t1=10 минут. Следует иметь в
виду, что SORTU.EXE "подхватывает" принятые от абонентов
файлы сразу же по завершении их приема и систематический
просмотр директорий необходим лишь "на всякий случай". Если
задано значение больше 60 минут, проверка директорий будет
только при запуске SORTU.EXE, а в процессе работы проверки не
будет.
    Кроме проверки входных "почтовых ящиков", через интервал
времени t1 проверяется файл RECEIPTS.TST, чтобы определить,
какие сообщения уже отправлены с узла для формирования
обратных квитанций.

    t2 - длительность работы SORTU.EXE в минутах. По
истечении интервала t2 SORTU.EXE завершает работу с кодом
выхода 0. По умолчанию t2=120 минут. Если задано t2 больше
1440, то SORTU.EXE сама не прекращает работу вообще.
    Параметр t2 необходим на случай, если программа SORTU.EXE
работает на узле почты не одна и периодически для каких-то
целей необходимо запускать еще и другие программы.

    key - код клавиши, при нажатии которой работа SORTU.EXE
немедленно прекращается, код выхода при этом равен 2. По
умолчанию key равно 68 - клавиша F10.

    t3 - длительность интервала в минутах, после которого
SORTU.EXE начинает вызов абонентов, поле Group в записи базы
SCRIBERS.DAT у которых не равно 0.
    Программа SORTU.EXE периодически сама вызывает через
каналы связи своих абонентов и другие узлы почты. Параметр t3
задает интервал времени, после которого начинаются процедуры
вызова.
    Если t3 не задано, вызова абонентов самим узлом нет.
    Вызов абонентов происходит по двум различным протоколам.
Один из них - фоновый. В этом случае SORTU.EXE не завершает
работу. Во втором случае протокол связи не фоновый, поэтому
требуется выход из SORTU.EXE. Возврат после этого должен быть
с переключателем /S в командной строке.
    Для вызова каждого абонента через не фоновый протокол
SORTU.EXE формирует служебные файлы (их всего 3) в той же
директории, откуда вызвана сама SORTU.EXE. В этом случае она
завершает работу с кодом 1. После вызова последнего абонента
SORTU.EXE завершает работу с кодом 0 - так же, как по
истечении интервала, заданного t2.

    Ключ /B указывает начать вызов абонентов узлом сразу же
после старта программы, не дожидаясь, пока истечет интервал
времени, заданный t3. Если /B отсутствует, то SORTU.EXE
начнет вызывать абонентов, когда истечет интервал времени t3.
Если ключ t3 не задан, а /B задан, то сразу после старта
программы будет инициирован вызов абонентов, но впоследствии
вызовов больше не будет.

    Параметр /S указывает начать вызов абонентов узлом сразу
же после старта программы, не дожидаясь, пока истечет
интервал времени, заданный t3. В отличие от ключа /B, по
параметру /S после окончания обзвона всех абонентов
автоматически происходит выход из программы с кодом выхода 0.
/S необходим для продолжения обзвона абонентов с помощью не
фонового протокола. Сразу же после старта программы
продолжится обзвон абонентов, начиная со следующего после
только что вызывавшегося. Для вызова следующего абонента по
не фоновому протоколу SORTU.EXE завершает свою работу с кодом
выхода 1, а после завершения обзвона всех абонентов,
независимо от того, по какому протоколу происходил вызов - по
фоновому или нет, SORTU.EXE завершает работу с кодом выхода 0.

    /Afile задает имя файла, по которому происходит запуск
процедур обзвона абонентов самим узлом. Программа SORTU.EXE
непрерывно проверяет, существует ли файл, заданный в ключе
/A. Если этот файл существует, то запускается обзвон
абонентов самим узлом, а файл инициации запуска из параметра
/Afile самой программой SORTU.EXE автоматически удаляется.
    Файл, имя которого задано вместе с параметром /Afile,
может иметь любую, даже нулевую длину. Содержимое его не
анализируется, для SORTU.EXE важно лишь само существование
этого файла. Файл инициации запуска не должен иметь атрибутов
файла, мешающих его удалению, в противном случае вызов
абонентов будет происходить непрерывно.
    Параметр /Afile очень удобен для запуска обзвона
абонентов через локальную сеть. Пользователь локальной сети,
после того, как он сформировал сообщение электронной почты,
если ему необходимо, чтобы узел срочно передал его, создает
файл с именем, указанным в /Afile при запуске SORTU.EXE. Как
только SORTU.EXE обнаружит его, немедленно начнется вызов
абонентов самим узлом.
    Ключи t3 и /Afile действуют совершенно независимо друг от
друга. t3 может быть и не задан, тогда запуск вызова
абонентов будет происходить только по файлу инициации /Afile.
Если же заданы оба ключа, то интервал времени t3 до
следующего запуска выдерживается независимо от того, каким
способом в последний раз был инициирован обзвон - по файлу
инициации, или после истечения интервала времени t3.

    Переключатель /Kx задает дисковод, в котором находится
ключевая дискетта системы МАГ. x должен быть буквой в
диапазоне от A до Z. Ключевые файлы системы МАГ могут
находиться не только на флоппи-дисках, их можно переписывать
для работы на Hard-диск или на виртуальный RAM-диск.

    /Z означает не формировать автоматически квитанции о
доставке сообщений конечным получателям. Без переключателя /Z
обратные квитанции формируются независимо от того, были они
запрошены полем Ret: в заголовке сообщений, или нет.

    /Y используется только, если работает 2-й сортировщик
через локальную сеть. Ключ /Y задается только для одного из
двух работающих сортировщиков. По /Y для хранения информации
о квитанциях используется не файл RECEIPTS.TXT, а
BECEIPTS.TXT. Если оба сортировщика загружены без /Y или оба
с ключом /Y, то они оба используют один и тот же файл и из-за
этого может теряться информация о квитанциях.

    Если задан /T, то в выходные директории OUT помещаются
файлы с теми же именами, которые они имеют в архиве ARCHIVE.
Без ключа /T имена файлов сохраняются теми же, что они имели
во входной директории IN, несмотря на то, что в архиве они и
были переименованы.

    При записи сообщений, помещаемых на электронную доску,
сообщения распаковываются и записываются вместе с
заголовками. Если при старте SORTU.EXE введен ключ /I, то
заголовки не будут присоединяться к сообщениям во время
записи на доску объявлений.

    Если задано /U, то программа SORTU.EXE завершает каждый
раз свою работу, как только будет получено и обработано любое
новое сообщение или по истечении интервала t1. Код выхода из
программы SORTU.EXE при этом всегда равен 6. После выхода из
SORTU.EXE с таким кодом пользователь может выполнить
необходимые ему действия, а в конце должен опять вызвать
SORTU.EXE с теми же параметрами, с которыми он запускал
SORTU.EXE первый раз. Параметры, необходимые для работы
SORTU.EXE, сохраняются во временном файле на диске,
создаваемом самой SORTU.EXE.
    Например,

:Repeat
D:\procarry\host\sortu %2,%3,%4,%5 /U/AT:\PROSTART\TMPFILE.1
If  not Errorlevel = 6  Goto :ML1
Rem Манипуляции с файлами и различные процедуры пользователя
Goto :Repeat
:ML1
If  Errorlevel = 2  Goto :Quit
If  not ErrorLevel = 1  Goto :Repeat
Rem Вызов абонентов
Goto :Repeat

    Вызов SORTU.EXE с ключом /U может понадобиться, к
примеру, в том случае, если пользователя полностью не
удовлетворяют возможности SORTU.EXE по сортировке файлов и он
имеет для этого свои дополнительные процедуры. Или, если
почта состоит из сообщений не только в формате ProCarry Mail
и требуются дополнительные программы для ее обработки.

    Ключ /C почти аналогичен /U. Однако, по ключу /C выход из
SORTU.EXE с кодом завершения 6 осуществляется только после
истечения интервала времени t1. После того, как сортировщик
просканирует все почтовые директории и обработает все
принятые сообщения, программа завершает работу с кодом выхода
6.


Примеры вызова SORTU.EXE

       sortu 15,,,60  /KB

    Такая командная строка задает просматривать входные
почтовые ящики через 15 минут, через каждые 60 минут
запускаются процедуры вызова абонентов узла. Выход после
нажатия F10. Ключевая дискетта системы МАГ находится в
дисководе B:.


Коды выхода из программы

   0 - выход после завершения обзвона всех абонентов, если
SORTU.EXE была вызвана с ключом /S.
   1 - выход для вызова следующего абонента самим узлом по не
фоновому протоколу, если SORTU.EXE была вызвана с ключом /S.
   2 - работа программы SORTU.EXE прервана с клавиатуры.
   3 - выход по истечении интервала времени, заданного в t2.
   6 - выход по параметру /U или /C для выполнения
дополнительных нестандартных процедур обработки файлов.


Расположение справочников и файлов

    Файлы и программы, которые необходимы сортировщику
SORTU.EXE, делятся на 2 группы. Одна группа должна
располагаться на том же диске и в той же директории, откуда
запускается и сама SORTU.EXE. Другая группа, в нее входит 2
справочника, считывается с текущих диска и директории.

    Справочники SCRIBERS.DAT и DIRECT.TXT считываются
программой SORTU.EXE из текущей директории DOS. Рекомендуется
перед вызовом SORTU.EXE поместить SCRIBERS.DAT и DIRECT.TXT
на виртуальный RAM-диск, сделать этот RAM-диск текущим и
только после этого вызывать SORTU.EXE.

    Обязательно в одной директории с SORTU.EXE должны
находиться файлы SORTU.OVR и SORTU.PRM. Без этих двух файлов
сортировщик вообще не может работать. Кроме того, необходимы
программы PROCRCMP.EXE, RKC.EXE и т.д., которые используются
при определенных условиях.
    По возможности, на виртуальный RAM-диск следует поместить
и саму программу SORTU.EXE вместе со всеми необходимыми ей
дополнительными файлами. Полный список файлов, необходимых
для работы сортировщика почты и находящихся в одной
директории с SORTU.EXE:

  SORTU.EXE     - сортировщик файлов;
  SORTU.OVR     - оверлеи программы SORTU.EXE;
  SORTU.PRM     - файл параметров;
  PROCRCMP.EXE  - упаковщик файлов;

  RKC.EXE       - программа обработки подписанных сообщений;
  RKC.PRM       - параметры программы RKC.EXE;
  RKC.TXT       - справочник эталонов идентификаторов
подписей;
  SIGN.EXE      - программа проверки электронной подписи МАГ;
  SIGN.CFG      - файл параметров программы SIGN.EXE;
  ENCRYPT.EXE   - программа шифрования по системе МАГ;
  DECRYPT.EXE   - программа расшифровывания по системе МАГ;
  MAG.CFG       - файл параметров программ ENCRYPT.EXE и
DECRYPT.EXE;
  PFM.EXE       - компоновщик сообщений почты ProCarry Mail;
  PROCOPY.EXE   - программа копирования файлов;

    Кроме того, в файлах SIGN.CFG и MAG.CFG указываются имена
директорий, в которых располагаются файлы с ключами
шифрования. Ключевые директории рекомендуется располагать на
виртуальном диске.

    Все программы и файлы, начиная с RKC.EXE, нужны только на
специальных узлах почты, которые автоматически проверяют
подписи, расшифровывают и распаковывают сообщения, содержащие
пакеты документов. Как правило, это узлы в клиринговых
банковских центрах.
    Обычные узлы электронной почты ProCarry таких программ не
имеют, для них вместе с SORTU.* необходим только упаковщик
файлов PROCRCMP.EXE.


Файл параметров SORTU.PRM

    Файл SORTU.PRM при вызове сортировщика требуется
обязательно, он должен находиться в той же директории, откуда
запускается и сама программа SORTU.EXE (в отличие от
SCRIBERS.DAT и DIRECT.TXT, которые считываются с текущих
диска и директории). В этом файле задаются параметры для
информационной доски объявлений и для программы, вызывающей
абонентов узла. SORTU.PRM - текстовый файл, каждая строка в
нем содержит определенный параметр.

    Строка 1. Полное имя директории - доски объявлений.
Указанная здесь директория будет использоваться как раздел
по умолчанию во время размещения на доске объявлений тех
сообщений, в которых не указан раздел или указан ошибочно.
Эта директория должна быть вложена в главную директорию
COMMON. В конце через знак дроби "/" может быть указано число
дней хранения объявлений по умолчанию (если это число не
задано, оно равно 7 дням).

    Строка 2. Имя расширенного списка файлов в разделе
COMMON, например, LIST.DIR. Список файлов содержит имя файла,
комментарии, размер и дату создания файла.

    Строка 3. Имя директории, содержащей карточки для вызова
абонентов (их расширение PCR) или списки карточек с
расширением PCI. Эта директория не должна совпадать с
директорией карточек для входящих соединений (т.е. когда
абоненты вызывают узел).
    Для каждого вызываемого абонента в директории должна быть
абонентская карточка с именем, совпадающим с именем абонента
и расширением PCR. Эта карточка содержит номер телефона и все
необходимые параметры для вызова.
    Если для вызова абонента необходимо несколько карточек (у
абонента несколько телефонов в Хост-режиме), то в директории
должен быть файл с именем, совпадающим с именем абонента и
расширением PCI. В этом файле в текстовом виде содержатся
имена всех карточек для вызова абонента. Имена могут быть
любыми, расширения и точки внутри файла PCI не пишутся (они
всегда .PCR) - только имена карточек. Каждое имя - в
отдельной строке. Карточки, на которые записаны ссылки в
файле PCI, должны находиться в этой же директории.

    Строка 4. Имя узла как абонента в других узлах (до 8
знаков). С этим именем узел вызывает абонентов.

    Строка 5 и далее содержат описание групп каналов связи. В
справочнике SCRIBERS.DAT в записи каждого абонента имеется
поле Group, в котором задается группа для вызова этого
абонента. Группы должны быть числами от 1 до 9 (0-я группа
означает, что узел сам не вызывает абонента). Во время работы
программ вызова абонентов самим узлом группе, указанной в
поле Group ставятся в соответствие конкретные каналы связи,
указанные в SORTU.PRM. Записи групп имеют вид

                       Gx,y..y,nn

Здесь x - номер группы (цифра от 1 до 9), y..y - каналы связи
соответствующие группе (одна или несколько цифр от 0 до 9),
nn - команда настройки канала связи в ожидание после
завершения передачи (число от 1 до 39, чаще всего это команда
4 - ожидание вызова, или 26 - выделенный канал с модемом
Hayes). Например,
                    G1,0,4
                    G2,13,4
                    G3,2,26

    Если какой-то группе поставлено в соответствие несколько
каналов связи, то это означает, что это равноценные
коммутируемые каналы связи с одинаковыми модемами и в
принципе все равно, по какому из них будет осуществлена
связь. Программа для вызова абонента выбирает свободный канал
(или дожидается освобождения любого из них). После завершения
вызова всех абонентов группы использовавшийся канал связи
опять устанавливается в ожидание командой, заданной в строке.
    Две строки с одинаковыми номерами групп не допускаются,
вторая в этом случае игнорируется. Вызов абонентов по группам
происходит в обратном порядке следования строк с группами в
справочнике SORTU.PRM.


Пример SORTU.PRM

D:\PROCARRY\HOST\COMMON\ADVERT/10
LIST.DIR
D:\PROCARRY\HOST\OUT_CARDS
STANDRD
G1,0,4
G2,13,4
G3,2,26


Командный файл MAILSORT.BAT

    Файл MAILSORT.BAT создается программой INSTALL.EXE во
время настройки узла электронной почты. Этот файл
автоматизирует вызов сортировщика почты. При вызове
MAILSORT.BAT задается 5 параметров:

             MAILSORT %1 %2 %3 %4 %5 %6

Эти параметры означают следующее: %1 - виртуальный RAM-диск,
на который переписываются справочники сортировщика, чтобы
ускорить с ними работу, %2 %3 %4 %5 - параметры, задаваемые в
командной строке при вызове SORTU.EXE. Параметры можно
разделять запятыми или пробелами, при этом следует помнить,
что пропускать параметры для задания значений по умолчанию
нельзя по правилам DOS. Например,

                mailsort e: 15,120,68,30

    Параметры %6 - дополнительные ключи, передаваемые
программе SORTU.EXE при ее запуске. Это могут быть любые
ключи, допустимые в командной строке при старте SORTU.EXE.

    Если сортировщик почты должен загружаться с виртуального
RAM-диска, то для этого в файл нужно внести некоторые
исправления. Надо, например, вставить команды COPY для
перезаписи всех необходимых файлов и программ на RAM-диск:

COPY C:\PROCARRY\HOST\SORTU.*      %1\PROCARRY\HOST
COPY C:\PROCARRY\HOST\SIGN.EXE     %1\PROCARRY\HOST
COPY C:\PROCARRY\HOST\ENCRYPT.EXE  %1\PROCARRY\HOST
COPY C:\PROCARRY\HOST\DECRYPT.EXE  %1\PROCARRY\HOST
COPY C:\PROCARRY\HOST\*.CFG        %1\PROCARRY\HOST
COPY C:\PROCARRY\HOST\PROCRCMP.EXE %1\PROCARRY\HOST
COPY C:\PROCARRY\HOST\PROCOPY.EXE  %1\PROCARRY\HOST
COPY C:\PROCARRY\HOST\PFM.EXE      %1\PROCARRY\HOST
COPY C:\PROCARRY\HOST\RKC.*        %1\PROCARRY\HOST

    Кроме того, необходимы команды для перезаписи файлов с
ключевой дискетты в ключевые директории, указанные в файлах
параметров SIGN.CFG и MAG.CFG.


Вызов сортировщика почты на многомашинном комплексе узла
почты через локальную сеть

    Если одновременно на одном узле запускается больше одного
сортировщика почты SORTU.EXE (такое возможно на нескольких
компьютерах, соединенных в локальную сеть), то есть несколько
ограничений.
    Каждый сортировщик должен использовать отдельную рабочую
директорию PROCARRY\HOST\CARD_OUT\$$$$WORK. Эта директория
создается внутри директории \PROCARRY\HOST\CARD_OUT, которая,
в свою очередь, указывается в 3-й строке файла SORTU.PRM. Из
этого следует, что и файлы SORTU.PRM должны быть разными.
Поскольку файл SORTU.PRM должен находиться в той же
директории, где и сама программа SORTU.EXE, это означает, что
программа сортировки почты в каждом компьютере должна
стартовать из отдельной директории, принадлежащей именно этому
компьютеру. Наилучший выход из такой ситуации - перед запуском
SORTU.EXE и ее подпрограммы надо переписывать на виртуальный
RAM-диск.
    Все остальные файлы и директории могут (и даже должны)
совместно использоваться сортировщиками почты на разных
компьютерах локальной сети, т.е. они должны совпадать.

    Если используется 2 сортировщика, то один из них должен
быть обязательно вызван с ключом /Y, а другой - без этого
ключа. Тогда будет исключена потеря информации об обратных
квитанциях на отправленные сообщения.


Алгоритм работы сортировщика почты

    Все сообщения, пришедшие на узел электронной почты
ProCarry Mail, должны иметь определенный формат. Каждое
сообщение имеет текстовый заголовок и "подклеенное" к нему
тело сообщения. Тело сообщения подготавливается специальной
программой - упаковщиком и может быть зашифровано и подписано
по системе МАГ.
    Заголовок каждого сообщения должен содержать один или
несколько адресов, куда должно попасть это сообщение.
Адресатами могут быть не только пользователи почты ProCarry
Mail, но и абоненты телеграфных сетей, пользователи факсов
или других электронных почт.
    Все сообщения, в которых нарушена структура или
неправильная контрольная сумма, сортировщиком почты не
обрабатываются и остаются во входных почтовых ящиках. Оттуда
их надо извлекать другими средствами уже без программы
SORTU.EXE.

    Программа SORTU.EXE постоянно проверяет все фоновые
каналы связи и, если приходит новое сообщение на узел,
начинает немедленно обрабатывать его. Кроме того, программа
периодически просматривает все входные почтовые ящики IN и
пытается там отыскать новые сообщения.
    Периодически сортировщик почты инициирует исходящую связь
с другими узлами почты или с некоторыми абонентами своего
узла. Это, конечно, не отменяет возможностей этих абонентов
самим в любое время подключаться к узлу и работать со своей
почтой.
    Сортировщик почты для работы использует справочник
SCRIBERS.DAT, в котором для каждого абонента должна быть
отдельная запись. Запись в базе SCRIBERS.DAT описывает все,
что нужно знать об абоненте: его входные и выходные почтовые
ящики, способ записи в них, надо ли вызывать самого абонента,
если надо, то как и когда, и т.п.


Регистрация новых абонентов на узле

    Для создания новых абонентов или корректировки сведений
об уже существующих используется программа SCRIBERS.EXE. С ее
помощью создаются все необходимые для каждого из абонентов
файлы и записи: запись в базе сортировщика почты
SCRIBERS.DAT, директории - почтовые ящики этого абонента и
соответствующая карточка пользователя в разделе CARDS.
    Для обычных абонентов кроме программы SCRIBERS.EXE больше
ничего не потребуется. Дополнения нужны лишь в тех случаях,
когда узел сам осуществляет вызов абонентов.


Классы абонентов узла почты

    Сообщения в выходные директории OUT сортировщик может
помещать в различном виде. Варианты записи в выходные
почтовые ящики настраиваются для каждого пользователя в
отдельности в справочнике SCRIBERS.DAT в графе Class.
Возможные значения графы Class могут быть 0, 1 или 2.
    Class=0 указывает помещать в директорию не само
сообщение, а только специальный файл-ссылку, в котором
записано указание, где находится настоящий файл сообщения (в
директории ARCHIVE). Это позволяет экономить дисковую память
в сервере.
    Class=1 означает, что в директорию OUT помещается не
ссылка, а сам файл.
    Class=2 может использоваться только в записях типа )TEL,
)), ))имя, )FAX, )PAPER. Это означает, что дальше сообщение
будет передаваться не почтой ProCarry, а телеграфом, факсом,
другой электронной почтой или распечатываться и пересылаться
письмом курьером или обычной почтой. Сообщение
распаковывается и подготавливается соответствующим образом. В
этом случае сообщение не может быть упаковано с паролем и
упаковщик должен быть только поставляемый совместно с
ProCarry.


Запись объявлений в раздел COMMON

    Сортировщик почты помещает объявления, присланные узлу, в
один из разделов COMMON. Абонент сам выбирает и указывает, в
какой именно из разделов он хочет поместить объявление. Если
он не указал раздел или указал его неправильно, сообщение
помещается в директорию по умолчанию - она указана в 1-й
строке файла SORTU.PRM. Время хранения объявлений в сутках
задается также в 1-й строке SORTU.PRM (после имени директории
ставится "/" и затем число). Если число не задано, оно
принимается равным 7 суткам. Кроме того, абонент сам может
указать срок хранения объявления.
    Сообщения помещаются в раздел COMMON в распакованном
текстовом виде.
    Для того, чтобы поместить объявление, абонент в поле To:
заголовка своего сообщения должен указать точный почтовый
адрес узла. Кроме того, в поле Handling: задаются знаки @C\ и
вслед за ними раздел и срок хранения. Если раздел имеет
несколько уровней вложенности, они отделяются знаком "\".
Срок хранения пишется в конце и отделяется дробным знаком
"/". Например,

   Handling: @C\
   Handling: @C\ADVERT\COMPUT
   Handling: @C\rtsb\comput\modems/21

В поле Subject: сообщения абонент должен указать тему
объявления, это поле обязательное, иначе объявление
разместится в COMMON без комментариев.


Формирование обратных квитанций о доставке сообщений почты

    Сортировщик почты автоматически формирует сообщения -
квитанции для всех ошибочных сообщений и для сообщений,
успешно дошедших до адресата. Кроме того, системы рассылки
факсов и телеграмм формируют квитанции в случае удачной или
неудачной передачи сообщения.
    В квитанции о нормально дошедшем сообщении пишется поле
Receipt: и в нем OK, имя файла и в скобках адрес, куда
письмо поступило.
    В квитанции об ошибочном адресе в поле Receipt: пишется
"ERROR address", имя файла и сам ошибочный адрес.

    Автоматическое формирование обратных квитанций программой
SORTU.EXE можно отменить, если запускать эту программу с
переключателем /Z.

    Каждый пользователь, отправляя сообщение, может заказать
обратную квитанцию. Таких квитанций всего 3 вида.
    Если в заголовке сообщения есть поле Ret:, то после
доставки сообщения конечному пользователю или при ошибочном
адресе формируется обратная квитанция независимо от того,
запущена SORTU.EXE с ключом /Z или нет. Текст, набранный в
поле Ret:, помещается в обратную квитанцию.
    Поле Rets: в заголовке сообщения обрабатывается точно
так, как и поле Ret:, но по Rets: обратная квитанция
формируется сразу после того, как сообщение попало в
последний почтовый ящик, не дожидаясь, пока оно попадет к
конечному абоненту.
    По полю Retm: также формируется обратная квитанция. Это
поле задает проверить электронную подпись в сообщении,
расшифровать и распаковать его. Файлы из распакованных
сообщений при удачной проверке записываются в специальные
директории, принадлежащие абонентам-отправителям сообщений.
Поле Retm: указывает запустить программу RKC.EXE, которая и
выполняет все эти действия. В обратной квитанции указывается,
удачно или нет распаковано сообщение.

    Информация для проверки, забрал конечный получатель свое
сообщение или нет, на узле почты находится в файле
RECEIPTS.TST.


Файл RECEIPTS.TST

    Файл RECEIPTS.TST в архивной директории - служебный. В
этом файле записана информация для проверки сортировщиком
почты, какие сообщения уже отправлены конечным получателям.
Если сортировщик не находит записанного в RECEIPTS.TST файла,
считается, что он уже доставлен конечному получателю. В этом
случае формируется обратная квитанция отправителю сообщения.
    RECEIPTS.TST периодически проверяется одновременно с
проверкой всех входных почтовых ящиков. Время цикла задается
при старте программы SORTU.EXE в первом позиционном параметре
командной строки t1.


Вызов других узлов и абонентов

    Автовызов инициируется сортировщиком почты или по
истечении интервала времени, заданного в ключе t3, или после
получения через локальную сеть файла-метки, заданного в
параметре /Afile, или после нажатия на клавишу F5.

    Если узел почты сам вызывает какого-то абонента, то в
соответствующей записи базы SCRIBERS.DAT должна быть
ненулевая группа - поле Group. Кроме того, в директории
\PROCARRY\HOST\CARD_OUT для него должна быть заведена
карточка пользователя с именем самого абонента и расширением
PCR или группа карточек, описанных в файле с расширением PCI.
    В справочнике SCRIBERS.DAT для каждого вызываемого
абонента можно указать конкретные дни недели и время, когда с
ним можно связываться. Кроме того, в графе NoEmpty можно
задать, нужно ли вызывать абонента, если сам узел не имеет
ничего для передачи ему.
    Графа SFast задает, по какому протоколу вызывается
абонент: с помощью фоновой программы SFAST.EXE или не фоновой
PROCRUCS.EXE.
    Дни недели программами ProCarry всегда понимаются
следующим образом: 0 - связь в любой день недели, 1 - связь с
понедельника по пятницу, 2 - связь в любой день, кроме
воскресенья.
    Начальный час диапазона времени суток, когда с абонентом
разрешена связь, и конечный сами также включаются в этот
диапазон. Например, 09-17 означает связь, начиная с 9-00 до
17-59. Диапазон можно задавать с переходом на следующие
сутки, тогда время в графе End больше, чем в Begin. Например,
20-07 означает связь с 20-00 до 7-59.

    Кроме настройки Group: и связанных с ней параметров в
записи справочника SCRIBERS.DAT, для каждого вызываемого
абонента в директории \PROCARRY\HOST\CARD_OUT должна быть
создана карточка пользователя с расширением PCR. Имя этой
карточки должно в точности совпадать с именем самого
абонента. В карточке PCR описываются все параметры для вызова
абонента и номер телефона.
   Почтовые директории в карточках PCR не задаются. Они будут
сформированы и переданы в программу SFAST.EXE самим
сортировщиком SORTU.EXE автоматически. При этом директории
приема IN и передачи OUT берутся из соответствующей абоненту
записи базы SCRIBERS.DAT, директория для приема файлов общего
доступа COMMON получается сложением имени директории, откуда
вызвана SORTU.EXE на выполнение, и текста \COMMON\. Имя файла
журнала - директория запуска SORTU.EXE и текст
\JOURNAL\SORTOUT.TXT. Если необходимо запросить файлы общего
доступа из директории COMMON вызываемого абонента, то внутри
директории OUT этого абонента создается поддиректория $ и в
нее помещается файл LIST.REQ со списком запрашиваемых файлов
(список оформляется по правилам программы SFAST.EXE).
Например, ..\OUT\USER1\$\LIST.REQ.

    Если абонента можно вызвать по нескольким различным
номерам телефонов, то для него необходимо завести несколько
карточек PCR. В этом случае в директории CARD_OUT создается
текстовый файл с точным именем абонента и расширением PCI.
Каждая строка в файле PCI содержит имя одной карточки
пользователя, которая должна находиться в этой же директории
и иметь расширение PCR. В строках файла PCI должны находиться
только имена карточек, расширение .PCR должно быть опущено.
    Для выделенных каналов связи для модемов Hayes не
предусматривается никаких специальных операций. Вместо номера
телефона в исходящей карточке пользователя просто задается
строка ATX3D. Для модемов V.23 типа 2, 5, 6 строку с номером
телефона в карточке пользователя для выделенного канала
следует стереть. В этом случае сортировщик почты знает, что
используется выделенный канал связи и задает соответствующую
команду при вызове PROCRUCS.EXE.


Передача и прием сообщений из телеграфа

    Для того, чтобы передать сообщение на телетайп,
необходимо в заголовке сообщения указать адрес в виде

To: x.x.x Telex: xxxxxx Type: x AnswerBack: xxxxx

    Адрес x.x.x узла почты ProCarry необходим обязательно.
Это адрес того узла, который должен передать сообщение в
телеграфную сеть. Сообщение по почте доходит до указанного
узла, конвертируется в формат, необходимый для передачи, и
передается на телетайп с номером из поля Telex: и
автоответчиком из поля AnswerBack:.
    В телеграфном адресе могут также присутствовать
дополнительные поля Handling: и Country:.

    В справочнике SCRIBERS.DAT служебные имена )TELx
описывают почтовые ящики, предназначенные для связи с
телеграфной системой ProCarry Telegraph. Директория
\PROCARRY\HOST\TELETYPE содержит все эти почтовые ящики.
    Почта ProCarry Mail обслуживает несколько независимых
телеграфных систем: международный телекс, телеграф АТ-50,
железнодорожный телеграф. Для задания конкретной системы в
почтовом адресе ProCarry предусмотрено поле Type:, в котором
цифрой от 1 до 9 задается тип системы. Записи )TELx в базе
абонентов соответствуют каждому типу телеграфа.
    Каждой записи )TELx соответствует две директории:
\PROCARRY\HOST\TELETYPE\x и \PROCARRY\HOST\TELETYPE\INx. В
первую из них помещаются сообщения, предназначенные для
передачи в телеграфную систему, во вторую директорию принятые
из телеграфа сообщения уже в формате почты помещает ProCarry
Telegraph.
    Если в телеграфном адресе пропущено поле Type:, то в
качестве почтовых ящиков используются директории
\PROCARRY\HOST\TELETYPE и \PROCARRY\HOST\TELETYPE\IN. Это
директории по умолчанию. На каждом узле по-своему можно
устанавливать соответствие этих почтовых ящиков и конкретной
телеграфной системы.


Передача и прием сообщений с факса

    Для того, чтобы передать сообщение на факс, необходимо в
заголовке сообщения указать адрес в виде

To: x.x.x Fax: xxxxxx

    Адрес x.x.x узла почты ProCarry необходим обязательно.
Это адрес того узла, который должен передать сообщение на
факс. Сообщение по почте доходит до указанного узла,
конвертируется в формат, необходимый для передачи, и
передается на факс с номером из поля Fax:.
    В факсовом адресе могут также присутствовать
дополнительные поля Handling: и Country:.

    В справочнике SCRIBERS.DAT служебное имя )FAX описывает
почтовые ящики, предназначенные для связи с системой ProCarry
Fax Delivery. Записи )FAX соответствует две директории:
\PROCARRY\HOST\FAX и \PROCARRY\HOST\FAX\IN. В первую из них
помещаются сообщения, предназначенные для передачи в факсовую
систему, во вторую директорию - принятые с факса сообщения
уже в формате почты помещает ProCarry Fax Delivery.


Передача и прием сообщений из внешних электронных почт

    Для того, чтобы передать сообщение во внешнюю электронную
почту, необходимо в заголовке сообщения указать адрес в виде

To: x.x.x EMS: xxxxxx MBX: xxxxxx

    Адрес x.x.x узла почты ProCarry необходим обязательно.
Это адрес того узла, который должен конвертировать и передать
сообщение во внешнюю почту. Сообщение по почте ProCarry
доходит до указанного узла, конвертируется в формат уже почты
EMS:xxxx, и передается туда с адресом, взятым из полей MBX:.
    В одном адресе To: может быть несколько полей MBX:.

    В справочнике SCRIBERS.DAT каждой внешней электронной
почте соответствует карточка ))xxxxxx. В имени вслед за
знаками )) следует до 6 знаков - имя внешней почты, которое
указывается в поле EMS: адреса. Каждой записи ))xxxxxx
соответствуют 2 директории - \PROCARRY\HOST\EMS\xxxxxx и
\PROCARRY\HOST\EMS\xxxxxx\IN. В первую из них сортировщик
почты SORTU.EXE помещает сообщения, предназначенные для
передачи во внешнюю почту. Специальная программа должна
конвертировать сообщения из формата ProCarry Mail в формат
внешней почты и затем передать их туда. Во вторую директорию
должны помещаться сообщения, полученные из внешней
электронной почты и уже конвертированные в формат ProCarry
Mail.


Собственные почтовые ящики узла почты

    Запись )OWN в справочнике описывает директории - почтовые
ящики, принадлежащие самому узлу электронной почты. Эти 2
директории - \PROCARRY\HOST\OWN и \PROCARRY\HOST\OWN\IN. В
первую из них сортировщик почты помещает все сообщения,
предназначенные самому узлу. Если необходимо передать в почту
сообщение от имени узла, то для этого используется другая
директория.


Справочники сортировщика почты SORTU.EXE

    Программа сортировки почты SORTU.EXE работает
автоматически. Для ее работы предварительно с помощью
SCRIBERS.EXE должны быть созданы служебные директории и
справочник абонентов SCRIBERS.DAT. С помощью любого
текстового редактора создаются файлы DIRECT.TXT и LISTU.PRM,
также необходимые сортировщику почты.


Справочник SCRIBERS.DAT

    База SCRIBERS.DAT состоит из записей, каждая из которых
описывает одного абонента узла и включает несколько отдельных
полей.
    'Name' - имя абонента. Под этим именем абонент
подключается к узлу и для него заведена соответствующая
входная карточка пользователя с расширением PCR в директории
CARDS.
    Все служебные имена начинаются со знака ")", карточки с
расширением PCR для таких имен не создаются.

    'In Dir' - имя личной директории абонента, куда он
передает свою информацию для почты (входной почтовый ящик).
Поле 'In Dir' переносится также в карточку пользователя. В
служебных записях это поле имеет специальное значение.

    'Out Dir' - имя личной директории абонента, откуда он
принимает информацию из почты (выходной почтовый ящик). Поле
'Out Dir' переносится также в карточку пользователя. В
служебных записях это поле имеет специальное значение.

    'Common Dir' - имя директории общего доступа, к которой
абоненту разрешен доступ. Поле 'Common Dir' переносится также
в карточку пользователя.

    'Tyрe(Узел)' - тип абонента: узел или нет. Поле
используется при сортировке почты. Если абонент - не узел, то
в заголовки сообщений, принятых от него, записывается поле
From: с его обратным адресом.
    Отметка в этом поле проставляется мышью или клавишей
пробел.

    'Comment1' - 1-е поле комментариев. В записи с именем
)OWN в этом поле размещается полное имя узла. Поле 'Comment1'
переносится также в строку комментариев карты пользователя.

    'Comment2' - 2-е поле комментариев.

    'Comment3' - 3-е поле комментариев.

    'Parol' - шифро-пароль абонента, который заносится также
в карточку пользователя. Абонент имеет возможность сам с
линии изменить свой пароль.

    'Class' - способ формирования сообщений в директории OUT
для передачи абоненту:
    0 - нормальная запись (записывается ссылка на файл
сообщения);
    1 - в директорию OUT помещается не ссылка, а сам файл
сообщения;
    2 - сообщение подготавливается для передачи телеграфом,
факсом, во внешнюю электронную почту или для распечатки и
пересылки курьером или обычной почтой.

    'Group' - группа для вызова абонента самим узлом. Если
'Group' равна 0, то узел сам не пытается связаться с
абонентом (но разрешает абоненту вызывать себя). Группы для
вызова могут быть заданы в диапазоне от 1 до 9. В справочнике
SORTU.PRM каждой группе ставятся в соответствие конкретные
каналы связи.

    'Days' - дни недели, когда разрешен вызов абонента самим
узлом: 0 - все дни недели, 1 - все дни, кроме субботы и
воскресенья, 2 - все дни, кроме воскресенья.

    'Begin' - час начала времени суток, когда разрешен вызов
абонента самим узлом.

    'End' - час окончания диапазона времени суток, когда
разрешен вызов абонента самим узлом. Час в поле End также
входит в разрешенный диапазон.
    Значения, указанные в полях 'Begin' и 'End', сами входят
в задаваемый ими диапазон.
    Если поля 'Begin' и 'End' равны нулю, то разрешена
передача в любое время суток.
    Можно задавать диапазоны с переходом на следующие сутки,
тогда Begin больше End.

    'NoEmpty' - если в этом поле стоит отметка [X], то узел
сам будет вызывать абонента только в том случае, когда узел
имеет какие-нибудь сообщения в директории OUT для передачи
абоненту.
    Отметка в этом поле проставляется мышью или клавишей
пробел.

    'SFast' - если в этом поле стоит отметка [X], то узел
будет вызывать абонента по протоколу ускоренной связи в
фоновом режиме.
    Отметка в этом поле проставляется мышью или клавишей
пробел.

    Поля  'Days', 'Begin', 'End', 'NoEmpty', 'SFast'
используются только в том случае, если в поле 'Group' стоит
значение от 1 до 9. Если 'Group'=0, то значения в этих полях
не имеют никакого значения.


Служебные имена в справочнике SCRIBERS.DAT

    Для программы SORTU.EXE требуется ряд обязательных имен в
справочнике SCRIBERS.DAT, задающих служебные директории. Все
служебные имена обязательно начинаются со знака ")". Имена
директорий задаются в поле 'In Dir'.
    Все служебные имена обязательные, без них невозможна
работа сортировщика почты.

    )ARC - задает директорию \PROCARRY\HOST\ARCHIVE, в
которой сохраняются копии всех обработанных почтой сообщений.
    В архивной директории размещаются также все файлы
журналов и файл RECEIPTS.TST.

    )ERR - задает директорию \PROCARRY\HOST\ERR_TO, в которую
помещаются все сообщения с ошибочными адресами, задаваемыми
полями To, Re, Cc.

    )VIA - задает директорию \PROCARRY\HOST\ERR_VIA, в
которую помещаются сообщения, повторно попавшие в узел
электронной почты. Такие сообщения определяются по полю Via и
могут появиться лишь в случае ошибок переадресации между
узлами.

    )OWN - задает директорию \PROCARRY\HOST\OWN, в которую
помещаются сообщения, предназначенные для самого узла почты,
и, кроме того, имя узла связи.
    Директория \PROCARRY\HOST\OWN\IN служит входным почтовым
ящиком самого узла. Из нее все сообщения извлекаются
сортировщиком и передаются в почту.
    Имя самого узла связи задается в поле Comment1.

    )FAX - имя директории \PROCARRY\HOST\FAXES, куда будут
сбрасываться сообщения для передачи на факсы.
    Директория \PROCARRY\HOST\FAXES\IN предназначена для
передачи в почту сообщений, полученных с факса.

    )TELx - имя директории \PROCARRY\HOST\TELETYPE\x, куда
будут сбрасываться сообщения для передачи на телетайпы. Знак
"x" означает тип телеграфной сети, задаваемый в поле Type:
телеграфного адреса. Для каждого типа телеграфной сети
требуется соответствующая запись в справочнике.
    Директория \PROCARRY\HOST\TELETYPE\x\IN предназначена для
передачи в почту сообщений, полученных из телеграфной сети
типа Type:x.

    )PAPER - имя директории \PROCARRY\HOST\PAPER, куда будут
сбрасываться сообщения для распечатки и отсылки обычной
почтой.

    ))имя - имя директории \PROCARRY\HOST\EMS\имя, куда будут
сбрасываться сообщения для передачи во внешнюю электронную
почту. "Имя" вслед за двумя знаками ")" - первые 6 знаков
имени электронной почты. Для каждой внешней электронной почты
требуется соответствующая запись в справочнике.
    Директория \PROCARRY\HOST\EMS\имя\IN используется для
приема в почту ProCarry Mail сообщений, полученных из внешней
электронной почты "Имя".


Программа SCRIBERS.EXE

    SCRIBERS.EXE создает и корректирует базу абонентов
SCRIBERS.DAT, создает карточки абонентов и соответствующие
директории - почтовые ящики.
    Программа SCRIBERS.EXE имеет интуитивно понятный
интерфейс. Все команды в ней можно выполнять с помощью "мыши"
или нажимая на клавиатуре функциональные клавиши.
Функциональные клавиши описаны в строке состояний внизу
экрана, в меню и в кнопках-окошечках.
    Моментальная текстовая подсказка появляется после нажатия
клавиши F1. Один из вариантов входа в меню - по клавише F10.
Переход между функциональными клавишами-окошечками с помощью
Tab и Shift-Tab.

    Один из режимов программы - AutoInstall. По этой команде
SCRIBERS.EXE автоматически создает все служебные записи в
справочнике SCRIBERS.DAT. Кроме того, в запись )OWN
записывается полное собственное имя узла в системе
электронной почты ProCarry Mail.

    При вызове SCRIBERS.EXE используется файл параметров
SCRIBERS.PRM, в котором указаны служебные директории
программы. Этот файл состоит из 5 строк. SCRIBERS.PRM может
быть создан и откорректирован любым текстовым редактором.
Каждая строка в файле используется как значение по умолчанию
при вводе новых записей в справочник и при создании карточек
пользователей и директорий:

  - директория для приема файлов от абонентов IN;
  - директория для передачи файлов абонентам OUT;
  - директория файлов общего доступа COMMON;
  - директория для карточек пользователей CARDS;
  - начальный шифро-пароль DEMO.

    Если файла параметров нет, то он создается программой
автоматически со списком директорий по умолчанию.

    При использовании SCRIBERS.EXE создаваемый программой
INSTALL.EXE файл CONSTR.BAT не нужен и может быть удален.


Справочник DIRECT.TXT

    Кроме справочника абонентов программа SORTU.EXE считывает
текстовый файл DIRECT.TXT со списком абонентов и подузлов, с
которыми ваш узел имеет прямую связь.
    Если, например, вы имеете связь с абонентом U1.U2.U3.U4,
но по правилам сортировки почты в вашем сервере сообщения
должны отправляться на узел U4 (а оттуда они будут
переправляться в U3, затем в U2 и только оттуда в U1), то
поместив соответствующую запись в DIRECT.TXT, можно избежать
пересылки кружным в данном случае путем.
    Записи в справочнике DIRECT.TXT необходимы только в том
случае, если ваш узел имеет прямую связь с какими-нибудь
абонентами, но принятая система адресации вынуждает
отправлять сообщения для них кружным способом. Если же после
сортировки сообщения и так будут попадать в нужные почтовые
ящики абонентов, то записи для них в DIRECT.TXT не нужны.
    Ситуации, когда понадобится включать в DIRECT.TXT записи
об абонентах представляются достаточно редкими, только в тех
случаях, если у вашего узла есть прямая связь с абонентами
других узлов.
    Справочник DIRECT.TXT считывается также, как
SCRIBERS.DAT, из текущей директории текущего диска, а не из
той директории, откуда вызывается сама программа SORTU.EXE.
Это дает возможность помещать справочники в быстродействующий
RAM-диск. Если при вызове SORTU.EXE не обнаружит DIRECT.TXT в
текущей директории, считается, что прямых абонентов чужих
узлов вы не имеете.
    В текстовом файле DIRECT.TXT каждая строка соответствует
одному прямому абоненту. В строке сначала пишется полный
почтовый адрес абонента чужого узла, затем через пробел
указывается имя этого абонента на вашем узле (имя, как
обычно - до 8 знаков).
    Заметим, что фактически такой абонент имеет 2 почтовых
адреса: один его главный адрес на узле, с которым он
постоянно работает, другой - его адрес на вашем узле. Если
сообщение имеет его полный почтовый адрес, то с помощью
записи в DIRECT.TXT сортировщик почты все равно сумеет
правильно определить кратчайший путь пересылки. Если указан
второй дополнительный адрес как абонента вашего узла, то
SORTU.EXE определит его почтовый адрес обычным способом с
помощью справочника SCRIBERS.DAT.

    Пример.
U1.U2.U3.U4    DILER1
BEAR.PRONET    BEAR
FAB.GRODNO.BEL GROD


Журналы сортировщика почты

Журнал JOURNAL.SRT

    Программа SORTU.EXE все данные о перестановках файлов
почты помещает в специальный текстовый файл журнала. Этот
файл всегда имеет имя JOURNAL.SRT и находится в директории
)ARC, в которой находятся все обработанные сортировщиком
файлы-сообщения.
    Каждая запись в журнале состоит из 3 строк. Одному
сообщению может соответствовать несколько записей в журнале -
по числу адресатов в его заголовке. Первая строка начинается
со знаков ** или *. Две звездочки в первой строке означают,
что это первая запись, соответствующая одному сообщению, а
если вначале одна звездочка, то это означает, что эта запись
уже не первая для сообщения.
    Кроме того, в первой строке записи находятся время и дата
перезаписи сообщения, код записи, имя абонента, от кого
получено сообщение. Далее идут имя абонента, кому
предназначено сообщение, исходное имя файла-сообщения в
приемном почтовом ящике. Завершают первую строку длина
файла-сообщения в байтах, длина упакованного тела сообщения
(файла без заголовка и контрольных сумм), имя файла-сообщения
в архивной директории (в той же самой, где находится и сам
журнал) и полный почтовый адрес отправителя сообщения.
    Вторая строка записи содержит строку с адресом из
заголовка сообщения, на основании которой сформирована эта
запись в журнале и сообщение помещено в почтовый ящик
абонента. Третья строка записи содержит имя директории и имя
файла-сообщения в почтовом ящике абонента (точнее, ссылки
на само сообщение в архивной директории).
    Коды записей в журнале имеют следующие значения:
    1. Сообщение нормально помещено в почтовый ящик абонента.
    2. Адрес в сообщении указан корректно и найден
соответствующий почтовый ящик, но сообщение туда не помещено,
т.к. туда оно уже записано ранее. Это может быть в том
случае, например, если абонент - узел, через который должно
пройти сообщение нескольким адресатам, или в том случае, если
адрес одного абонента в сообщении указан дважды. Запись с
кодом 2 показывает, что сортировщик почты намеренно не
записал сообщение в почтовый ящик абонента, поскольку оно уже
туда помещено. Таким образом, исключается двойная пересылка
одного и того же сообщения.
    3. Адрес в сообщении ошибочный и оно помещено в
директорию )ERR для ошибочных сообщений.
    4. Адрес в сообщении ошибочный, но в директорию )ERR оно
не помещено, т.к. перед этим оно уже туда записано.
    5. Сообщение вторично проходит через узел и оно
помещается в директорию )VIA для "зацикленных" сообщений. Это
возможно только в случае неправильной адресации между узлами.
    6. Сообщение вторично проходит через узел, но в
директорию )VIA оно не помещено, т.к. перед этим оно уже туда
записано.
    7. Сообщение не содержит ни одного адреса и помещено в
директорию ошибочных сообщений )ERR.
    8. Адрес в сообщении составлен корректно, но указанная в
справочнике SCRIBERS.DAT директория - почтовый ящик, на диске
не найдена. Это может быть только в случае ошибок в
составлении справочника. Сообщение помещается в директорию
ошибочных сообщений )ERR.
    9. Сообщение предназначено для передачи на телетайп,
факс, во внешнюю почту или для отправки обычной почтой, но
зашифровано. Сообщение относится к ошибочным.


Журнал JOURNAL.SR2

    Для удобства подсчета объемов работ одновременно с
JOURNAL.SRT выводится сокращенный журнал JOURNAL.SR2. Этот
файл журнала находится в той же директории, где и основной
журнал JOURNAL.SRT.
    JOURNAL.SR2 содержит ровно одну строку для каждого
принятого почтой сообщения (т.е. для каждого переданного
абонентом файла). Каждая его строка содержит следующие
сведения:
    - имя абонента, передавшего файл;
    - дата (год, месяц, день) и время;
    - общая длина файла;
    - длина тела сообщения без заголовка;
    - количества записей с кодами от 1 до 9 (коды записей в
основном журнале JOURNAL.SRT) - всего 9 столбцов;
    - полный почтовый адрес отправителя сообщения.
    Записи файла JOURNAL.SR2 построены таким образом, чтобы
сортировка с помощью стандартной утилиты операционной системы
SORT.EXE не требовала реорганизации структуры файла. Записи
JOURNAL.SR2 очень легко рассортировать по именам абонентов и
ссуммировать все цифровые значения. В случае необходимости,
сортировку можно провести в разрезе полных почтовых адресов
абонентов, это может быть необходимо для расчетов с
отправителями сообщений с телетайпа, факса, внешней
электронной почты или для расчетов, минуя некоторые
промежуточные узлы почты.


Журнал JOURNAL.CMN

    Третий журнал, который ведет сортировщик почты - журнал
сообщений, помещенных в раздел объявлений COMMON. Имя этого
журнала - JOURNAL.CMN. Он содержит колонки:
    - имя абонента, поместившего объявление;
    - время и дата записи в раздел COMMON;
    - полная длина сообщения в байтах;
    - длина тела сообщения без заголовка;
    - полный почтовый адрес абонента, приславшего объявление.


Сортировка журналов и подсчет итогов

    Сортировка JOURNAL.SR2 и JOURNAL.CMN и подсчет итогов
могут быть выполнены с помощью программы PROCRJRN.EXE. Если
эта программа вызвана с ключом /G, она читает файлы
JOURNAL.SR2 и JOURNAL.CMN и сортирует их.
    При вызове PROCRJRN.EXE директория и диск, содержащие
файлы JOURNAL.SR2 и JOURNAL.CMN, должны быть текущими. В
результате сортировки получаются следующие файлы:
    - JOURNAL.SR3 рассортированный по именам абонентов журнал
JOURNAL.SR2;
    - JOURNAL.SR4 итоги из JOURNAL.SR2 по именам абонентов;
    - JOURNAL.SA3 рассортированный по обратным адресам
абонентов журнал JOURNAL.SR2;
    - JOURNAL.SA4 итоги из JOURNAL.SR2 по обратным адресам
абонентов;
    - JOURNAL.CM3 рассортированный по именам абонентов журнал
JOURNAL.CMN;
    - JOURNAL.CM4 итоги из JOURNAL.CMN по именам абонентов;
    - JOURNAL.CA3 рассортированный по обратным адресам
абонентов журнал JOURNAL.CMN;
    - JOURNAL.CA4 итоги из JOURNAL.CMN по обратным адресам
абонентов.
    Всего получается 8 файлов - 4 рассортированных файла
журналов и 4 итоговых файла. Сортировка и подсчет итогов
ведется в разрезе имен абонентов и обратных адресов
абонентов. Структура рассортированных файлов в точности
соответствует структуре самих журналов. Итоговые файлы
содержат те же графы, что и журналы, кроме даты, и
дополнительно еще одну графу - количество записей в журнале.


Сортировка двоичного журнала-протокола работы абонентов с
узлом

    Если программа PROCRJRN.EXE вызвана с ключом /S, то она
сортирует двоичный журнал-протокол работы абонентов, который
ведет сама система ProCarry. В этом случае PROCRJRN.EXE
создает расшифрованную копию самого журнала, как при обычном
ее вызове, и 2 файла - SUM.TXT и SUM2.TXT. Файл SUM.TXT -
итоги работы каждого абонента по сеансам связи. Он содержит
следующие колонки:
    - имя абонента;
    - время и дата начала сеанса связи;
    - время работы в минутах;
    - длина файлов в байтах, переданных на узел в свой
почтовый ящик;
    - длина файлов в байтах, прочитанных из своего личного
почтового ящика;
    - длина файлов, прочитанных из разделов COMMON;
    - длина прочитанных файлов-списков из разделов COMMON.

    Итоговый файл SUM2.TXT содержит такие же колонки, как и
SUM.TXT, кроме времени и даты. Этот файл содержит полный итог
работы каждого абонента по всем сеансам связи.


Настройка узла программой INSTALL.EXE

    После перезаписи ProCarry на Hard-диск появляется
директория \PROCARRY. В ее поддиректории HOST находятся
файлы, обеспечивающие работу узла. Но предварительно
требуется еще настройка для работы системы в качестве узловой
станции электронной почты.
    Настройка узла всегда начинается с настройки host-режима
программой INSTALL.EXE. Некоторые рекомендации для
понимания процедуры настройки:
    - В качестве результирующего диска следует выбирать тот
же диск, куда программой INSTALL.EXE перед этим была
сброшена сама система ProCarry. Все новые файлы появятся
в директории \PROCARRY.
    - E-Mail адрес узла - полное имя узла в системе
электронной почты ProCarry. Адрес может быть составлен из
нескольких имен, отделяемых друг от друга точкой.
    - Комментарий может содержать произвольную текстовую
информацию.
    - Номера телефонов нужно задавать с кодом 8 и кодом
города. Тогда к вашему узлу легко смогут подключаться
абоненты как городской телефонной сети, так и по
междугородней связи. Номер телефона должен следовать вслед за
закрывающей скобкой, в скобках указывается код города и
дополнительный код, если он есть. После цифры 8 должны быть
запятая и буква "W". Минусы используются как комментарии, они
не мешают набору номера модемом.

            8,W-(0232)554-145
            8,W-(095)262-0001

Такая структура номера телефона при необходимости позволяет
программе INSTALL.EXE легко отсечь код междугородней связи.

    В случае необходимости настройку узла можно проводить
повторно.


Результаты настройки узла

    В результате работы программы INSTALL.EXE в директории
\PROCARRY появляются файлы для работы в Host-режиме.

    1. Файл с расширением .INS передается всем абонентам
узла. С помощью этого файла программа INSTALL.EXE
автоматически настроит абонента для работы с узлом. Ему нужно
будет сообщить только его имя и шифро-пароль, установленные
на узле с помощью SCRIBERS.EXE.

    2. AUTOWAIT.BAT  - файл для настройки компьютера на
ожидание вызовов с линии. Этот файл желательно вызывать из
AUTOEXEC.BAT, чтобы компьютер настраивался на ожидание сразу
после включения автоматически. AUTOWAIT.BAT имеет один
параметр - номер порта, который настраивается на ожидание:

              AUTOWAIT  0
              AUTOWAIT  2

    3. AUTOEXEC.BAT - рекомендуется содержимое этого файла
перенести в файл AUTOEXEC.BAT, с которого стартует
операционная система. Тогда компьютер узла будет
автоматически настраиваться на ожидание вызовов с линии сразу
после старта системы.

    4. COMPRESS.BAT, PROCRBUN.PAR - файлы для обработки
директорий общего доступа COMMON и создания итоговых списков
файлов в COMMON. Командный файл COMPRESS.BAT содержит вызов
программы PROCRBUN.EXE с файлом параметров PROCRBUN.PAR.
После выполнения COMPRESS.BAT корректируются списки файлов
LIST.DIR на основании текущего содержимого директорий COMMON.

    Программа INSTALL.EXE создает директории, необходимые для
работы информационного узла:
    \PROCARRY\HOST\CARDS    - директория для хранения
карточек абонентов узла. Сразу же после создания сюда
помещаются карточки DEMO.PCR и DEMO.BAK для абонентов в
демонстрационном режиме. Эти карточки созданы таким образом,
что с линии нельзя изменить в них шифро-пароль. Новые
карточки абонентов добавляются с помощью SCRIBERS.EXE.
    \PROCARRY\HOST\JOURNAL  - директория для хранения
журналов работы фоновых драйверов ProCarry.
    \PROCARRY\HOST\COMMON   - директория общего доступа.
    \PROCARRY\HOST\IN       - директория для приемных
"почтовых ящиков" абонентов. Директории в IN добавляются
программой SCRIBERS.EXE. Все принятые от абонентов сообщения
находятся в поддиректориях \PROCARRY\HOST\IN.
    \PROCARRY\HOST\OUT      - директория для исходящих
"почтовых ящиков" абонентов. Директории в OUT добавляются
программой SCRIBERS.EXE. Все предназначенные абонентам
сообщения находятся в поддиректориях \PROCARRY\HOST\OUT.

    Кроме того, INSTALL.EXE запускает программу SCRIBERS.EXE
в режиме AutoInstall. В результате создаются все служебные
директории, необходимые для работы сортировщика почты
SORTU.EXE.


Список программ и файлов узла электронной почты

    Файлы, необходимые для работы узла электронной почты
ProCarry, находятся в архиве PROCARRY.P2, который
распаковывается во время перезаписи ProCarry на Hard-диск.

    - SORTU.EXE - сортировка корреспонденции в соответствии
с адресами; удаление файлов из архивной директории;
распечатка каталога директорий абонентов узла (почтовых
ящиков);
    - SCRIBERS.EXE - создание и корректировка справочника
абонентов почты, карточек пользователей и директорий -
почтовых ящиков;
    - PROCRBUN.EXE - сортировка информационных файлов общего
доступа и подготовка списков файлов в директориях COMMON;
    - PROCRWT.EXE - интервальный таймер, используется вместе
с программой PROCRBUN.EXE;
    - PROCRCMP.EXE - упаковщик файлов, используемый в
ProCarry.

    Несколько файлов создаются программой INSTALL.EXE:
PROCRBUN.PAR, SORTU.PRM, SCRIBERS.PRM, SCRIBERS.DAT,
MAILSORT.BAT, COMPRESS.BAT, xxxx.INS, AUTOWAIT.BAT.

    В случае, если используется программа RKC.EXE, то в
директорию \PROCARRY\HOST необходимо переписать файлы
RKC.EXE, RKC.PRM, SIGN.EXE, ENCRYPT.EXE, DECRYPT.EXE,
PROCOPY.EXE, PFM.EXE. Все эти программы используются при
проверке узлом электронных подписей и распаковке сообщений.


Ограничение доступа абонентов к поддиректориям COMMON

    Разделы общего доступа COMMON содержат файлы, к которым
имеют доступ все абоненты узла электронной почты. Каждый
подраздел COMMON должен содержать специальный файл-список, в
котором имеется комментарий о каждом файле, содержащемся в
разделе.
    Каждый узел может содержать один или несколько разделов
COMMON. В абонентской карточке каждого абонента указывается,
к какому именно COMMON он имеет доступ.
    Как правило, каждый узел имеет только один раздел COMMON.
Это легко понять, если учесть, что сам раздел COMMON может
иметь подразделы, а каждый подраздел - свои подразделы.
Уровень вложенности ограничен только длиной строки с именем
диска, директории и файла - по правилам DOS не более 63
знаков.
    Доступом абонентов к подразделам можно управлять в
карточках пользователей. Для этого в конце имени директории
COMMON в карточке абонента пишется знак # и сразу вслед за
ним перечисляются знаки - первые буквы имен главных
подразделов, к которым доступ абоненту закрыт. Знаками
запрета могут быть цифры и буквы латинского алфавита.
Диапазон запрещенных знаков формируется с помощью минуса "-",
он разделяет знаки, с которого и по который доступ абоненту
запрещен. Например,

         d:\procarry\host\common#245be-y

означает, что абоненту запрещен доступ ко всем поддиректориям
COMMON, начинающимся со знаков 2, 4, 5, B и от E до Y
включительно. Например, к d:\procarry\host\common\beta доступ
запрещен, а к d:\procarry\host\common\advert разрешен.


Подготовка файлов-списков COMMON

    Файлы-списки в разделах COMMON формируются с помощью
программы PROCRBUN.EXE. Простейший способ создания списков -
сначала в подразделы COMMON записываются необходимые файлы,
затем вызывается COMPRESS.BAT. В получившихся файлах LIST.DIR
комментарии проставляются текстовым редактором. Комментарий
должен следовать сразу же вслед за именем файла и отделяется
от него пробелом. Комментарий отделяется от следующего за ним
цифрового поля (даты) знаком табуляции 09H. Текстовым
редактором можно стереть все до конца строки после имени
файла, дописать через пробелы комментарии, после всего этого
можно вызвать COMPRESS.BAT еще раз.
    В файлах-списках содержится информация не только о
файлах, но и о директориях. Поэтому абонент после считывания
списка имеет сведения не только о файлах, но и о подразделах
COMMON.

    Если узел работает как узел электронной почты, то
информацию в разделы COMMON может помещать каждый абонент.
Раздел COMMON может иметь подразделы с любым уровнем
вложенности. Во время записи объявления каждый абонент имеет
возможность указать, в какой именно из подразделов он хочет
поместить сообщение.
    Дата записи и количество дней для хранения объявления
записывается в списке в начале комментария об этом сообщении,
а сам комментарий берется из поля Subject письма. Удаляет
сообщения с истекшим сроком хранения программа PROCRBUN.EXE
автоматически во время реорганизации списка файлов.


Очистка архивной директории

    Программа SORTU.EXE может быть использована для
перезаписи и удаления файлов из архивной директории )ARC.
Поскольку в почтовых ящиках абонентов на самом деле находятся
не сами файлы сообщений, а только ссылки на файлы в архивной
директории, SORTU.EXE просматривает все директории - почтовые
ящики абонентов и удаляет только те файлы, на которые нет
нигде ссылок.
    В режиме удаления SORTU.EXE вызывается с переключателем
/D в командной строке и с одним параметром - именем
директории. Все файлы из архивной директории сначала
переписываются в заданную директорию и только после этого
удаляются. Если результирующая директория не задана в
качестве параметра, то перезаписи файлов нет и они просто
удаляются.
    Примеры.
               SORTU  /D C:\COPY
               SORTU  /D
               sortu.exe c:\strim/d


Получение списка файлов в почтовых ящиках узла

    SORTU.EXE может просматривать все директории абонентов
(почтовые ящики) и создавать каталог - список всех
находящихся в них файлов. Список файлов выводится в текстовый
файл на диске, имя которого вводится в качестве параметра при
вызове SORTU.EXE. Результирующий файл содержит список файлов
в исходящих директориях, а вслед за ним - во входящих. Для
вызова SORTU.EXE в режиме распечатки каталога в командной
строке задается переключатель /L.
    Результирующий текстовый файл состоит из трех колонок:
имя файла, находящегося в почтовом ящике, его размер, и, если
на самом деле это файл-ссылка, имя файла в архивной
директории, на который он ссылается. Имена файлов указываются
вместе с именем диска и директории, так что легко определить,
к какому абоненту относится файл.
    Примеры.
             sortu   /lc:\list1.txt
             SORTU   CON /L


Комплекс автоматизированной сортировки шифрованной
электронной почты

    Комплекс автоматизированной обработки шифрованных
сообщений состоит из узла электронной почты ProCarry Mail и
специальных программных средств для проверки электронных
подписей и для расшифровывания и распаковывания сообщений.
Комплекс основывается на программах SORTU.EXE, RKC.EXE и
системе МАГ. Из аппаратных средств достаточно одного
компьютера под операционной системой MS-DOS 5.0,
подключенного к локальной сети.
    Главное назначение комплекса - обработка конфиденциальной
подписанной корреспонденции в различных сетях, например, в
РКЦ банковских систем.


Узел приема и сортировки сообщений электронной почты

    Рекомендуется изменить файл MAILSORT.BAT, запускающий
сортировку почты. Вначале этого файла необходимо вставить
несколько дополнительных строк.
    Для повышения быстродействия узла почты и экономии
ресурсов Hard-диска и локальной сети, следует на виртуальном
RAM-диске перед запуском сортировщика создавать директорию
\PROCARRY\HOST, куда переписать все соответствующие файлы и
программы:

      MD %1\PROCARRY
      MD %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\SORTU.*      %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\SIGN.EXE     %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\ENCRYPT.EXE  %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\DECRYPT.EXE  %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\*.CFG        %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\PROCRCMP.EXE %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\PROCOPY.EXE  %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\PFM.EXE      %1\PROCARRY\HOST
      COPY C:\PROCARRY\HOST\RKC.*        %1\PROCARRY\HOST

    Кроме того, необходимо переписать файлы с ключевой
дискетты в ключевые директории, указанные в файлах параметров
SIGN.CFG и MAG.CFG.

    Сортировщик почты SORTU.EXE на узле следует вызывать уже
с RAM-диска с ключом /Z, чтобы подавить автоматическое
формирование квитанций отправителям сообщений. Необходим
также ключ /K%1. Поэтому в файле MAILSORT.BAT следует
заменить строку с вызовом SORTU.EXE на такую

      %1\procarry\host\sortu %2,%3,%4,%5 /Z /K%1

    Больше никаких изменений в стандартной настройке узла
электронной почты ProCarry не требуется. Все переписываемые
на RAM-диск программы и файлы в целом занимают около 300К
(кроме баз данных). Учитывая размер базы абонентов
сортировщика почты SCRIBERS.DAT и базы открытых ключей
абонентов SIGNLIST.NUM, можно определить примерные размеры
RAM-диска. Минимальный размер - 500К, максимальный - 3000К.
Поэтому, в принципе, для узла почты вполне достаточно ПК с
общим объемом ОЗУ 2М.


Организация почтовых ящиков на узле почты

    Все сообщения, прибывающие для обработки в РКЦ, всегда
должны иметь в заголовке поле Retm: и строго определенный
почтовый адрес самого РКЦ. Для этого адресата на узле почты
создается почтовый ящик и обязательно ставится значение "1" в
поле Class программы SCRIBERS.EXE, чтобы в директорию -
почтовый ящик записывались не файлы-ссылки, а сами сообщения.


Обработка сообщений на узле почты

    Все сообщения, поступающие в РКЦ, должны быть оформлены в
формате почты ProCarry Mail. Они не обязательно должны быть
зашифрованы, но подписаны должны быть обязательно. Каждый
отправитель должен передавать сообщения со строго
определенного почтового адреса и должен подписываться только
строго определенной электронной подписью.

    Технология обработки сообщений предусматривается
следующая. Сообщения, поступившие в почтовый ящик самого РКЦ,
должны иметь поле Retm: в своем заголовке. Сортировщик почты,
обнаружив Retm: в заголовке, запускает программу RKC.EXE для
обработки этого сообщения. RKC.EXE в отдельной рабочей
директории расшифровывает и распаковывает сообщение,
проверяет электронную подпись. Если подпись в сообщении
корректна, то по обратному адресу отправителя сообщения в
базе RKC.TXT отыскивается эталон его идентификатора и
сравнивается с идентификатором из подписи. Если все в
порядке, то по идентификатору подписи определяется
соответствующая ему директория-ячейка и в нее переписываются
все распакованные и расшифрованные файлы, пришедшие в
сообщении. Само сообщение в том виде, в котором оно было
взято из почтового ящика самого РКЦ, переписывается в
специальную директорию-архив, а из почтового ящика стирается.
    Если замечены хотя бы какие-нибудь ошибки или отклонения
в сообщении, то оно переписывается в другую архивную
директорию для ошибочных сообщений, из почтового ящика РКЦ
при этом оно также стирается. Никакой записи в
директории-ячейки отправителей при этом не будет.
    Сообщение признается ошибочным по различным причинам: не
расшифровывается, не распаковывается, нет электронной подписи
или она некорректна, идентификатор подписи не соответствует
эталону в базе. Технология строится таким образом, чтобы
попадание файла в директорию-ячейку определенного отправителя
гарантировало, что этот файл сформировал и передал именно
этот отправитель и никто другой, и что этот файл не искажен в
процессе передачи и обработки сообщения.
    Все операции по обработке сообщений в РКЦ фиксируются в
журнале.

    Каждому отправителю должна быть выделена отдельная
директория-ячейка. Если при перезаписи файла в ячейку в ней
встретится файл с таким же именем, то новый файл
переименовывается с таким расчетом, чтобы не затереть ни один
из находящихся в ячейке файлов-документов. Содержимое и
размер файлов-документов безразличны для программы,
обрабатывающей сообщения почты.

    К директориям-ячейкам каждого из отправителей должен быть
обеспечен доступ через локальную сеть с ПК операциониста,
работающего с этим отправителем документов. С других ПК
доступ через сеть к этим ячейкам должен быть запрещен. С ПК
операциониста также должна быть запрещена возможность записи
в ячейки новых файлов и корректировки существующих. Ему
должно быть разрешено только чтение и удаление файлов.
    В целях избежания злоупотреблений, доступ к архивным
директориям через локальную сеть также должен быть ограничен.


Запуск программы RKC.EXE

    Программа RKC.EXE запускается автоматически самим
сортировщиком почты. Но в случае необходимости ее можно
запустить и самостоятельно. RKC.EXE вызывается с двумя
параметрами

      [путь]RKC   ИсхФайл  КлючДиск

ИсхФайл - исходный проверяемый файл, КлючДиск - буква A-Z,
указывающая дисковод с ключевой дискеттой МАГа.

    Пример.

      RKC.EXE  E:\PROCARRY\HOST\OUT\RKC\BANKTEXT.123  B

    В одной директории вместе с RKC.EXE - программой
обработки сообщений в РКЦ должны находиться программы и файлы

      RKC.TXT
      RKC.PRM
      PFM.EXE
      SIGN.EXE
      SIGN.CFG
      ENCRYPT.EXE
      DECRYPT.EXE
      MAG.CFG
      PROCRCMP.EXE
      PROCOPY.EXE

    Ключевые файлы для системы МАГ располагаются в
директориях, указанных в файлах SIGN.CFG и MAG.CFG.

    Файл RKC.TXT содержит список отправителей сообщений в
РКЦ. В файле RKC.PRM указаны все необходимые параметры для
работы программы RKC.EXE.


Файл параметров RKC.PRM

    RKC.PRM - текстовый файл, состоящий из 4 строк. Каждая
строка задает один из параметров:

 1. Промежуточная рабочая директория;
 2. Директория-архив для нормально обработанных сообщений;
 3. Директория-архив для ошибочных сообщений;
 4. Имя файла-журнала.


Список отправителей сообщений RKC.TXT

    На основании файла-списка RKC.TXT производится
сопоставление обратных почтовых адресов отправителей
сообщений и идентификаторов подписей в этих сообщениях.
Сообщение считается верным только в том случае, если
идентификатор электронной подписи, взятый из файла
########.SIG, в точности соответствует тексту в
соответствующей строке файла-списка RKC.TXT. Строка в файле
RKC.TXT отыскивается по обратному адресу отправителя, взятому
из поля From: заголовка сообщения.
    Если в файле ########.SIG указано, что подпись корректна,
идентификатор подписи строго соответствует идентификатору,
найденному в базе RKC.TXT по обратному адресу отправителя, то
все файлы, пришедшие в сообщении, записываются в директорию,
указанную в той же строке базы RKC.TXT.
    Временный файл ########.SIG, из которого берется
идентификатор подписи, формирует сама программа проверки
электронных подписей SIGN.EXE, текст в поле Signature:
заголовка сообщения игнорируется. Поэтому никаким образом
невозможно подделать сообщение и переслать конфиденциальные
документы вместо кого-то, не имея его секретной ключевой
дискетты.
    База RKC.TXT должна быть текстовым файлом, в котором
каждому отправителю документов в РКЦ должна быть отведена
одна отдельная строка. Формат каждой строки должен быть
строго определенным, все поля в ней имеют всегда одну и ту же
длину:

      Код отправителя             12 зн.
      Идентификатор подписи       37 зн.
      Обратный адрес              40 зн.
      Директория для документов   64 зн.

Длина каждого поля в строке строго фиксированная, все поля в
каждой строке должны быть обязательно заполнены. Текст внутри
поля может располагаться свободно (крайние справа и слева
пробелы вырезаются), но он не должен выходить за пределы
своего поля.

    Обратный адрес - полный почтовый адрес в сетях ProCarry
отправителя документов. Идентификатор подписи должен в
точности соответствовать его идентификатору,
зарегистрированному в центре. В директорию документов будут
записываться все файлы после распаковки всех корректных
сообщений. Код отправителя нужен для ведения журнала и как
резерв для будущих приложений.

    Каждому отправителю документов должна быть отведена
отдельная директория. И вообще, ни одно поле базы RKC.TXT не
должно встречаться в двух разных строках файла. Тогда
гарантируется 100% контроль за поступающими документами.
Наличие файлов в какой-либо директории-ячейке отправителя
гарантирует, что эти файлы поступили именно от этого
отправителя и нет никаких средств обойти это правило.


Размер ОЗУ

    В качестве операционной системы следует выбрать MS-DOS
5.0. Поскольку система весьма критична по отношению к
свободному ОЗУ, следует избегать загружать лишние резидентные
программы. Необходимо убрать максимально возможное число
драйверов и программ в расширенную память ПК и тем самым
освободить основную память DOS. Среди резидентных программ
необходимы только драйвер кириллицы (желательно выбрать
драйвер, занимающий не более 1К ОЗУ), программа SHARE.COM,
драйверы ProCarry и локальной сети.
    Подсчет свободной памяти для случая, когда был загружен
1-канальный вариант ProCarry (вместе с SFAST.EXE), драйвер
кириллицы и SHARE.COM дал, что для загрузки программы
DECRYPT.EXE осталось свободно 300K ОЗУ. MS-DOS 5.0 был
перенесен в расширенную память.
    В реальной работе в остающихся 300К ОЗУ должны
разместиться драйверы организации локальной сети,
дополнительные каналы ProCarry и программа DECRYPT.EXE.
Каждый дополнительный канал ProCarry занимает 9.5К памяти,
максимальное число дополнительных каналов 9 и занимает всего
86К. Т.е., если загружен 10-канальный вариант ProCarry, то в
оставшиеся 213К памяти должны поместиться драйверы локальной
сети и программа DECRYPT.EXE.

ЧАСТЬ 11. PROCARRY TELETEXT


    ProCarry Teletext - система телекоммуникации на базе
ProCarry, позволяющая любому пользователю, имеющему модем,
связаться с другим пользователем без предварительной
настройки параметров. Абоненту для передачи информации
необходимо лишь знать номер телефона, к которому подключены
модем и система Teletext в host-режиме. Пароли и ключевые
слова для всех пользователей ProCarry Teletext заданы
одинаково и это позволяет каждому абоненту связываться со
всеми остальными пользователями.
    Система Teletext очень напоминает работу с обычным узлом
электронной почты. Отличие Teletext от узла почты в том, что
Teletext настроен всегда одинаково и на host-станцию Teletext
может выйти каждый, при этом нет нужды в предварительной
настройке абонентских карточек. ProCarry Teletext позволяет
любым абонентам связаться между собой без обмена сложными
параметрами и паролями.

    Все необходимые файлы и директории Teletext формируются
программой INSTALL.EXE при перезаписи ProCarry на "жесткий"
диск.
    Система Teletext состоит из двух командных файлов и
нескольких директорий, собранных в одну главную TELETEXT.


Файл TELEWAIT.BAT

    Командный файл TELEWAIT.BAT необходим для настройки
компьютера в режиме ожидания вызовов - в host-режиме. Команда

                  TELEWAIT.BAT

настраивает систему на ожидание вызовов по нулевому каналу.
После того, как TELEWAIT.BAT закончит работу, компьютер будет
настроен в host-режиме и будет отвечать на все телефонные
звонки.


Файл TELETEXT.BAT

    Командный файл TELETEXT.BAT предназначен для набора
номера телефона, вызова host-станции Teletext и передачи туда
файлов. Перед вызовом TELETEXT.BAT необходимо поместить в
раздел \PROCARRY\TELETEXT\OUT все файлы, которые должны быть
переданы во время сеанса связи. При вызове TELETEXT.BAT
первый обязательный параметр в командной строке - номер
телефона. В номере телефона кроме цифр можно использовать
знак W - ожидать гудок АТС. Например,

         TELETEXT.BAT  8w0951234567

Если в командной строке вслед за номером телефона через
пробел или запятую задан второй параметр, то стартует не
программа связи, а редактор почты PROCMAIL.EXE. Это дает
возможность просмотреть всю принятую в режиме Teletext
информацию и подготовить файлы для передачи в упакованном
и закриптованном формате ProCarry Mail. Прямо из редактора
также возможно запустить связь. Например,

         TELETEXT.BAT  8w0951234567  M

Если в качестве второго параметра указан знак 1, то будет
вызван не редактор почты, а программа связи PROCRUCS.EXE

         TELETEXT.BAT  8w0951234567  2


Служебные директории

    Все служебные директории Teletext располагаются в разделе
\PROCARRY\TELETEXT:
    - OUT  В эту директорию помещаются файлы, которые
необходимо передать вызываемому абоненту Teletext.
    - IN  В директории IN находятся все файлы, принятые от
абонентов Teletext во время ожидания в host-режиме; здесь же
будут располагаться файлы, принятые во время сеанса исходящей
связи.
    - SENT  В директорию SENT переписываются все переданные
из раздела OUT файлы; таким образом, файлы вторично переданы
уже не будут.
    - JOURNAL  В этой директории располагается файл журнала
JOURNAL.TXT, который содержит сведения о передаче файлов в
линию. Файл JOURNAL.BIN содержит в двоичном виде журнал
работы станции Teletext в host-режиме.
    - INUNPACK  Редактор почты PROCMAIL.EXE в эту директорию
помещает все распакованные сообщения, принятые от абонентов
Teletext в формате ProCarry Mail.
    - HOST\COMMON  Директория COMMON позволяет организовать
работу абонента ProCarry Teletext значительно похожей на
работу обычного узла электронной почты; имя списка файлов
в разделе общего доступа должно быть LIST.DIR, чтобы его
могли понять все абоненты Teletext.
    - HOST\OUT  Вообще, система Teletext не предусматривает
передачу информации от host-станции вызвавшему ее абоненту.
Ее назначение - передача файлов от вызвавшего абонента
вызываемому. Но тем не менее, возможность передачи файлов и
от host-станции имеется. Здесь можно размещать файлы,
например, после предварительной договоренности зная заранее о
предстоящем вызове с линии. Или можно записать в HOST\OUT
файлы с признаком "только чтение R/O", тогда их нельзя
удалить с линии и эти файлы будут попадать ко всем абонентам,
вызвавшим host-станцию.
    - HOST\CARDS  В разделе CARDS располагается только одна
универсальная карточка TELETEXT.PCR. Эта карта предоставляет
доступ всем абонентам Teletext для приема от них файлов в
директорию IN и для передачи абонентам файлов из HOST\OUT и
HOST\COMMON. К остальным разделам на диске абоненты Teletext
доступа не имеют. В случае необходимости в HOST\CARDS можно
помещать и другие карточки для отдельных абонентов с иными
ресурсами для доступа.

ЧАСТЬ 12. ДОПОЛНИТЕЛЬНЫЕ УТИЛИТЫ


Программа подготовки списков файлов PROCRBUN.EXE

    Программа PROCRBUN.EXE предназначена для перезаписи
файлов и для подготовки списков файлов в разделах общего
доступа COMMON. PROCRBUN.EXE готовит списки с учетом того,
что в директориях COMMON могут находиться не сами файлы, а
ссылки на них. Кроме того, PROCRBUN.EXE автоматически стирает
файлы с истекшим сроком хранения.
    При вызове программы в командной строке указывается
параметр - имя файла инструкций:

             PROCRBUN.EXE  ФайлПаpаметpов

    В каждой строке текстового файла инструкций содержится
задание на перезапись файлов или подготовку списков.
Количество строк-инструкций не ограничено. Каждая инструкция
имеет вид

       Parm1,Parm2,Parm3,Parm4,Parm5 Пеpеключатели

    Parm1 - список пеpеписываемых файлов. Указывается полный
путь (имя диска и директории) и спецификация группы
переписываемых файлов. Группу можно задавать с помощью
символов "*" и "?". Файлы с нулевой длиной, а также те файлы,
с которыми через локальную сеть сейчас работает другая
программа, не копируются.
    Parm2 - исходный файл-список с комментаpиями
пеpеписываемых файлов. Указывается имя файла. Если не заданы
имена диска и директории, а только имя файла, то считается,
что он находится в директории из Parm1, т.е. там же, где и
копируемые файлы. После копирования файлов в результирующем
списке комментарии будут сформированы на основе комментариев
из файла Parm2. Параметр Parm2 не обязательный. Если исходный
список не задан, то в результирующий список комментарии будут
поставлены из Parm5.
    Parm3 - pезультиpующая диpектоpия. Указывается полное имя
директории, в которую будут переписываться файлы и в которой
будут оформляться результирующие списки файлов.
    Parm4 - pезультиpующий файл-список с комментаpиями.
Указывается имя файла. Если не заданы имена диска и
директории, а только имя файла, то считается, что он
находится в директории Parm3, т.е. там же, где находятся и
все файлы из списка. Список Parm4 содержит только имена
файлов и комментарии, даты создания и размеры записываются в
другом списке, создаваемом по переключателю /Y. Имена списков
Parm4 и /Y могут совпадать, тогда единый список содержит все
графы - имена файлов, комментарии, размеры и даты создания, а
укороченного списка в этом случае не будет вообще.
    Parm5 - комментаpии, добавляемые к имени всех
пеpеписываемых согласно Parm1 файлов. Если есть исходный файл
со списком Parm2, то комментарии, взятые из него, суммируются
с Parm5. Параметр Parm5 не обязательный.

    С помощью пеpеключателей задаются дополнительные операции
при копировании файлов:
    /A  Удалить все пеpеписанные согласно Parm1 файлы. В
результате будет выполнена не команда COPY, а MOVE - перенос
файлов.
    /I  В результирующем списке Parm4 в комментаpиях всех
переписанных согласно Parm1 файлов будут проставлены дата и
вpемя пеpезаписи.
    /Mчисло  В результирующем списке Parm4 в комментаpиях
всех переписанных согласно Parm1 файлов будут проставлены
текущая дата и срок хранения файлов, по истечении которого
эти файлы будут автоматически удалены. Число в параметре /M
задает количество дней хранения переписанных файлов и должно
быть в диапазоне от 1 до 182.
    /T  В результирующем списке Parm4 в комментаpиях всех
переписанных согласно Parm1 файлов будет проставлена дата
пеpезаписи.
    /Yимя  На основе списка Parm4 будет создан еще один
список, в котором имеется дата создания и размер каждого из
файлов в директории Parm3. Имена списков Parm4 и /Yимя могут
совпадать.
    /G  Этот переключатель задает режим оформления списков в
директории Parm3 и во всех ее субдиректориях. Файлы не
копиpуются, поэтому параметры Parm1, Parm2, Parm5, /I, /T, /A
игнорируются. Расширенные списки создаются тоже, поэтому
переключатель /Y необходим, а если он не задан, то
предполагается, что имена Parm4 и /Yимя совпадают и готовится
только один расширенный список в каждой директории.

    По ключу /G выполняются операции подготовки всех списков
файлов, в т.ч. и расширенных, и удаление файлов с истекшим
сроком хранения. Поскольку задание с переключателем /G
действует не только на саму заданную в Parm3 директорию, но и
на все ее субдиректории, то вполне достаточно одной
инструкции для COMMON и всех ее подразделов. Такая инструкция
должна находиться в конце файла инструкций программы
PROCRBUN.EXE.
    Если в конце файла инструкций есть задание с ключом /G,
то во всех остальных заданиях на перезапись файлов лучше не
указывать ключ /Y для подготовки расширенного списка - все
эти списки все равно будут сформированы в последнем задании с
переключателем /G.


Примеры

    Подготовить списки файлов в C:\PROCARRY\HOST\COMMON и во
всех ее поддиректориях. Имена списков - LIST.TXT, а
расширенных - LIST.DIR:

     ,,c:\procarry\host\common,list.txt /g/ylist.dir

    Две следующие инструкции эквивалентны, они задают
построение расширенных списков LIST.DIR во всех
поддиректориях COMMON:

     ,,c:\procarry\host\common,list.dir/g/ylist.dir
     ,,c:\procarry\host\common,list.dir/g

    Следующие строки иллюстрируют различные варианты
перезаписи файлов (ключ /G в них не используется):

c:\p\h\in\mog\*.*,,c:\p\h\out\mins,list.txt,МогТСБ
c:\p\h\in\mog\*.*,,c:\p\h\common\mogilev,list.dir,МгТСБ/m14/a

c:\p\h\in\us1\*.*,,c:\p\h\common\other,list.dir,Абон.US1/i

c:\p\h\in\kiev\*.*,,c:\p\h\common\kiev,list.dir/t/a/ylist.dir


Программа тайм-аута PROCRWT.EXE

    Пpогpамма PROCRWT.EXE после запуска опpеделенное вpемя
выдеpживает паузу и затем возвращает управление в DOS. Для
сброса паузы и выхода из PROCRWT.EXE нажимается специальная
функциональная клавиша.
    При выходе в DOS программа формирует определенный код
возврата, который можно определить в командном BAT-файле.
Всего возможно два варианта: если код выхода 0, то пауза
выдержана до конца; если же код выхода 2, то это означает,
что оператор нажал ключевую функциональную клавишу и сбросил
программу.
    Время и код клавиши сброса задаются в командной строке
при вызове программы:

            PROCRWT.EXE  мин,код

    Первый параметр - время паузы в минутах. После запятой
указывается десятичный код функциональной клавиши для выхода.
    Если параметры не заданы, то по умолчанию пауза 10 минут
и код клавиши 68 (соответствует F10):

                procrwt 10,68


Пpимеp совместного использования PROCRBUN.EXE и PROCRWT.EXE

    С помощью следующего командного файла обеспечивается
циклический вызов каждые 5 минут программы перезаписи
PROCRBUN.EXE. Для сброса на клавиатуре нажимается клавиша
F10.

@Echo off
:Repeat
d:\procarry\procrbun d:\procarry\procrbun.par
d:\procarry\procrwt 5
If  not Errorlevel = 2  Goto :Repeat


Программа часов HOUR.EXE

    Если необходимо в определенное время запустить выполнение
какого-либо задания, то в командном BAT-файле определить
текущий час можно с помощью HOUR.EXE. Эта программа при
вызове не имеет никаких параметров, а при выходе формирует
код возврата, равный текущему часу.
    В следующем примере программа PROCRBUN.EXE запускается
один раз в сутки в 16 часов, все остальное время суток
система находится в ожидании:

@Echo off
Rem procrwt и hour копируются на ram-диск
copy d:\procarry\host\procrwt.exe e:\
copy d:\procarry\host\hour.exe e:\

:Repeat
e:\procrwt 5
If  Errorlevel = 2  Goto :Quit
e:\hour
if  errorlevel = 17  goto :Repeat
If  not errorlevel = 16  goto :Repeat
d:\procarry\host\procrbun d:\procarry\procrbun.par

Rem Ожидание 17 часов, чтобы не было повторного запуска
:Wait
e:\hour
if  not errorlevel = 17  goto :Wait
goto :Repeat

:Quit


Утилита перезаписи файлов PROCOPY.EXE

    Утилита PROCOPY.EXE предназначена для копирования файлов.
В отличие от стандартной функции COPY, PROCOPY.EXE не
копирует файлы с нулевой длиной и те файлы, с которыми в этот
момент работает другая программа (фоновый драйвер или через
локальную сеть). Кроме того, PROCOPY.EXE автоматически
выбирает новые имена для файлов, чтобы не стереть уже
имеющиеся файлы.
    PROCOPY.EXE стирает исходные копии скопированных файлов,
т.е., фактически, выполняется операция "Move".

         PROCOPY  ИсхФайлы  РезДир

1-й параметр при вызове PROCOPY.EXE - имя файла или
спецификация группы файлов, 2-й параметр - имя результирующей
директории, куда надо переписать группу файлов. 1-й параметр
может включать знаки * или ?.

    Примеры.

    procopy  d:\faxes\fax?fl.txt  f:\sendfax\
    procopy  *.tel  f:\protelg\1


Программа обработки системных журналов PROCRJRN.EXE

    Программа PROCRJRN.EXE сортирует и суммирует журналы
программы обработки электронной почты SORTU.EXE. Файлы
журналов фонового драйвера PROCRSRV.COM записываются в
сокращенном виде, для их расшифровки в нормальный текстовый
вид используется PROCRJRN.EXE.


Расшифровка журналов драйвера PROCRSRV.COM

    Для расшифровки журнала соединений драйвера PROCRSRV.COM
выдается команда

      [Путь] PROCRJRN.EXE   Исходн.   Результ.

где Исходн. и Результ. - соответственно файл журнала в
сокращенном исходном виде и файл в результирующем текстовом
виде. Можно задавать имена файлов с указанием полного пути
доступа, можно задать результирующий файл на принтер - PRN
или на экран - CON.
    Если параметры не заданы, то программа запрашивает их
сама.
    Примеры:
            ProcrJrn  journ.ch1   con
            ProcrJrn  source.ch1  journal1.txt


Сортировка журналов драйвера PROCRSRV.COM

    Для сортировки журнала соединений драйвера PROCRSRV.COM
выдается команда

      [Путь] PROCRJRN.EXE   Исходн.   Результ.  /S

где Исходн. и Результ. - соответственно файл журнала в
сокращенном исходном виде и файл в результирующем текстовом
виде.
    В случае, если PROCRJRN.EXE вызвана с ключом /S, она
создает расшифрованную копию самого журнала, как при обычном
ее вызове, и 2 файла - SUM.TXT и SUM2.TXT. Файл SUM.TXT -
итоги работы каждого абонента по сеансам связи. Он содержит
следующие колонки:
    - имя абонента;
    - время и дата начала сеанса связи;
    - время работы в минутах;
    - длина файлов в байтах, переданных на узел в свой
почтовый ящик;
    - длина файлов в байтах, прочитанных из своего личного
почтового ящика;
    - длина файлов, прочитанных из разделов COMMON;
    - длина прочитанных файлов-списков из разделов COMMON.

    Итоговый файл SUM2.TXT содержит такие же колонки, как и
SUM.TXT, кроме времени и даты. Этот файл содержит полный итог
работы каждого абонента по всем сеансам связи.


Сортировка журналов программы SORTU.EXE и подсчет итогов

    Программа сортировки почты все сведения о своей работе
записывает в файлы-журналы JOURNAL.SR2 и JOURNAL.CMN. Их
сортировка и подсчет итогов могут быть выполнены с помощью
PROCRJRN.EXE.
    При вызове PROCRJRN.EXE директория и диск, содержащие
файлы JOURNAL.SR2 и JOURNAL.CMN, должны быть текущими. В
качестве параметров задается ключ /G

      [Путь] PROCRJRN.EXE   /G

    В результате сортировки получаются следующие файлы:
  - JOURNAL.SR3 рассортированный по именам абонентов журнал
JOURNAL.SR2;
  - JOURNAL.SR4 итоги из JOURNAL.SR2 по именам абонентов;
  - JOURNAL.SA3 рассортированный по обратным адресам
абонентов журнал JOURNAL.SR2;
  - JOURNAL.SA4 итоги из JOURNAL.SR2 по обратным адресам
абонентов;
  - JOURNAL.CM3 рассортированный по именам абонентов журнал
JOURNAL.CMN;
  - JOURNAL.CM4 итоги из JOURNAL.CMN по именам абонентов;
  - JOURNAL.CA3 рассортированный по обратным адресам
абонентов журнал JOURNAL.CMN;
  - JOURNAL.CA4 итоги из JOURNAL.CMN по обратным адресам
абонентов.

    Всего получается 8 файлов - 4 рассортированных файла
журналов и 4 итоговых файла. Сортировка и подсчет итогов
ведется в разрезе имен абонентов и обратных адресов
абонентов. Структура рассортированных файлов в точности
соответствует структуре самих журналов. Итоговые файлы
содержат те же графы, что и журналы, кроме даты, и
дополнительно еще одну графу - количество записей в журнале.


Программа автоматических запросов списков REQUEST.EXE

    С помощью программы REQUEST.EXE можно автоматически
формировать запросы списков и файлов общего доступа COMMON.
REQUEST.EXE формирует списки файлов LIST.REQ, используемые
коммуникационными драйверами PROCRUCS.EXE и SFAST.EXE для
запросов информации из узлов почты из разделов общего доступа
COMMON.
    REQUEST.EXE автоматически формирует список LIST.REQ на
основании задаваемого ей файла параметров. Файл параметров
описывает имена поддиректорий COMMON и группы запрашиваемых
из них файлов.
    Программа имеет три режима работы. Первый режим
предназначен для формирования запросов не самих
информационных файлов, а списков файлов в поддиректориях
LIST.DIR. Во втором режиме на основе полученных списков и
файла параметров формируется LIST.REQ уже с запросами
информационных файлов в подразделах COMMON. Третий режим
вспомогательный, он используется для ожидания освобождения
коммуникационного канала, необходимого для проверки окончания
работы фоновой программы SFAST.EXE.


Вызов программы REQUEST.EXE

    Первый режим программы предназначен для формирования
файла запросов LIST.REQ, в котором с узла почты запрашиваются
списки файлов LIST.DIR. Строки с запросами списков LIST.DIR в
файле LIST.REQ формируются на основе файла параметров.
    Следует заметить, что новые строки запросов дописываются
в файл LIST.REQ, предыдущие строки в нем сохраняются.
    Вызов программы имеет вид

[путь]REQUEST.EXE  1  ФайлПарам  ИмяCOMMON  ИмяДирREQ  ИмяDIR

    Всего задается 5 параметров, отделяемых друг от друга
пробелами. Первые 4 параметра обязательные, последний может
отсутствовать и тогда вместо него используется значение по
умолчанию LIST.DIR.
    Первый параметр - номер режима 1.
    ФайлПарам - путь доступа и имя файла параметров
программы.
    ИмяCOMMON - имя директории COMMON, куда будут
записываться принятые через модем файлы и списки LIST.DIR.
    ИмяДирREQ - имя директории, куда должен записываться файл
запросов LIST.REQ.
    ИмяDIR - имя списков файлов. Как правило, это имя всегда
LIST.DIR. Этот параметр необязательный. Если он не задан, то
по умолчанию используется имя LIST.DIR.

    Второй режим программы также используется для
формирования файла запросов LIST.REQ. В отличие от режима 1,
на основе файла параметров и полученных ранее списков файлов
LIST.DIR формируются запросы уже самих информационных файлов
из разделов COMMON узла почты.
    При формировании файла запросов LIST.REQ проверяется,
есть ли уже файл в компьютере. Если какой-то файл уже
имеется, запрос на него не формируется.
    Вызов программы в режиме 2 имеет вид

[путь]REQUEST 2 ФайлПарам ИмяCOMMoN ИмяДирREQ ИмяDIR ИмяCOMN2

    Первые 5 параметров, кроме номера режима 2, точно такие
же, как и в режиме 1. Последние пятый и шестой параметры
необязательные.
    Шестой параметр ИмяCOMN2 иногда может быть необходим,
если файлы-списки находятся не в разделе COMMON, а в другой
директории. Такое может быть, например, на узлах почты,
запрашивающих информацию из других узлов. Параметр задает имя
директории, имеющей такую же структуру вложенных подразделов,
как и сам раздел ИмяCOMMON. В этом случае списки файлов
ИмяDIR будут браться из раздела ИмяCOMN2, а проверка наличия
файлов в COMMON будет вестись по директории ИмяCOMMON.

    Третий режим помогает организовать ожидание окончания
сеанса связи с узлом почты. Программа SFAST.EXE работает в
фоновом режиме, а для того, чтобы приступить к формированию
файла запросов LIST.REQ в режиме 2, необходимо дождаться
окончания сеанса связи и получения всех списков файлов
LIST.DIR.
    Вызов программы в режиме 3 имеет вид

       [путь]REQUEST.EXE  3  Канал

    Первый параметр 3 - номер режима. Второй задает номер
канала связи ProCarry и должен быть цифрой от 0 до 9.
    В режиме 3 программа REQUEST.EXE как бы "подвисает",
дожидаясь отбоя соединения по заданному ей каналу ProCarry,
т.е. состояния 5 канала. Если на клавиатуре нажать любой
знак, то программа немедленно завершает работу, не дожидаясь
освобождения канала.
    REQUEST.EXE через коды завершения сообщает о том, каким
способом она закончила работу. Если код выхода равен 1, это
значит, что была нажата клавиша на клавиатуре. Код завершения
0 означает нормальный выход после отбоя связи.


Пример вызова программы

    Следующий пример показывает, как сначала на основе файла
параметров REQLIST.TXT формируется запрос всех списков файлов
LIST.DIR из узла почты OVERNET, затем на основе принятых
списков LIST.DIR и того же файла параметров формируется
запрос и на сами информационные файлы из разделов COMMON
узла.

d:
cd \procarry
procmail\request 1 overnet\reqlist.txt overnet\common overnet
call overnet.bat 2
procmail\request 3 0
If  ErrorLevel = 1  goto :quit
procmail\request 2 overnet\reqlist.txt overnet\common overnet
call overnet.bat 2
:quit


Файл параметров программы

    Файл запросов LIST.REQ программой формируется на основе
файла параметров. Он представляет собой текстовый файл,
каждая строка в котором описывает запрашиваемый файл или
группу файлов. Файл параметров создается любым текстовым
редактором.
    Имена файлов и групп файлов могут содержать имена
директорий в разделе COMMON. При этом указывается не полный
путь поиска файла на диске узла почты, а только часть пути
относительно главного раздела COMMON. Имена файлов в главнои
разделе COMMON должны вводиться вообще без имен директорий.
    Имена файлов могут содержать знаки * и ?, описывающие
группы файлов по правилам DOS. Для разделения имен директорий
используется, как обычно, знак \.

    В режиме 1 программы используются только имена директорий
из строчек файла параметров, а имена файлов отсекаются и
вместо них присоединяется имя списка LIST.DIR. В режиме 2
сопоставляются все записи в файле параметров и
соответствующие списки LIST.DIR. При этом каждый файл
проверяется, имеется ли он уже в компьютере, проверка
производится по размеру и дате создания.


Пример файла параметров

    В первой строке примера по маске K*.ARJ запрашиваются все
новые файлы из раздела ADVERT.
    Во второй строке содержится команда формировать запросы
на все новые файлы из главной директории COMMON.
    Третья строка формирует запросы на все новые файлы из
подраздела COMPUT\MODEM\NEWS. В режиме 1 будет сформирован
запрос списка COMPUT\MODEM\NEWS\LIST.DIR из этого раздела. Но
следует иметь ввиду, что списки из COMPUT\MODEM и COMPUT по
этой строке не запрашиваются, хотя COMPUT\MODEM\NEWS -
вложенный в них раздел. Для каждого подраздела COMMON должна
быть своя собственная строка для запроса списков.
    Четвертая строка показывает, как сформировать запрос
списка LIST.DIR в режиме 1, но не запрашивать ни одного файла
в режиме 2.
    Последняя строка указывает запросить конкретный файл,
если он обновился на узле.
    Следует заметить, что на основе 1-й и 5-й строк будет
сформирован только один запрос списка ADVERT\LIST.DIR, чтобы
напрасно не переписывать через модем одну и ту же информацию.

advert\k*.arj
h*.*
comput\modem\news\*.*
comput\.
ADVERT\T*.TXT
DIGEST\NEWS.TXT

ЧАСТЬ 13. РАБОТА ЧЕРЕЗ СЕТИ Х.25


Команда Set

    Если при подключении к PAD какие-то из параметров
протокола Х.3, установленных на PAD по умолчанию, не
устраивают, их можно изменить с помощью команды Set, входящей
в рекомендации Х.28 и Х.29. Команда Set действует только на
время соединения и в момент отключения от PAD параметры
автоматически возвращаются в исходное состояние.
    Команда Set имеет вид

     SET  парам:число, парам:число, ...

парам - номер параметра протокола Х.3, число - задаваемое
значение для этого параметра. В одной команде Set может быть
перенастроено несколько параметров, друг от друга параметры
отделяются запятыми. В конце строки передается CR.
Пробелы-разделители не обязательны.
    Например, Set 1:0, 5:0, 12:0

    Команда Set передается в PAD после подключения к нему.
Для подключения к PAD обычно передается сначала свой
идентификатор, затем - пароль. После настройки параметров
протокола Х.3 вводится идентификатор вызываемого хоста.
    Например, подключение к сети EstPak выглядит следующим
образом:

    Для входа в сеть Х.25 надо звонить по телефону
8-0142-771556. После получения CONNECT необходимо сделать
паузу 1-2 сек и ввести:
 1) Идентификатор пользователя и пароль.
    Например:   NBANK/DEMO-   [Enter]
 2) Изменение параметров PAD.
    Например:   Set 1:0, 5:0, 12:0  [Enter]
 3) Сетевой адрес вызываемого хоста.
    Например:   150010   [Enter]
 4) Если все было введено правильно, то Х.25 отвечает:
        COM  [ENTER]
    Если на линии в течение 5 минут никаких действий не
происходит, то следует положить трубку.


Настройка ProCarry для работы через сети Х.25

    Для выхода в сети Х.25 через пакет ProCarry необходимо
следующее. ProCarry работает через сети Х.25 только по
протоколу программы SFAST.EXE, аналогичному Zmodem (но
двунаправленному, в отличие от Zmodem). Поэтому настройки
параметров протокола Х.3 для работы ProCarry через Х.25
должны соответствовать настройкам для Zmodem. Все параметры
для подключения к сети Х.25 и через нее к хосту записываются
в карточке пользователя в графе "Идентификатор вызывающей
станции". При работе по SFAST-протоколу эта графа по своему
первоначальному назначению не используется и поэтому
записанные в нее данные повлиять ни на что не могут.
    В ProCarry при настройке программой PROCRINS.EXE можно
указать, что управление потоком производится при помощи
знаков Xon и Xoff. Для этого параметр номер 4 во втором
экране настройки программы PROCRINS.EXE (число звонков для
модема V.23) устанавливается равным 8 или 9. В противном
случае ProCarry будет управлять потоком при помощи CTS/RTS.

    Установление соединения через сеть Х.25 происходит
следующим образом. После команд PROCRSRV.COM Alt-F2, Alt-F6
или Alt-F5 набирается номер телефона, указанный в графе
"Номер телефона" в карточке пользователя. Номер телефона
указывается тот, который принадлежит PAD сети Х.25. Драйверы
ProCarry после набора номера телефона и получения сообщения
CONNECT от модема, начинают передавать на PAD заданные в
графе "Идентификатор вызывающей станции" строки данных.
Передав все строки, драйверы ProCarry начинают ожидать
ключевых строк от хостовой станции, как при обычном
соединении не через сеть Х.25.
    Строки данных в графе "Идентификатор вызывающей станции"
отделяются друг от друга знаком | (код 7D). Во время передачи
строк на PAD знак | автоматически заменяется на знак возврата
каретки CR (код 0D). Между строками после каждого знака |
(который при передаче меняется на CR) драйверы автоматически
делают паузу 4,5 сек.
    Первый и последний знаки в графе "Идентификатор
вызывающей станции" должны обязательно быть |. Они указывают,
что соединение через Х.25 и необходимо передавать данные для
подключения. Если знака | вначале нет, то считается, что
подключение к хосту прямое без сети Х.25 и ничего в линию не
передается, драйверы сразу же устанавливаются на ожидание
ключевых строк от хостовой станции.

    Пример. Строка для подключения к сети EstPak, описанному
в примере ранее, выглядит следующим образом

      |NBANK/DEMO-|Set 1:0,5:0,12:0|150010|

    Если необходимо увеличить размер паузы перед передачей
1-й строки, то следует поставить два знака | подряд, а вслед
за ними - передаваемые данные.

    Универсальная строка для всех PAD независимо от настройки
без управления потоком данных по протоколу Xon/Xoff:

Set 1:0,2:0,3:0,4:1,5:0,6:5,9:0,10:0,12:0,13:0,14:0,15:0,21:0

    При подключении к PAD, не управляющих потоком по цепям
CTS/RTS, необходимо управлять потоком с помощью Xon/Xoff.
Тогда строка выглядит следующим образом:

Set 1:0,2:0,3:0,4:1,5:1,6:5,9:0,10:0,12:0,13:0,14:0,15:0,21:0

    Драйверы ProCarry имеют возможность автоматически
передать на PAD универсальную строку Set. При этом они
автоматически распознают, какую именно строку следует
передать - для подключения по протоколу CTS/RTS или Xon/Xoff
(из настройки параметра - числа звонков программой
PROCRINS.EXE). Для того, чтобы универсальная строка была
передана на PAD, необходимо вставить в строку "Идентификатор
вызывающей станции" знак ~ (код 7E). Этот знак указывает
передать на PAD соответствующую команду Set. Тогда пример для
подключения к сети EstPak выглядит следующим образом:

            |NBANK/DEMO-|~|150010|

    В настоящей реализации ProCarry максимальная длина поля в
графе "Идентификатор вызывающей станции" может быть 75
знаков.

ПРИЛОЖЕНИЕ А. ПРОТОКОЛ Х.3

    Параметры PAD настраиваются в соответствии с протоколом
Х.3. Каждый PAD имеет несколько заранее установленных
профилей параметров. Пользователь после подключения к PAD
имеет возможность выбрать один из профилей PAD, используемый
им при связи с другим абонентом. Если профиль PAD не выбран,
устанавливается предварительно заданный профиль, который
удовлетворяет большинству пользователей PAD. Возможно
изменение параметров PAD посредством команды SET.
    Протокол Х.3 описывает 22 параметра настройки PAD.

Х.3-1 Символ внимания для перехода из состояния передачи
      данных в виртуальном соединении в командный режим
      работы с PAD.
      0 - нет символа внимания, переход с использованием
          символа невозможен;
      1 - используется символ Ctrl-P (DLE) для перехода в
          командный режим;
      32-126 - в качестве символа внимания используется
          символ ASCII с кодом, двоичное представление
          которого равно величине параметра.

Х.3-2 Эхо на передаваемые в PAD символы.
      0 - нет эхо;
      1 - каждый переданный в PAD символ передается из него
          как эхо.

Х.3-3 Условия завершения формирования пакета.
      0 - никакой символ не является условием для завершения
          формирования пакета, пакет формируется или по
          заполнении буфера, или в соответствии с параметром
          X.3-4;
      1 - пакет данных формируется и передается при нажатии
          '*';
      2 - пакет данных формируется и передается при нажатии
          CR;
      4 - пакет данных формируется и передается при нажатии
          ESC, ENQ, BEL, ACK;
      6 - пакет данных формируется и передается при нажатии
          CR, ESC, ENQ, BEL, ACK;
      16 - пакет данных формируется и передается при нажатии
          ETX или EOT;
      126 - пакет данных формируется и передается при нажатии
          любого управляющего символа из колонок 0 и 1
          кодовой таблицы ASCII или символа DEL.

Х.3-4 Временные условия формирования пакета - указывает
      длительность интервала времени между символами,
      превышение которого вызывает завершение PAD-ом сборки
      пакета и передачу его.
      0 - временное условие не используется;
      1-255 - время после ввода последнего символа, через
          которое пакет посылается удаленному хосту
          (еденица - 1/20 сек).

Х.3-5 Управление информационным потоком с терминала.
      0 - PAD не может управлять информационным потоком с
          терминала при помощи символов Xon и Xoff;
      1 - PAD управляет информационным потоком данных,
          передаваемым с терминала при помощи символов CTRL-Q
          и CTRL-S (Xon/Xoff).

Х.3-6  Управление выводом на терминал соообщений PAD.
       0 - сообщения PAD не выводятся на терминал
          пользователя;
       1 - сообщения PAD, кроме prompt-сообщений, выводятся
          на терминал пользователя;
       4 - на терминал пользователя выводятся только
          prompt-сообщения PAD;
       5 - сообщения PAD выводятся на терминал пользователя;
       8 - выводятся только сообщения редактирования;
      12 - выводятся только сообщения редактирования и
          prompt-сообщения PAD.

Х.3-7  Управление при разрыве соединения или сигнале Break.
       0 - PAD не реагирует на сигнал Break;
       1 - PAD передает на удаленную сторону пакет
          прерывания;
       2 - PAD передает на удаленную сторону сигнал "сброс";
       4 - PAD передает на удаленную сторону пакет индикации
          сигнала Break;
       8 - PAD воспринимает сигнал Break как переход в
          командный режим;
       21 - данные, принимаемые из сети, сбрасываются, а на
          удаленную сторону передается пакет индикации
          сигнала Break.

Х.3-8  Игнорирование вывода - позволяет PAD-у не учитывать
       информационную область при разборке пакета
       пользователя и передаче его терминалу.
       0 - нормальная доставка данных асинхронному терминалу;
       1 - отбрасывание данных, посланных асинхронному
          терминалу.

Х.3-9  Вставка символа с кодом "00" после вывода на терминал
       символа возврата каретки CR.
       0 - символ с кодом "00" после CR не вставляется;
       1-127 - число символов с кодом "00", вставляемых после
          каждого символа CR.

Х.3-10 Наполнение строки - вставка символа CR через
       определенное число символов.
       0 - символ CR не вставляется;
       1-255 - число символов, через которое вставляется знак
          CR.

Х.3-11 Скорость передачи информации - параметр только для
       чтения. Позволяет прочесть скорость терминала,
       известную PAD.
          0 -  110  бит/сек           9 -   100 бит/сек
          2 -  300                   10 -    50
          3 - 1200                   11 - 75/1200
          4 -  600                   12 -  2400
          5 -   75                   13 -  4800
          6 -  150                   14 -  9600
          8 -  200                   15 - 19200

Х.3-12 Управление информационным потоком от PAD на терминал
       пользователя.
       0 - пользователь не может управлять потоком данных,
          получаемым от PAD, с помощью Xon/Xoff;
       1 - пользователь управляет потоком информации,
          выводимым от PAD, с помощью символов Ctrl-Q и
          Ctrl-S (Xon/Xoff).

Х.3-13 Автоматическая вставка символа LF (перевод строки).
       0 - символ LF не вставляется;
       1 - PAD вставляет символ LF после символа CR,
          принятого от удаленного хоста;
       4 - PAD передает символ LF после символа CR, принятого
          от терминала;
       5 - PAD выводит символ LF после символа CR, принятого
          от удаленного хоста и от терминала.

Х.3-14 Вставка символа с кодом "00" после вывода на терминал
       символа перевода строки LF.
       0 - символ с кодом "00" после LF не вставляется;
       1-127 - число символов с кодом "00", вставляемых после
          каждого символа LF.

Х.3-15 Использование функций редактирования в состоянии
       передачи данных.
       0 - функции редактирования не используются в PAD и
          управляющие символы редактирования передаются PAD
          как информационные (редактирование может
          происходить на стороне удаленного хоста);
       1 - функции редактирования используются в PAD и
          символы редактирования определяются параметрами
          16 - 19, 22; действие параметра Х.3-4
          приостанавливается.

Х.3-16 Удаление символа.
       0-127 - значение символа BS, используемого для
          удаления последнего введенного знака (8 - BACKSPACE
          (Ctrl-H)).

Х.3-17 Удаление строки.
       0-127 - значение символа, используемого для удаления
          строки (24 - Ctrl-X).

Х.3-18 Символ вывода строки.
       0-127 - символ вывода строки.

Х.3-19 Тип подключаемого терминала (для определения реакции
       на символ редактирования BS).
       0 - принтер, позиция печати не изменяется управляющим
          сигналом BS. Символ BS не используется в качестве
          сигнала PAD;
       1 - принтер, позиция печати смещается на 1 шаг влево
          до достижения левой границы поля печати. Символ BS
          не используется в качестве сигнала PAD;
       2 - дисплей, позиция печати смещается на 1 шаг влево
          до достижения левой границы, после чего
          осуществляется переход к правой границе. Символ BS
          используется в качестве сигнала PAD для удаления
          символов и строк.
       3 - дисплей, позиция печати смещается на 1 шаг влево
          до достижения левой границы. Символ BS используется
          в качестве сигнала PAD для удаления символов и
          строк.

Х.3-20 Маска эхо на символы, если параметр Х.3-2 установлен в
       значение 1. При помощи этой функции эхоплексируется
       только группа символов, а не все символы.
       0 - все символы, исключая ESC, символ выхода из режима
          передачи данных, указанный в параметре X.3-1,
          символы редактирования и управления потоком
          передачи; это значение параметра рекомендуется для
          нормальной работы;
       1 - алфавитно-цифровые символы;
       2 - CR;
       4 - ESC, BEL, ENQ, ACK;
       8 - DEL, CAN, DC2;
      16 - ETX, EOT;
      32 - HT, LF, VT, FF;
      64 - все остальные символы ASCII в колонках 0 и 1
          кодовой таблицы, не указанные выше;
     128 - все остальные символы ASCII, не указанные выше.
       Возможно суммировать параметры для комбинации
     желаемого набора. Если значение параметра равно 255,
     эхоплексируются все символы.
       Сигналы выхода из режима передачи данных и
     редактирования никогда не эхоплексируются.

Х.3-21 Бит четности при передаче.
       0 - в каждом знаке 8 бит без четности, старший бит
          анализируется, коды всех знаков воспринимаются в
          диапазоне от 0 до 255;
       1 - 8 бит без четности, старший бит не анализируется,
          код символа передается в канал без изменений,
          однако реакция на знаки со старшей и младшей
          половин кодовой таблицы ASCII одинаковая (например,
          знаки 0D и 8D воспринимаются как одинаковые);
       2 - 7 бит информационных и бит четности.

Х.3-22 Количество строк в странице.
       0-127 - количество строк в странице.

ПРИЛОЖЕНИЕ Б. ПРИМЕРНАЯ ТАБЛИЦА ПАРАМЕТРОВ ПРОТОКОЛА Х.3 ДЛЯ
              РАБОТЫ В РЕЖИМЕ ТЕРМИНАЛА И В РЕЖИМЕ ZMODEM

     ┌─────┬─────────────┬────────┬─────────┬──────────┐
     │ N   │ Название    │Терминал│ Zmodem  │  Zmodem  │
     │парам│параметра Х.3│        │ CTS/RTS │ Xon/Xoff │
     ├─────┼─────────────┼────────┼─────────┼──────────┤
     │  1  │ X.28ACC     │    1   │     0   │    0     │
     │  2  │ ECHO        │    1   │     0   │    0     │
     │  3  │ D.FORWRD    │  126   │     0   │    0     │
     │  4  │ EDLE TIMER  │    0   │     1   │    1     │
     │  5  │ DV.FLOW     │    1   │     0   │    1     │
     │  6  │ S.SIGNAL    │    5   │     5   │    5     │
     │  7  │ BREAK       │   21   │    21   │   21     │
     │  8  │             │    0   │     0   │    0     │
     │  9  │ CR.PAD      │    0   │     0   │    0     │
     │ 10  │ L.FOLD      │    0   │     0   │    0     │
     │ 11  │ SPEED       │   12   │    12   │   12     │
     │ 12  │ P.FLOW      │    1   │     0   │    0     │
     │ 13  │ AUTO LF     │    4   │     0   │    0     │
     │ 14  │ LF.PAD      │    0   │     0   │    0     │
     │ 15  │ EDIT        │    1   │     0   │    0     │
     │ 16  │ C.DEL       │    8   │     8   │    8     │
     │ 17  │ L.DEL       │   24   │    24   │   24     │
     │ 18  │ L.DISP      │   18   │    18   │   18     │
     │ 19  │ DV.TYP      │    2   │     2   │    2     │
     │ 20  │ ECHO MASK   │    0   │     0   │    0     │
     │ 21  │ PARITY      │    1   │     0   │    0     │
     │ 22  │ PAGE        │    0   │     0   │    0     │
     └─────┴─────────────┴────────┴─────────┴──────────┘

ПРИЛОЖЕНИЕ В. НАБОР AT КОМАНД HAYES


Режимы работы модема

    Управление модемами осуществляется с помощью AT команд
Hayes. Модемы могут находиться в двух состояниях - в
командном режиме и в режиме передачи данных CONNECT.
    Модем способен принимать и обрабатывать команды, когда он
находится в командном режиме, т.е. принимаемые модемом
символы интерпретируются как команды.
    В случае, если модем соединяется с другим модемом, он
переходит в режим передачи данных CONNECT. В этом режиме
символы передаются прозрачно от модема к модему. Для перехода
в командный режим имеется специальная последовательность
выхода - три знака "+" (плюс) подряд. При разрыве соединения
модем также переходит в командный режим.


Ввод "AT" команд

    После включения питания модем переходит в состояние
приема "AT" команд - в командный режим. С "AT" префикса
начинается каждая командная строка (исключая команду A/ и
+++).
    Командная строка должна заканчиваться символом возврата
каретки CR с кодом 13. Символы в строке вводятся на любом
регистре и запоминаются в буфере командной строки размером до
40 байт. Пробелы внутри строки игнорируются, кроме самого
префикса "AT", который всегда должен вводиться целиком.
    Внутри одной строки после префикса "AT" может быть
несколько команд, которые модем будет поочередно выполнять
после ввода всей строки и знака CR.
    Для коррекции ошибок при введении команд используются
клавиши шага назад и забоя.


Наборы "AT" команд

    Существует несколько наборов "AT" команд. Некоторые из
них минимальные и используются практически всеми модемами.
Наборы команд, начинающихся с латинских букв или со знака "&"
являются промышленным стандартом.
    Модемы, имеющие режимы работы MNP2-5, управляются
расширенным набором команд, также одинаковым практически во
всех модемах. Однако команды управления работой в режиме V.42
во многих модемах не совпадают.


Минимальный набор "AT" команд

    Команды минимального набора имеются в большинстве модемов
и имеют в них совершенно одинаковое толкование.


A/ Команда повтора

    Эта команда выполнит предыдущую команду. A/  -
единственная команда, перед которой не требуются символы
"AТ".


A  Переход в режим ответа

    Параметры: отсутствуют.

    Команда "A" переводит модем в состояние установления
соединения в ответном режиме. Если процедура установления
соединения завершилась успешно, модем переходит в режим
передачи данных с выдачей сообщения "CONNECT". Для того,
чтобы вернуть модем в командный режим, необходимо подать
команду выхода "+++".
    Если после подачи команды "A" передается еще какой-нибудь
символ, то процедура установления соединения прерывается и
модем переходит в командный режим с передачей сообщения
"NO CARRIER".


B  Bыбор стандарта BELL или CCITT

    Параметры: 0,1. По умолчанию обычно 1.

    Эта команда используется для выбора между альтернативными
стандартами BELL и CCITT для скоростей 300 или 1200 бит/с.

    B0  Стандарт CCITT V.22.

    B1  Стандарт Bell 212A.


D  Набор номера

    Набираемые цифры: 0 1 2 3 4 5 6 7 8 9 # * A B C D
    Модификаторы:     T P W @ ! R S , / ;
    Разделители:      ( ) - <ПРОБЕЛ>

    По команде "D" модем начинает автонабор номера или
переходит в вызывной режим (команда "ATD"). Параметры команды
могут содержать 16 стандартных тоновых цифр. Эти цифры могут
быть разделены символами-разделителями, не влияющими на набор
номера, но делающими более удобным чтение текста номера.
Модификаторы определяют способ, которым будет осуществляться
набор, они могут встречаться в любом месте текста номера.

    T  Тональный набор.

    P  Импульсный набор.

    W  Ждать ответного тона станции. Время ожидания
определяется содержимым регистра S7.

    @  Ждать ответной паузы. Когда в строке набора будет
обнаружен символ "@", модем в течение времени, определяемого
регистром S7, ожидает хотя бы одного ответного вызывного
сигнала станции, затем в течение 5 секунд ожидает отсутствия
сигналов ответов станции и продолжает набор номера. Если
этого не произойдет, то вызов будет прерван, и модем вернет
результат "NO ANSWER" - нет ответа.

    !  Отсоединение модема на 1/2 секунды от линии. После 1/2
секунды модем снова подсоединяется к линии.

    R  По символу "R" модем выполняет операции по набору
номера и в конце переводится в ответный режим установления
соединения, как после команды "ATA".

    S  Набрать хранимый в памяти номер. Команда "ATDS"
вызовет набор номера, сохраняемого в энергонезависимой памяти
модема. Если модем имеет в NVRAM несколько областей номеров,
команда имеет вид "ATDS=n", n - номер области в NVRAM.

    ,  Задержка при наборе номера на время, определяемое
регистром S8. Обычно S8 = 2 сек.

    /  Задержка при наборе номера 0,125 секунды.

    ;  Знак ";", поставленный в конце команды набора номера,
возвращает модем в командный режим. Модем не переходит в
режим установления соединения, оставаясь подключенным к линии
и ожидая ввода очередной команды. Модем выдает "OK" после
окончания набора.


E  Команда эхо

    Параметры: 0,1. По умолчанию обычно 1.

    Эта команда включает или выключает эхо на вводимые в
командном режиме символы.

    Е0  Выключить эхо в командном режиме.

    E1  Включить эхо в командном режиме.


H  Команда переключения линии

    Параметры: 0,1. По умолчанию 0.

    Команда подключает или отключает модем от линии.

    H, H0  Разорвать соединение и отключить модем от линии
("положить трубку").

    H1  Подключить модем к линии ("поднять трубку").


I  Команда идентификации

    Параметры: 0,1.

    Команда вызывает выдачу идентификационных кодов модема.

    I0  Модем выдает информацию о номере модема.

    I1  Модем выдает контрольную сумму своего ПЗУ программ в
формате трехзначного десятичного числа.


L  Громкость звука

    Параметры: 0..3. По умолчанию обычно 2.

    Эта команда управляет уровнем громкости звука встроенного
громкоговорителя.

    L, L0, L1  Низкая громкость.

    L2  Средняя громкость.

    L3  Высокая громкость.


M  Управление громкоговорителем

    Параметры: 0..3. По умолчанию обычно 1.

    Эта команда управляет работой громкоговорителя.

    M0  Громкоговоритель выключен всегда.

    M1  Громкоговоритель включен на время набора номера и при
установлении соединения.

    M2  Громкоговоритель включен всегда.

    M3  Громкоговоритель включен при установлении соединения,
но на время набора номера выключен.


O  Переход в режим передачи данных

    Параметры: 0,1. По умолчанию 0.

    Команда "O" употребляется для возврата из командного
режима в режим передачи данных CONNECT после того, как ранее
уже было установлено соединение и выдана команда выхода
"+++".

    O, O0  Вернуться в режим передачи данных.

    O1  Вернуться в режим передачи данных с генерацией
настроечной последовательности для другого модема.


Q  Управление кодом ответа

    Параметры: 0,1. По умолчанию обычно 0.

    Эта команда разрешает или подавляет посылкой от модема
кодов ответа, формируемых после приема команд.

    Q0  Разрешить ответные сообщения от модема.

    Q1  Запретить ответные сообщения от модема.


Sr?  Запрос S-регистра

    Эта команда возвращает десятичную величину, хранящуюся в
выбранном S-регистре r. Например, для получения содержимого
регистра 7, вводится  "ATS7?".


Sr=n  Установка S-регистра

    Эта команда используется для загрузки значения n в
S-регистр r. Например, для установки 3 в регистр 0, вводится
"ATS0=3".


V  Развернутый или сжатый код ответа

    Параметры: 0,1. По умолчанию обычно 1.

    Эта команда управляет форматом ответов модема. Ответы
могут выдаваться в текстовом виде или в виде цифровых кодов.

    V0  Сжатые цифровые ответы.

    V1  Развернутые символьные ответы.


X  Разрешение кодов ответа

    Параметры: 0..4. По умолчанию обычно 4.

    Эта команда управляет разрешением определенных кодов
ответа модема и соответствующих им операций при наборе
номера. "X" может быть использована для активизации или
блокирования определенных возможностей модема.

    X0  Разрешить коды ответа от 0 до 4, 10. Перед набором
номера модем делает паузу, определяемую регистром S6, и затем
начинает набор не анализируя сигналов ответа станции или
"занято" ("слепой" набор). Модем передает "CONNECT", если
соединение установлено.

    X1  Разрешить коды ответа от 0 до 5, 10. Модем "слепо"
набирает номер телефона. Если соединение установлено, модем
передает "CONNECT 1200", "CONNECT 2400" и т.д. в зависимости
от скорости передачи информации (полное сообщение).

    X2  Разрешить коды ответа от 0 до 6, 10. Модем ожидает
ответ станции перед началом набора номера и возвращает код
"NO DIALTONE", если в течение 5 секунд не обнаружен сигнал
ответа станции.

    X3  Разрешить коды ответа от 0 до 5, 7, 10. Модем "слепо"
набирает номер. Затем, если обнаруживается сигнал "занято",
модем выдает сообщение "BUSY" и переходит в командный режим.
Иначе модем ожидает соединения в течение времени,
определяемого регистром S7, и выдает полное сообщение о
соединении.

    X4  Разрешить коды ответа от 0 до 8, 10. Модем ожидает
ответ станции, контролирует наличие сигнала "занято" и
передает полное сообщение о соединении.


Y  Удлиненное рассоединение

    Параметры: 0,1. По умолчанию обычно 0.

    Эта команда устанавливает действия модема при обнаружении
пропадания несущей от удаленного модема.

    Y0  Запретить удлиненное рассоединение. Модем немедленно
переходит в командный режим.

    Y1  Разрешить удлиненное рассоединение.  Если модем
обнаруживает пропадание несущей, он в течение 4 секунд
передает в линию сигнал разрыва - последовательность нулей, и
только после этого отключается от линии и переходит в
командный режим.


Z  Сброс модема

    Эта команда восстанавливает исходное состояние модема в
соответствии с параметрами, хранящимися в энергонезависимой
памяти NVRAM.
    В некоторых модемах команда "Z" может иметь параметры -
"ATZ0", "ATZ1" для выбора одного из наборов исходных
установок в NVRAM.


+++  Команда выхода

    Команда выхода переводит модем в командный режим из
режима передачи данных CONNECT. В регистрах S12 и S2
определяются допустимое время ввода команды выхода и
Esc-знак, по умолчанию символ "+".


&C  Управление контролем несущей

    Параметры: 0,1.

    &C0  Модем игнорирует сигнал наличия несущей DCD. DCD
всегда включен.

    &C1  DCD переключается в соответствии с реальным
состоянием наличия несущей от удаленного модема.


&D  Управление сигналом DTR

    Параметры: 0..3.

    &D0  Модем игнорирует сигнал DTR. DTR всегда включен.

    &D1  При отсутствии сигнала DTR модем переходит в
командный режим.

    &D2  При отсутствии сигнала DTR модем переходит в
командный режим. При этом он разрывает соединение,
отключается от линии и отключает автоответ (S0=0).

    &D3 Модем при отсутствии сигнала DTR не только переходит
в командный режим и разрывает соединение, но и заново
инициализируется, как при команде "ATZ".


&F  Загрузка заводской конфигурации модема

    По этой команде конфигурация модема определяется
заводскими установками, занесенными в ПЗУ. В некоторых
модемах команда "&F" может иметь параметры - "&F0", "&F1",
"&F2", определяющие один из наборов заводских установок.


&G  Защитный Guard тон

    Параметры: 0,1,2. По умолчанию обычно 0.

    Для удержания в отключенном состоянии системы
эхозаграждения телефонной сети модемы имеют специальные
возможности. В ответном режиме установления соединения модем
может генерировать защитный тон частотой 1800 или 550 Гц.

    &G0  Нет генерации защитного тона.

    &G1  Защитный тон 550 Гц.

    &G2  Защитный тон 1800 Гц.


&J  Выбор кабеля RJ11/RJ12

    Параметры: 0,1. По умолчанию обычно 0.

    Этой командой модему сообщается, каким кабелем он
подключен к телефонной линии.

    &J0  Кабель RJ11.

    &J1  Кабель RJ12.


&L  Выбор телефонной линии

    Параметры: 0,1. По умолчанию обычно 0.

    По этой команде устанавливается тип телефонной линии:
коммутируемая или выделенная.

    &L0  Выбор коммутируемой линии.

    &L1  Выбор выделенной линии.


&M  Выбор метода передачи

    Параметры: 0..3. По умолчанию обычно 0.

    По этой команде устанавливается синхронный или
асинхронный метод передачи данных.

    &M0  Асинхронный режим.

    &M1  Синхронный режим при передаче данных CONNECT, но
асинхронный режим при наборе номера.

    &M2  Синхронный режим. Для установления соединения
набирается хранимый в памяти номер.

    &M3  Синхронный режим. Для установления соединения
используется телефонный аппарат. Посредством выключения
сигнала DTR предоставляется возможность набрать номер,
завершается вызов включением сигнала DTR.


&P  Параметры импульсного набора

    Параметры: 0,1. По умолчанию обычно 0.

    По этой команде устанавливается соотношение импульс/пауза
при импульсном наборе номера. Суммарная длительность одного
такта (импульса и паузы) всегда 100 мСек или 50 мСек в
Японии. Но длительность импульса относительно всего такта в
разных странах может быть разной: в США - 39%, в Европе и
Японии - 33%.

    &P0  Для США коэффициент пульсаций 39/61.

    &P1  Для Европы и стран бывшего СССР коэффициент
импульсных пульсаций 33/67.


&R  Управление сигналом CTS

    Параметры: 0,1.

    По этой команде устанавливается режим работы цепи CTS.
Возможны варианты, когда CTS всегда включена, и когда CTS
сбрасывается или устанавливается вслед за изменениями сигнала
RTS.

    &R0  CTS следует за RTS.

    &R1  CTS всегда включен.


&S  Управление сигналом DSR

    Параметры: 0,1.

    По этой команде меняются режимы управления сигналом DSR.

    &S0  Сигнал DSR всегда включен.

    &S1  Сигнал DSR используется в соответствии с
рекомендациями CCITT. DSR включается в ON вначале набора
номера или соединения и выключается в тестовом режиме и в
командном режиме. DSR выключается, если несущая теряется.


&T  Тестирование модема

    Параметры: 0..8. По умолчанию обычно 0.

    По этой команде запускаются или останавливаются различные
процедуры тестирования модема.

    &T, &T0  Завершить выполняемый тест.

    &T1  Инициализировать аналоговое самотестирование.
Используется для проверки некоторых внутренних узлов модема
без использования телефонной линии.

    &T2  Зарезервирована.

    &T3  Инициализировать местный цифровой тест. По этой
команде модем тестируется с помощью удаленного модема через
телефонную линию. Перед началом тестирования модемы должны
установить соединение.

    &T4  Разрешить удаленному модему вызвать удаленный
цифровой тест.

    &T5  Отменить режим удаленного цифрового теста,
запущенного по "AT&T4".

    &T6  Инициализировать удаленный цифровой тест. По этой
команде тестируются местный и удаленный модемы. Перед началом
тестирования модемы должны установить соединение. Удаленный
модем должен быть запущен для тестирования командой "AT&T4".

    &T7  Инициализировать удаленный цифровой тест с
самотестированием согласно рекомендации CCITT V.54. По этой
команде тестируются местный и удаленный модемы. Перед началом
тестирования модемы должны установить соединение. Удаленный
модем должен быть запущен для тестирования командой "AT&T4".

    &T8  Инициализировать аналоговое самотестирование
согласно рекомендации CCITT V.54. Используется для проверки
некоторых внутренних узлов модема без использования
телефонной линии.


&V  Вывод активной конфигурации

    Параметры: отсутствуют.

    Эта команда выдает текущее состояние параметров модема.


&W  Записать конфигурацию в энергонезависимую память

    Эта команда записывает профиль текущей активной
конфигурационной области в энергонезависимую память NVRAM.
В некоторых модемах команда имеет параметры 0 или 1, если
NVRAM имеет несколько различных сохраняемых профилей.
    Значения, записанные в NVRAM, восстанавливаются после
включения питания модема или командой "ATZ".


&X  Передача тактовых сигналов

    Параметры: 0,1,2. По умолчанию обычно 0.

    Эта команда используется для выбора источника тактовых
сигналов передатчика для синхронных режимов передачи данных.

    &X0  Используется тактовая частота внутреннего тактового
генератора передатчика модема.

    &X1  Тактовые сигналы передатчика поступают в модем от
терминала через цепь 113 стыка RS-232.

    &X2  Модем генерирует тактовую частоту передатчика из
несущей принимаемого с линии сигнала.


&Zn=k  Сохранить телефонный номер

    По этой команде в память модема записывается телефонный
номер k - любая строка цифр или символов не длиннее 32
знаков. Впоследствии сохраненный номер может быть набран с
использованием команды "ATDS=n" или "ATDS".
    В некоторых модемах можно запомнить несколько номеров в
памяти, номер области памяти модема задается цифрой n. Номер
нулевой области можно опускать, тогда команда выглядит, как
"&Z=k".


Расширенный набор "AT" команд

    Расширенный набор команд предназначен для модемов с MNP и
протоколом V.42. Набор команд для управления MNP уровней 1-5
совпадает практически для всех модемов, чего нельзя сказать о
модемах, использующих протоколы V.42 и V.42bis. Перед
подключением каждого конкретного модема необходимо
внимательно изучить его инструкцию.
    Протоколы MNP1-5, V.42 и V.42bis описывают методы
передачи данных с коррекцией ошибок (протоколы MNP1-4 и V.42)
и методы сжатия передаваемых данных (MNP5 и V.42bis).
    Протоколы MNP1-4 и V.42 используют одни и те же принципы
передачи данных. Данные в линию передаются блоками,
содержащими контрольные суммы, по которым противоположная
сторона определяет, были искажения или нет. Если
обнаруживаются ошибки, блоки передаются повторно.

    MNP уровень 1. Асинхронная работа с байт-ориентированным
форматированием данных в полудуплексном режиме и коррекция
ошибок.

    MNP уровень 2. Асинхронная работа с байт-ориентированным
форматированием данных в дуплексном режиме и коррекция
ошибок. Пропускная способность около 84% от номинальной или
примерно 2000 бит/с при протоколе V.22bis.

    MNP уровень 3. Связь между терминалами и модемами
осуществляется в асинхронном режиме, но модемы между собой
переходят к синхронной бит-ориентированной обработке
передаваемых данных блоками, состоящими от 1 до 64 символов,
с коррекцией ошибок. Пропускная способность примерно 108% от
номинальной или около 2600 бит/с при протоколе V.22bis.

    MNP уровень 4. Основные характеристики такие же, как для
уровня 3, только размер блока динамически изменяем до 256
байтов. Пропускная способность примерно 120% от номинальной
или около 2900 бит/с при протоколе V.22bis.

    MNP уровень 5. Включает уровни 3 и 4 с добавлением
техники сжатия данных. Пропускная способность в зависимости
от типа данных до 200% или 4800 бит/с при протоколе V.22bis.

    V.42. Базирующийся на HDLC протокол передачи данных и
коррекции ошибок, названный LAPM. V.42 был рекомендован в
январе 1990 как международный стандарт. Протокол V.42bis
имеет несколько лучшие характеристики, чем MNP4, при
установлении соединения и на "зашумленных" линиях связи.
Кроме того, V.42-LAPM более широко распространен в различном
телекоммуникационном оборудовании и имеет гораздо большие
перспективы развития в будущем.
    Пропускная способность V.42 примерно 120% от номинальной
или около 2900 бит/с при протоколе V.22bis.

    V.42bis. Протокол коррекции ошибок, рекомендованный CCITT
в январе 1990. По сравнению с MNP5, V.42bis имеет гораздо
лучшие характеристики сжатия передаваемых данных. Во многих
случаях коэффициент сжатия достигает 3:1 и даже 4:1


\A  Максимальный размер блока

    Параметры: 0..3.

    По этой команде устанавливается максимальный размер MNP
блока при передаче данных в линию.

    \A0  64 символа.

    \A1  128 символов.

    \A2  192 символа.

    \A3  256 символов.


%A  Символ окончания Авто-Надежного режима работы

    Параметры: 0..127. По умолчанию обычно 0.

    При работе в Авто-Надежном режиме при активной команде
"\C2", если перед началом установления соединения модем
получает символ, определяемый этой командой, он автоматически
переключается в Нормальный режим, выходя из режима MNP.

    %A0  Символ 0 ASCII запрещает автоматическое изменение
режима работы.

    %An  Символ окончания n ASCII, где n=1..127.


\B  Прерывание передачи для Нормального режима данных

    Параметры: 0..9. По умолчанию обычно 0.

    По этой команде модем передает на удаленный модем сигнал
прерывания передачи. Длительность сигнала прерывания
определяется значением параметра (в мСек умноженных на 100).
    Команда \B эффективна только в Нормальном режиме
передачи.


\C  Установка буфера процедур защиты

    Параметры: 0,1,2. По умолчанию обычно 0.

    В некоторых модемах с помощью этой команды можно
управлять использованием буфера модема в момент установления
MNP-соединения. Буфер используется для запоминания знаков во
время установления MNP-соединения. В случае, если соединение
будет установлено в Нормальном режиме, содержимое буфера
передается в свой терминал.

    \C0  Символ автоматического изменения режима работы и
буфер отключены.

    \C1  Используется буфер на 200 знаков. Если буфер
переполняется раньше, чем установлено MNP-соединение, модем
переходит в Нормальный режим.

    \C2  Если перед установлением MNP-соединения будет принят
символ, определяемый командой "%A", то модем перейдет в
Нормальный режим.


%C  Контроль сжатия данных

    Параметры: 0,1. По умолчанию обычно 1.

    В некоторых модемах с помощью этой команды можно
разрешить или запретить сжатие передаваемых данных.

    %C0  Сжатие данных запрещено.

    %C1  Сжатие данных разрешено.


\G  Управление потоком данных в Нормальном режиме

    Параметры: 0,1. По умолчанию обычно 0.

    Надежный режим передачи имеет собственный метод
управления потоком передаваемых данных. Команда "\G"
предназначена только для Нормального режима. Поскольку в
Нормальном режиме передаваемые данные запоминаются в
промежуточном буфере модема, ему требуется уметь управлять
потоком данных. Управление может осуществляться с помощью
протокола Xon/Xoff или, в противном случае, с помощью цепей
RTS/CTS.

    \G0  Запретить управление потоком данных с помощью
Xon/Xoff.

    \G1  Включить Xon/Xoff управление потоком данных.


\J  Управление автоподстройкой скорости

    Параметры: 0,1. По умолчанию обычно 1.

    Скорость работы последовательного порта, соединяющего
терминал и модем, зависит от скорости работы по телефонной
линии.
    Есть 2 режима работы модема. В первом случае скорость
последовательного порта должна всегда подстраиваться под
скорость в линии и должна совпадать с ней (автоподстройка
скорости).
    Во втором случае скорость порта неизменна и не зависит от
скорости в линии. Данные буферизуются в памяти модема,
поэтому скорость порта должна превышать скорость в линии.
Чтобы буфер не переполнялся, модем управляет потоком
передаваемых данных с помощью протокола Xon/Xoff или с
помощью цепей RTS/CTS.
    Команда "\J" эффективна только для Нормального и
Надежного режимов работы. В Прямом режиме передачи данных
автоподстройка скорости порта под скорость линии происходит
всегда и не зависит от этой команды.

    \J0  Запретить автоподстройку скорости.

    \J1  Разрешить автоподстройку скорости.


\K  Управление разъединением

    Параметры: 0..5. По умолчанию обычно 5.

    Эта команда задает способ разъединения связи в
зависимости от того, откуда получен сигнал сброса.

    Если сброс получен со своего терминала:

    \K0, \K2, \K4  Модем переходит в командный режим и не
посылает сигнал сброса удаленному модему.
    \K1  Модем очищает все свои буферы данных и немедленно
посылает сигнал сброса удаленному модему.
    \K3  Модем не очищает свои буферы данных и немедленно
посылает сигнал сброса удаленному модему.
    \K5  Модем передает все данные из своих буферов
удаленному модему и затем посылает ему сигнал сброса.

    Если сброс получен от удаленного модема в состоянии
передачи данных CONNECT в Нормальном режиме:

    \K0, \K1  Модем очищает все свои буферы данных и сообщает
терминалу о разъединении.
    \K2, \K3  Модем не очищает свои буферы данных и сообщает
терминалу о разъединении.
    \K4, \K5  Модем передает все данные из своих буферов
своему терминалу, а затем сообщает ему о разъединении.


\L  Управление потоком передачи

    Параметры: 0,1. По умолчанию обычно 0.

    Непрерывная передача - нормальный режим работы
MNP-соединения. В большинстве модемов команда оставлена для
совместимости, блочная передача не применяется.

    \L0  Выбор непрерывной передачи.

    \L1  Выбор блочной передачи.


\N  Режим работы

    Параметры: 0..7.

    Эта команда определяет, в каком режиме модем будет
пытаться установить соединение.

    \N0  Нормальный, не MNP-режим. В этом режиме, если
установка скорости выключена ("AT\J0"), последовательный порт
и телефонная линия могут работать с разными скоростями в
течение соединения, т.к. данные буферизуются в памяти модема
и он управляет потоком данных от терминала. Коррекции ошибок
и сжатия передаваемых данных нет.

    \N1  Прямой режим. Это не MNP-режим, при котором нет
буферизирования данных и игнорируется управление потоком.
Скорость на последовательном порту должна быть согласована со
скоростью работы в телефонной линии. Режим называется Прямым,
т.к. данные без промежуточных буферов в модеме передаются с
терминала прямо в линию.

    \N2  Надежный режим. Это MNP-режим, при котором
обнаружение ошибки автоматически вызывает повтор передачи.
Если удаленный модем не находится в MNP-режиме, связь
прерывается.

    \N3  Авто-Надежный режим. Этот режим аналогичен Надежному
режиму, за исключением того, что при невозможности установки
связи в Надежном режиме из-за отсутствия этой возможности у
удаленного модема, устройство переходит в Нормальный режим.

    \N4  Надежный режим только для протокола V.42.

    \N5  Авто-Надежный режим только для протокола V.42.

    \N6  Надежный режим для V.42 и MNP. Модем сначала
пытается установить режим V.42, затем MNP, после этого связь
прерывается.

    \N7  Авто-Надежный режим для V.42 и MNP. Модем сначала
пытается установить режим V.42, затем MNP, после этого
переходит в Нормальный режим.

    В некоторых модемах команды "\N2" и "\N3" аналогичны
описанным здесь "\N6" и "\N7", т.е. действуют одновременно
для стандартов и MNP, и V.42.


\O  Начать Надежную связь с активной стороны

    Параметры: отсутствуют.

    По этой команде модем пытается установить Надежную связь
в MNP-режиме с активной стороны. Команда может быть выполнена
только в том случае, если модем уже в состоянии передачи
данных CONNECT, но независимо от того, какую он играл роль,
активную или ответную, в момент, когда происходило
соединение.


\Q  Управление потоком данных

    Параметры: 0..4.

    Управление потоком необходимо для предотвращения потери
информации, когда модем осуществляет промежуточную
буферизацию данных в своей памяти. Данные буферизуются
модемом в Нормальном и Надежном режимах.

    \Q0  Отменить управление потоком данных.

    \Q1  Включить двунаправленное программное управление по
протоколу Xon/Xoff. Модем и терминал используют символы Xon и
Xoff для остановки и возобновления передачи данных.

    \Q2  Однонаправленный аппаратный контроль посредством
CTS. В этом режиме модем управляет потоком данных от
терминала, включая и выключая сигнал CTS.

    \Q3  Двунаправленное аппаратное управление сигналами
RTS/CTS. В этом режиме модем управляет потоком данных от
терминала с помощью цепи CTS, а терминал потоком данных от
модема - цепью RTS.

    \Q4  Однонаправленное программное управление по протоколу
Xon/Xoff. Модем использует символы Xon и Xoff для остановки и
возобновления передачи данных.

    В некоторых модемах вместо команды "\Q" используется
"&E". Соответствие при этом такое: "\Q1" - "&E4", "\Q2" -
"&E6", "\Q3" - "&E9", "\Q4" - "&E8".
    Есть наборы команд, где управление потоком осуществляется
с помощью "&K". В этом случае "&K3" соответствует "\Q3",
"&K4" - "\Q1\X0", а "&K5" - "\Q1\X1".


\S  Вывод активной конфигурации

    Параметры: отсутствуют.

    Эта команда выдает текущее состояние параметров модема.


\T  Таймер ожидания

    Параметры: 0..90. По умолчанию обычно 0.

    Эта команда определяет как долго модем будет находиться в
режиме соединения при отсутствии передаваемых данных. Если
нет данных для передачи в течение "n" минут, модем разрывает
соединение. Таймер ожидания может быть использован только в
Нормальном и Надежном режимах.

    \T0  Таймер неактивности выключен, рассоединения по
таймеру нет.

    \Tn  n число минут ожидания, n может быть от 1 до 90.


\U  Воспринять Надежную связь с ответной стороны

    Параметры: отсутствуют.

    По этой команде модем пытается установить Надежную связь
в MNP-режиме с ответной стороны. Команда может быть выполнена
только в том случае, если модем уже в состоянии передачи
данных CONNECT, но независимо от того, какую он играл роль,
активную или ответную, в момент, когда происходило
соединение.


\V  Формат результирующего кода

    Параметры: 0,1,2.

    Эта команда устанавливает формат вывода сообщений о
соединении. В некоторых модемах с протоколом V.42 вместо нее
применяется команда "ATW", в некоторых отсутствует "\V2".

    \V0  Установить вывод стандартных не MNP результирующих
сообщений.

    \V1  Установить вывод модифицированных MNP результирующих
сообщений.

    \V2  Установить вывод модифицированных результирующих
сообщений для V.42.


\X  Управление прохождением сигналов Xon/Xoff

    Параметры: 0,1. По умолчанию обычно 0.

    Эта команда определяет, посылать или нет символы Xon и
Xoff на удаленный модем или в свой терминал.

    \X0  Не передавать Xon/Xoff. В этом режиме поступающие из
терминала символы Xon или Xoff на удаленный модем не
передаются.

    \X1  Передавать Xon/Xoff. В этом режиме, если командой
"AT\Q1" установлено программное управление потоком данных,
знаки Xon/Xoff, переданные в модем из своего терминала,
транслируются еще и удаленному модему. Тогда удаленный
терминал будет управляться знаками Xon/Xoff, переданными
через телефонную линию из своего терминала.


\Y  Переключиться в Надежный режим

    Параметры: отсутствуют.

    По этой команде модем пытается установить Надежную связь
в MNP-режиме из Нормального или Прямого режимов. Команда
может быть выполнена только в том случае, если модем уже в
состоянии передачи данных CONNECT.
    Если в момент установления соединения модем находился в
активном состоянии, то и в процедурах установления MNP-режима
он будет играть активную роль. Если же он был в ответном
состоянии, то и при установлении MNP-режима он будет в
ответном режиме.


\Z  Переключиться в Нормальный режим

    Параметры: отсутствуют.

    По этой команде модем переключается в Нормальный режим
после установления связи в Надежном режиме. Переключение в
Нормальный режим приводит к очистке всех буферов модема, а
также заставляет удаленный модем переключиться в Нормальный
режим.


Описание S-регистров

    Каждый из модемов имеет свой собственный набор
S-регистров. В следующем описании приводится минимальный
набор только тех регистров, которые совпадают во всех
модемах.


S0  Количество звонков до ответа

    По умолчанию: 0. Диапазон: 0..255.

    Устанавливает количество звонков, которые модем должен
получить перед тем, как "поднимет трубку" и начнет процедуру
автоответа.
    Величина 0 отключает функцию автоответа, модем
автоматически не отвечает на звонки, хотя передает терминалу
сообщение о звонке "RING".

S1  Счетчик звонков

    По умолчанию: 0. Диапазон: 0..255.

    Регистр S1 только для чтения, его значение увеличивается
на единицу каждый раз при получении сигнала звонка. Он
автоматически очищается, если в течение 8 секунд не поступит
ни одного сигнала звонка.

S2  Символ Esc-кода

    По умолчанию: 43, десятичное значение ASCII-символа "+".
    Диапазон: 0..255.

    Регистр S2 содержит ASCII-десятичную величину символа
Esc. Значение большее, чем 127, запретит обнаружение
Esc-кода. Трехкратное нажатие на клавишу Esc-кода позволяет
выйти из режима передачи данных CONNECT и перейти в командный
режим, не разрывая соединение.


S3  Символ возврата каретки

    По умолчанию: 13, десятичное значение ASCII-символа CR.
    Диапазон: 0..255.

    Регистр S3 содержит десятичную величину символа возврата
каретки. Этот символ используется как окончание командных
строк, а также результирующих сообщений модема.


S4  Символ перевода строки

    По умолчанию: 10, десятичное значение ASCII-символа LF.
    Диапазон: 0..255.

    Регистр S4 содержит десятичную величину символа перевода
строки. Этот символ выдается после символа возврата каретки,
если включен режим полного вывода результатов командой ATV1.


S5  Символ возврата на шаг

    По умолчанию: 8, десятичное значение ASCII-символа BS.
    Диапазон: 0..255.

    Регистр S5 содержит десятичную величину символа возврата
на шаг. При подаче этого символа удаляется последний
введенный символ с экрана терминала и из буфера командной
строки.


S6  Ожидание тона набора

    По умолчанию: 2. Диапазон: 0..255 (секунд).

    Регистр S6 содержит время в секундах, которое модем будет
ждать перед набором телефонного номера. Значение S6
игнорируется, если разрешены "ATX2" или "ATX4". Если в S6
установлено значение меньшее, чем 2 секунды, модем игнорирует
эту величину и ожидает, как минимум, 2 секунды.


S7  Ожидание несущей после набора

    Диапазон: 0..255 (секунд).

    Регистр S7 содержит время ожидания в секундах, в течение
которого модем пытается установить соединение, прежде чем
отключиться от линии.


S8  Время паузы набора номера

    По умолчанию: 2. Диапазон:  0..255 (секунд).

    Регистр S8 содержит время в секундах, в течение которого
модем будет ждать при получении запятой в строке набора
номера. Эта возможность используется для введения пауз в
процессе набора номера.


S9  Время ответа на обнаружение несущей

    Диапазон: 0..255 (1/10 cекунды).

    Регистр S9 содержит время наличия несущей в 1/10 секунды,
после которого модем устанавливает сигнал DCD (Carrier
Detect) в состояние включено и выдает сообщение о соединении.


S10  Время ответа на потерю несущей

    Диапазон: 0..255 (в 1/10 секунды).

    Регистр S10 устанавливает время контроля отсутствия
несущей, прежде чем модем начнет выполнять процедуры
рассоединения. При увеличении этого времени модем становится
менее чувствительным к пропаданию сигналов в линии. При
записи в регистр S10 значения 255, модем игнорирует статус
несущей и функционирует таким образом, как будто несущая
присутствует всегда.


S11  Длительность тоновой посылки

    По умолчанию: 95 (95 миллисекунд).
    Диапазон: 0..255 (миллисекунд).

    Регистр S11 содержит длительность в миллисекундах тоновой
посылки при частотном способе набора телефонного номера.


S12  Время ограничения Esc-кода

    По умолчанию: 50 (1 секунда).
    Диапазон: 0..255 (1/50 секунды).

    Регистр S12 содержит величину в 20-миллисекундных
единицах времени ограничения Esc-кода. Это время, в течение
которого модем задерживает расшифровку Esc-последовательности
при получении Esc-кода. Поэтому задержки прихода следующих
символов Esc-последовательности не должны превышать этого
времени.


S14  Регистр битовой карты

    Регистр S14 содержит битовую карту некоторых внутренних
состояний модема.

Бит  Состояние

 0               Не используется
 1       0       Нет эхо (ATE0)
         1       Эхо включено (ATE1)
 2       0       Результирующий код разрешен (ATQ0)
         1       Результирующий код запрещен (ATQ1)
 3       0       Цифровой код результата (ATV0)
         1       Символьный код результата (ATV1)
 4               Не используется
 5       0       Тон набора
         1       Пауза набора
 6               Не используется
 7       0       Режим ответчика
         1       Вызывной режим


S16  Опции тестирования модема

    Регистр S16 показывает статус тест-режимов модема. Тесты
вызываются командой "AT&T".

Бит 0  Локальный аналоговый тест выключен-включен.
Бит 1  Зарезервирован.
Бит 2  Локальный цифровой тест выключен-включен.
Бит 3  Петля выключена-включена (инициатива удаленного
       модема).
Бит 4  Удаленный цифровой тест выключен-включен.
Бит 5  Расширенный удаленный цифровой тест выключен-включен.
Бит 6  Расширенный локальный цифровой тест выключен-включен.
Бит 7  Зарезервирован.


S18  Таймер тестовых команд

    Диапазон: 0..255 (секунд).

    Содержимое регистра S18 определяет длительность процедур
тестирования. Установка 0 в S18 выключает тесты.


S25  Задержка сигнала DTR

    Диапазон: 0..255 (1/100 секунды).

    Переключения сигнала DTR игнорируются, если они меньше
времени, определяемого регистром S25.


S26  Задержка переключения сигналов RTS и CTS

    Диапазон: 0..255 (1/100 секунды).

    Этот регистр определяет задержку переключения сигнала CTS
в зависимости от переключения сигнала RTS.


Стандартные сообщения модема

    В следующей таблице перечислены символьные представления
для соответствующих числовых значений результирующих кодов.

       Символьное
Код  представление      Описание

 0       OK             Команда выполнена без ошибок

 1       CONNECT        Соединение на скорости 300 бит/с

 2       RING           Обнаружен звонок

 3       NO CARRIER     Несущая не обнаружена или утеряна

 4       ERROR          Недопустимая команда или переполнение
                        буфера

 5       CONNECT 1200   Соединение на скорости 1200 бит/с

 6       NO DIALTONE    Не обнаружен тональный сигнал станции

 7       BUSY           Обнаружен сигнал занятости, набор
                        прерван

 8       NO ANSWER      Тишина, не обнаружен ответ

10       CONNECT 2400   Соединение на скорости 2400 бит/с

